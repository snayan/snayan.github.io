{"data":{"site":{"siteMetadata":{"title":"三洋的小站","author":"三洋"}},"markdownRemark":{"id":"f2e699e6-5fec-5559-b8d5-8d05c09d0e81","excerpt":"趁着离职期这段时间，制定了一个计划，再次阅读React16的源码，React16是一个大版本的更新，其中新增了许多的新特性，并且重写了核心模块的架构，叫做Fiber，最令人兴奋的是async rendering。之前也浅显的阅读过React15的部分源码，发现这次React16与之有很大的不同。核心文件React1…","html":"<p>趁着离职期这段时间，制定了一个计划，再次阅读React16的源码，React16是一个大版本的更新，其中新增了许多的新特性，并且重写了核心模块的架构，叫做<strong>Fiber</strong>，最令人兴奋的是<strong>async rendering</strong>。之前也浅显的阅读过React15的部分源码，发现这次React16与之有很大的不同。</p>\n<h2>核心文件</h2>\n<p>React16真的是重新梳理了代码结构，并且解耦了很多，下面为React16的文件结构</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2157d97d8ca570791edce8da8819a70e/8854f/react16_file_structure.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 76.5079365079365%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAECAwT/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHDXJDEH//EABcQAQEBAQAAAAAAAAAAAAAAAAEAITH/2gAIAQEAAQUCOZESxf/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABoQAAIDAQEAAAAAAAAAAAAAAAABETFBoSH/2gAIAQEAAT8hhgcM6MorpRimvCh//9oADAMBAAIAAwAAABBkD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABoQAAMBAQEBAAAAAAAAAAAAAAABESFxMVH/2gAIAQEAAT8Qd2TbG5pRHXBajeh5b6RTZa8FrdP/2Q=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"react16的文件结构\"\n        title=\"\"\n        src=\"/static/2157d97d8ca570791edce8da8819a70e/c739e/react16_file_structure.jpg\"\n        srcset=\"/static/2157d97d8ca570791edce8da8819a70e/8ee9c/react16_file_structure.jpg 148w,\n/static/2157d97d8ca570791edce8da8819a70e/ebbe7/react16_file_structure.jpg 295w,\n/static/2157d97d8ca570791edce8da8819a70e/c739e/react16_file_structure.jpg 590w,\n/static/2157d97d8ca570791edce8da8819a70e/8854f/react16_file_structure.jpg 630w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<p>可以看到我们熟悉的react和react-dom。react-art是绘制图形的，比如Canvas，SVG，VML。react-call-return是一个试验性的，用于react中的多遍渲染。react-reconciler是Fiber的实现。share中存放着一些公用的方法和属性。</p>\n<!--more-->\n<h2>React目录</h2>\n<p>react目录下存放着react的核心文件，如图</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/98f96ec8abe53a99ae170e283e5c91ef/73369/react-strycture.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 117.36334405144693%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAXABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHnxVJDVNJZB//EABgQAQADAQAAAAAAAAAAAAAAAAEAAhAx/9oACAEBAAEFAja9SEr1c//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABQQAQAAAAAAAAAAAAAAAAAAADD/2gAIAQEABj8CH//EABkQAQADAQEAAAAAAAAAAAAAAAEAEBExQf/aAAgBAQABPyHlI5AH2gLGDiEGf//aAAwDAQACAAMAAAAQ28c8/8QAGBEAAwEBAAAAAAAAAAAAAAAAARFRABD/2gAIAQMBAT8QRuRvf//EABcRAAMBAAAAAAAAAAAAAAAAAAARYRD/2gAIAQIBAT8QcHN//8QAHBABAAIDAAMAAAAAAAAAAAAAAQARMUFRIWGR/9oACAEBAAE/EEN1b1UFshXCHWr5KdSqoAvWABPfYLh7ChA684n/2Q=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"react目录\"\n        title=\"\"\n        src=\"/static/98f96ec8abe53a99ae170e283e5c91ef/c739e/react-strycture.jpg\"\n        srcset=\"/static/98f96ec8abe53a99ae170e283e5c91ef/8ee9c/react-strycture.jpg 148w,\n/static/98f96ec8abe53a99ae170e283e5c91ef/ebbe7/react-strycture.jpg 295w,\n/static/98f96ec8abe53a99ae170e283e5c91ef/c739e/react-strycture.jpg 590w,\n/static/98f96ec8abe53a99ae170e283e5c91ef/73369/react-strycture.jpg 622w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<p>看着是不是很熟悉，跟react15的很多一样。ReactBaseClasses实现了<code class=\"language-text\">Component</code>和<code class=\"language-text\">PureComponent</code>。ReactChildren里是一些工具函数。ReactCurrentOwner就是创建当前上下文环境对象。ReactElement实现了<code class=\"language-text\">createElement</code>，<code class=\"language-text\">createFactory</code>，<code class=\"language-text\">cloneElement</code>，<code class=\"language-text\">isvalidElement</code>。ReactElementValidator用于验证<code class=\"language-text\">ReactElement</code>相关方法。<code class=\"language-text\">ReactNoopUpdateQueue</code>维护着react的更新队列。</p>\n<h2>React源码</h2>\n<p>与React15一样，react输出的也是一个对象，这个对象上绑定着我们用的一些类或方法。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> React <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  Children<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    map<span class=\"token punctuation\">,</span>\n    forEach<span class=\"token punctuation\">,</span>\n    count<span class=\"token punctuation\">,</span>\n    toArray<span class=\"token punctuation\">,</span>\n    only<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  Component<span class=\"token punctuation\">,</span>\n  PureComponent<span class=\"token punctuation\">,</span>\n\n  Fragment<span class=\"token punctuation\">:</span> <span class=\"token constant\">REACT_FRAGMENT_TYPE</span><span class=\"token punctuation\">,</span><span class=\"token comment\">//react16增加了Fragment</span>\n  StrictMode<span class=\"token punctuation\">:</span> <span class=\"token constant\">REACT_STRICT_MODE_TYPE</span><span class=\"token punctuation\">,</span>\n  unstable_AsyncMode<span class=\"token punctuation\">:</span> <span class=\"token constant\">REACT_ASYNC_MODE_TYPE</span><span class=\"token punctuation\">,</span>\n\n  createElement<span class=\"token punctuation\">:</span> __DEV__ <span class=\"token operator\">?</span> createElementWithValidation <span class=\"token punctuation\">:</span> createElement<span class=\"token punctuation\">,</span>\n  cloneElement<span class=\"token punctuation\">:</span> __DEV__ <span class=\"token operator\">?</span> cloneElementWithValidation <span class=\"token punctuation\">:</span> cloneElement<span class=\"token punctuation\">,</span>\n  createFactory<span class=\"token punctuation\">:</span> __DEV__ <span class=\"token operator\">?</span> createFactoryWithValidation <span class=\"token punctuation\">:</span> createFactory<span class=\"token punctuation\">,</span>\n  isValidElement<span class=\"token punctuation\">:</span> isValidElement<span class=\"token punctuation\">,</span>\n\n  version<span class=\"token punctuation\">:</span> ReactVersion<span class=\"token punctuation\">,</span>\n\n  __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    ReactCurrentOwner<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// Used by renderers to avoid bundling object-assign twice in UMD bundles:</span>\n    assign<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>其中值得注意的是，react16中增加了Fragment，这个是react15中没有的。上面代码都比较简单，我就不一一说了。</p>","frontmatter":{"title":"React 16学习(-)","date":"March 01, 2018"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/learn_react16_part1/","previous":{"fields":{"slug":"/gomoku/"},"frontmatter":{"title":"简单的五子棋"}},"next":{"fields":{"slug":"/learn_react16_part2/"},"frontmatter":{"title":"React 16学习(二)"}}}}