{"data":{"avatar":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIEBQP/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQD/2gAMAwEAAhADEAAAAcSerUQpOzXUqiMAb//EABsQAAMAAgMAAAAAAAAAAAAAAAABAhESAxQh/9oACAEBAAEFAjzJ1VJcZepyU9x0z//EABURAQEAAAAAAAAAAAAAAAAAABEg/9oACAEDAQE/AWP/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAbEAADAAIDAAAAAAAAAAAAAAAAASEQERIxMv/aAAgBAQAGPwImPUNtcTodiz//xAAcEAACAgMBAQAAAAAAAAAAAAAAAREhMUFRYXH/2gAIAQEAAT8hWbK7l6NWStvasZEW4S7fwfTTAkNzkQZ//9oADAMBAAIAAwAAABAs1wP/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEQ/9oACAEDAQE/EMLbwL//xAAXEQEBAQEAAAAAAAAAAAAAAAABEQAQ/9oACAECAQE/EIzR4rv/xAAfEAEAAwACAQUAAAAAAAAAAAABABEhMUFRYXGBodH/2gAIAQEAAT8QAjVRsF68R3WyhBpEB4otans9oxQXOZRxVfkow9YivuDFJrEfPmaECm2kqIiV2XP/2Q==","width":40,"height":40,"src":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg","srcSet":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg 1x,\n/static/9d156e8486b343189790da372acb0018/9c097/my.jpg 1.5x,\n/static/9d156e8486b343189790da372acb0018/bd6c6/my.jpg 2x"}}},"site":{"siteMetadata":{"title":"三洋的小站","author":"三洋"}},"markdownRemark":{"id":"a7c66256-7f1f-546b-b6c6-6d5ff325626f","excerpt":"目的这个项目主要是用vue+vuex实现一个单页面应用，纯粹是熟悉vue全家桶相关开发模式，用于练手非常合适。\n着手开发完了之后可以学的东西：熟悉vue单文件组件开发方式熟悉如何写一个vue插件熟悉如何使用vue-router以及挂载路由钩子函数熟悉vuex是如何运作的，模块化维护应用状态数据体验typescript…","html":"<h2>目的</h2>\n<p>这个项目主要是用vue+vuex实现一个单页面应用，纯粹是熟悉vue全家桶相关开发模式，用于练手非常合适。\n着手开发完了之后可以学的东西：</p>\n<ol>\n<li>熟悉vue单文件组件开发方式</li>\n<li>熟悉如何写一个vue插件</li>\n<li>熟悉如何使用vue-router以及挂载路由钩子函数</li>\n<li>熟悉vuex是如何运作的，模块化维护应用状态数据</li>\n<li>体验typescript的开发方式\n如果想学vue的不妨进来看看。\n项目源码地址：<a href=\"https://github.com/snayan/vue-task\">点击这里</a></li>\n</ol>\n<h2>技术栈</h2>\n<ul>\n<li>vue</li>\n<li>vuex</li>\n<li>vue-router</li>\n<li>typescript</li>\n</ul>\n<!--more-->\n<h2>开始</h2>\n<p>开始之前，还是有必要去vue官网学习一下vue，至少得有个大致的了解，后面在用到vue-router和vuex时，再去对应的仓库看文档就可以了。</p>\n<ul>\n<li><a href=\"https://cn.vuejs.org/v2/guide/\">vue官网地址</a></li>\n<li><a href=\"https://router.vuejs.org/\">vue-router地址</a></li>\n<li><a href=\"https://vuex.vuejs.org/\">vuex地址</a>\n创建项目可以用vue-cli，具体看<a href=\"https://github.com/vuejs/vue-cli/blob/dev/docs/README.md\">这里</a></li>\n</ul>\n<h2>结构</h2>\n<p>项目结构一般来说非常重要，定义好的目录结构，非常利于后续的项目维护，以及别人阅读理解。下面就是这个项目的结构，应该看一下就知道是干什么的，大致说一下。\n项目结构分为静态资源目录，api接口请求目录，组件目录，插件目录，路由配置目录，公共样式目录，状态维护目录，工具类目录，页面视图目录。\n<a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/77f26178714fcfd80de8a06f8e44a4ee/0c499/vue-structure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 78.04878048780488%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsSAAALEgHS3X78AAABMUlEQVQoz5WT2W7DIBBF/SuR2QdqnMVxbDaDSSulatU+9v8/pKTNays8ukJI6MKZ0aVZvX5/dZ0+YEwoZZiQsqlUMy6HcDWX0Qzn8zTPuu8RwrVmvujxZtawKvVECC2qsf1W007yuOpBd231gwgRzpjgrBFK2KysNYxyhDc0fMeWAvw4pJSctYxSWjewB7YE+EhsdcfnZcp+OO1V25bzOmwl4SuQdXE5XwGAbMJWADfbLSHMsylXbutZCfl2iTHETvftfeKbBibli9MpxuNpKF5yDxmtVNP1fZ5wTFF2PQPJpapXAwI+B5lCOI+X+mA+sDGm+OlknQ9hAZAlnozx8kNqclrMZKf2MaaccwjBGFtW59w8lcwx9APzVzUt5bsefMrWJ+MjFQozIEwSLhEV/+sb3fqd0njUfL0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"vue structure\"\n        title=\"\"\n        src=\"/static/77f26178714fcfd80de8a06f8e44a4ee/b9e4f/vue-structure.png\"\n        srcset=\"/static/77f26178714fcfd80de8a06f8e44a4ee/cf440/vue-structure.png 148w,\n/static/77f26178714fcfd80de8a06f8e44a4ee/d2d38/vue-structure.png 295w,\n/static/77f26178714fcfd80de8a06f8e44a4ee/b9e4f/vue-structure.png 590w,\n/static/77f26178714fcfd80de8a06f8e44a4ee/f9b6a/vue-structure.png 885w,\n/static/77f26178714fcfd80de8a06f8e44a4ee/0c499/vue-structure.png 902w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<h2>单页面组件</h2>\n<p>vue开发一般都是单页面组件的方式，即一个以vue为后缀的文件就是一个组件，组件里包含了template模版，script脚本，style样式，组件内的逻辑可以完全封装在里面，对外可以提供接受的Props数据，可以对外发射一个事件emit，或者将外部组件组合到自己内部的slot里面。</p>\n<div class=\"gatsby-highlight\" data-language=\"vue\"><pre class=\"language-vue\"><code class=\"language-vue\">&lt;template&gt;\n  &lt;div class=&quot;topNav&quot;&gt;\n    &lt;ul class=&quot;list&quot;&gt;\n      &lt;li class=&quot;item left&quot;&gt;\n        &lt;app-icon :link=&quot;left&quot; @click.native.stop=&quot;clickLeft&quot; /&gt;\n      &lt;/li&gt;\n    &lt;/ul&gt;\n  &lt;/div&gt;\n&lt;/template&gt;\n\n&lt;script lang=&quot;ts&quot;&gt;\nimport { Component, Prop, Emit , Vue } from &#39;vue-property-decorator&#39;;\nimport AppIcon from &#39;./AppIcon.vue&#39;;\nimport {PREFIX} from &#39;@/store/modules/user/CONSTANTS&#39;;\n\n@Component({\n  components: {\n    AppIcon,\n  },\n})\nexport default class TopNav extends Vue {\n  @Prop({required: true})\n  private left!: string;\n  private get avatar() {\n    return this.$store.state[PREFIX].avatar;\n  }\n  private clickLeft() {\n    this.$emit(&#39;left&#39;);\n  }\n}\n&lt;/script&gt;\n\n&lt;style lang=&quot;scss&quot; scoped&gt;\n@import &#39;../scss/theme.scss&#39;;\n.topNav {\n  background: $topBarBgColor;\n  position: fixed;\n}\n&lt;/style&gt;</code></pre></div>\n<h2>配置路由</h2>\n<p>由于在客户端渲染的单页面应用，需要在客户端配置路由，实现页面间的切换。开发vue时官方推荐使用vue-router，在配置这个项目时，由于考虑登录态的维护，所以对路由配置加了meta数据，并增加了路由跳转钩子函数，进行鉴权控制受登录态的页面。</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> Vue <span class=\"token keyword\">from</span> <span class=\"token string\">'vue'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> Router <span class=\"token keyword\">from</span> <span class=\"token string\">'vue-router'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> Sign <span class=\"token keyword\">from</span> <span class=\"token string\">'@/views/Sign.vue'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> Me <span class=\"token keyword\">from</span> <span class=\"token string\">'@/views/Me.vue'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> hasLogin <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@/util/session'</span><span class=\"token punctuation\">;</span>\n\nVue<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>Router<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> router <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Router</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  mode<span class=\"token punctuation\">:</span> <span class=\"token string\">'history'</span><span class=\"token punctuation\">,</span>\n  routes<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      path<span class=\"token punctuation\">:</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span>\n      name<span class=\"token punctuation\">:</span> <span class=\"token string\">'sign'</span><span class=\"token punctuation\">,</span>\n      component<span class=\"token punctuation\">:</span> Sign<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      path<span class=\"token punctuation\">:</span> <span class=\"token string\">'/me'</span><span class=\"token punctuation\">,</span>\n      name<span class=\"token punctuation\">:</span> <span class=\"token string\">'me'</span><span class=\"token punctuation\">,</span>\n      component<span class=\"token punctuation\">:</span> Me<span class=\"token punctuation\">,</span>\n      meta<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> requiredAuth<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">to<span class=\"token punctuation\">,</span> <span class=\"token keyword\">from</span><span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>to<span class=\"token punctuation\">.</span>matched<span class=\"token punctuation\">.</span><span class=\"token function\">some</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">record</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> record<span class=\"token punctuation\">.</span>meta<span class=\"token punctuation\">.</span>requiredAuth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// this route requires auth, check if logged in</span>\n    <span class=\"token comment\">// if not, redirect to login page.</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">hasLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        path<span class=\"token punctuation\">:</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span>\n        query<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> redirect<span class=\"token punctuation\">:</span> to<span class=\"token punctuation\">.</span>fullPath <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 确保一定要调用 next()</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> router<span class=\"token punctuation\">;</span></code></pre></div>\n<h2>vue插件编写</h2>\n<p>对于那种需要全组件共享，或者全局注入的方法等可以使用vue插件。其实，vue-router和vuex实际就是vue的插件，在入口处，调<code class=\"language-text\">Vue.use(Router);</code> 就可以了，比如 <code class=\"language-text\">Vue.use(Router);</code>\n一个插件，可以是一个函数，或者一个包含<code class=\"language-text\">install</code>方法的对象，在调用<code class=\"language-text\">Vue.use</code>时，会调用<code class=\"language-text\">install</code>方法。\n在插件里，我们可以</p>\n<ol>\n<li>添加全局方法或者属性，</li>\n<li>添加全局资源</li>\n<li>通过全局 mixin 方法添加一些组件选项</li>\n<li>添加 Vue 实例方法</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> Vue<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> VueConstructor<span class=\"token punctuation\">,</span> PluginObject <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'vue'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> Loading <span class=\"token keyword\">from</span> <span class=\"token string\">'./Loading.vue'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token function-variable function\">ShowFunc</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> plugin<span class=\"token punctuation\">:</span> PluginObject<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">install</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">Vue<span class=\"token punctuation\">:</span> VueConstructor<span class=\"token punctuation\">,</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token constant\">CONSTRUCTOR</span> <span class=\"token operator\">=</span> Vue<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span>Loading<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> cache<span class=\"token punctuation\">:</span> Vue <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">{</span> show<span class=\"token punctuation\">:</span> ShowFunc <span class=\"token punctuation\">}</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function\">loading</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> loadingComponent <span class=\"token operator\">=</span> cache <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>cache <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CONSTRUCTOR</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>loadingComponent<span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> vm <span class=\"token operator\">=</span> loadingComponent<span class=\"token punctuation\">.</span><span class=\"token function\">$mount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'body'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> HTMLElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>vm<span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">return</span> loadingComponent<span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token class-name\">Vue</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>$loading <span class=\"token operator\">=</span> loading<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> plugin<span class=\"token punctuation\">;</span></code></pre></div>\n<h2>状态管理</h2>\n<p>单页面应用的状态管理使用vuex，上面提到了，它就是一个vue的插件，会在组件实例上注入$store对象，这个对象就是<code class=\"language-text\">new Vuex.Store()</code>,相比redux ，我觉得vuex简单很多。使用需要注意一下几点就可以了，</p>\n<ol>\n<li>改变state，始终是通过commit一个mutation方式进行，mutation函数里必须是同步改变state，不能异步改变state。对应redux中，就是reducer函数的功能了。</li>\n<li>对于异步改变state，可以通过dispatch一个action，action里面异步获取数据之后在commit一个对应的mutation。这个在redux里，是通过中间件处理异步action的。</li>\n<li>对于state的过滤筛选，可以定义getter，getter是缓存依赖的。</li>\n<li>对于大型复杂的state，可以采用模块化的方式管理各个模块的state，这个跟redux的思想是一样的。\n本次项目也是用模块化的管理状态的方式，把整个应用的状态以业务划分为子状态，最后在modules中合并</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">  modules<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    user<span class=\"token punctuation\">,</span>\n    list<span class=\"token punctuation\">,</span>\n    filter<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p> 对于单个模块的state，按照上面的注意点即可以。</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// user模块的state</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ActionTree<span class=\"token punctuation\">,</span> MutationTree<span class=\"token punctuation\">,</span> ActionContext <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'vuex'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> login<span class=\"token punctuation\">,</span> loginOut<span class=\"token punctuation\">,</span> LoginInfo <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@/api/login'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getUserInfo<span class=\"token punctuation\">,</span> getUserActions <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@/api/user'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> User <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./user'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> RootState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../../rootstate'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> namespaced <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* initial state */</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">state</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  id<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  username<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  email<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  avatar<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  likes_count<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  goings_count<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  past_count<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* user actions */</span>\n<span class=\"token keyword\">const</span> actions<span class=\"token punctuation\">:</span> ActionTree<span class=\"token operator\">&lt;</span>User<span class=\"token punctuation\">,</span> RootState<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">login</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> commit<span class=\"token punctuation\">,</span> state <span class=\"token punctuation\">}</span><span class=\"token punctuation\">:</span> ActionContext<span class=\"token operator\">&lt;</span>User<span class=\"token punctuation\">,</span> RootState<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> payload<span class=\"token punctuation\">:</span> LoginInfo</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">login</span><span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>\n      <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> token<span class=\"token punctuation\">,</span> user <span class=\"token punctuation\">}</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> token<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span> user<span class=\"token punctuation\">:</span> User <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'saveToken'</span><span class=\"token punctuation\">,</span> token<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> root<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'saveUser'</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">getUserInfo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> commit<span class=\"token punctuation\">,</span> state <span class=\"token punctuation\">}</span><span class=\"token punctuation\">:</span> ActionContext<span class=\"token operator\">&lt;</span>User<span class=\"token punctuation\">,</span> RootState<span class=\"token operator\">></span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">getUserInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">user<span class=\"token punctuation\">:</span> User</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'saveUser'</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* user mutations */</span>\n<span class=\"token keyword\">const</span> mutations<span class=\"token punctuation\">:</span> MutationTree<span class=\"token operator\">&lt;</span>User<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">saveUser</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">state<span class=\"token punctuation\">,</span> user</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    state<span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> user<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">;</span>\n    state<span class=\"token punctuation\">.</span>username <span class=\"token operator\">=</span> user<span class=\"token punctuation\">.</span>username<span class=\"token punctuation\">;</span>\n    state<span class=\"token punctuation\">.</span>email <span class=\"token operator\">=</span> user<span class=\"token punctuation\">.</span>email<span class=\"token punctuation\">;</span>\n    state<span class=\"token punctuation\">.</span>avatar <span class=\"token operator\">=</span> user<span class=\"token punctuation\">.</span>avatar<span class=\"token punctuation\">;</span>\n    state<span class=\"token punctuation\">.</span>likes_count <span class=\"token operator\">=</span> user<span class=\"token punctuation\">.</span>likes_count<span class=\"token punctuation\">;</span>\n    state<span class=\"token punctuation\">.</span>goings_count <span class=\"token operator\">=</span> user<span class=\"token punctuation\">.</span>goings_count<span class=\"token punctuation\">;</span>\n    state<span class=\"token punctuation\">.</span>past_count <span class=\"token operator\">=</span> user<span class=\"token punctuation\">.</span>past_count<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  state<span class=\"token punctuation\">,</span>\n  actions<span class=\"token punctuation\">,</span>\n  mutations<span class=\"token punctuation\">,</span>\n  namespaced<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>","frontmatter":{"title":"vue 全家桶初探","date":"June 15, 2018"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/vue_technology_stack/","previous":{"fields":{"slug":"/learn_react16_part4/"},"frontmatter":{"title":"react 16学习(四)"}},"next":{"fields":{"slug":"/process_of_webpack_build_project/"},"frontmatter":{"title":"webpack构建常见流程"}}}}