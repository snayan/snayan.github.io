{"data":{"avatar":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIEBQP/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQD/2gAMAwEAAhADEAAAAcSerUQpOzXUqiMAb//EABsQAAMAAgMAAAAAAAAAAAAAAAABAhESAxQh/9oACAEBAAEFAjzJ1VJcZepyU9x0z//EABURAQEAAAAAAAAAAAAAAAAAABEg/9oACAEDAQE/AWP/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAbEAADAAIDAAAAAAAAAAAAAAAAASEQERIxMv/aAAgBAQAGPwImPUNtcTodiz//xAAcEAACAgMBAQAAAAAAAAAAAAAAAREhMUFRYXH/2gAIAQEAAT8hWbK7l6NWStvasZEW4S7fwfTTAkNzkQZ//9oADAMBAAIAAwAAABAs1wP/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEQ/9oACAEDAQE/EMLbwL//xAAXEQEBAQEAAAAAAAAAAAAAAAABEQAQ/9oACAECAQE/EIzR4rv/xAAfEAEAAwACAQUAAAAAAAAAAAABABEhMUFRYXGBodH/2gAIAQEAAT8QAjVRsF68R3WyhBpEB4otans9oxQXOZRxVfkow9YivuDFJrEfPmaECm2kqIiV2XP/2Q==","width":40,"height":40,"src":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg","srcSet":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg 1x,\n/static/9d156e8486b343189790da372acb0018/9c097/my.jpg 1.5x,\n/static/9d156e8486b343189790da372acb0018/bd6c6/my.jpg 2x"}}},"site":{"siteMetadata":{"title":"三羊的小站","author":"三羊","postPath":"/post","contentUrl":"https://github.com/snayan/blog-source/tree/master/content/blog","menu":{"search":{"name":"搜索","link":"/search"}}}},"markdownRemark":{"id":"580bb2df-12d7-5925-8a52-bfd838337d29","excerpt":"ReactElement 对象为 React 提供了，，，四个方法。ReactElement 是一个工厂方法，不是类模式，不要使用去调用。检查一个对象是否是 react element 对象，通过检查这个对象的是否等于，第一个参数是，实际是一个 Component…","html":"<p>ReactElement 对象为 React 提供了<code>createElement</code>，<code>createFactory</code>，<code>cloneElement</code>，<code>isValidElement</code>四个方法。ReactElement 是一个工厂方法，不是类模式，不要使用<code>new</code>去调用。检查一个对象是否是 react element 对象，通过检查这个对象的<code>$$typeof</code>是否等于<code>Symbol.for('react.element')</code></p>\n<pre><code class=\"language-javascript\">var ReactElement=function(type,key,ref,self,source,owner,props){\n  var element={\n    $$typeof:REACT_ELEMENT_TYPE,// Symbol['for']('react.element')\n    type:type,\n    key:key,\n    ref:ref,\n    props:props,\n    _owner:owner\n  };\n  if(process.env.NODE_ENV!=='production'{\n      // ....... 增加一些其他的属性\n      if(Object.freeze){\n      Object.freeze(element.props);\n      Object.freeze(element);\n    }\n  })\n  return element;\n}\n</code></pre>\n<!--more-->\n<ul>\n<li><code>createElement</code>，第一个参数是<code>type</code>，实际是一个 Component 的构造函数，在<code>type.defaultProps</code>上定义默认的<code>props</code>值；第二个参数<code>config</code>是一个对象或者<code>null</code>，对象提供了<code>props</code>名，也可以提供<code>key</code>，<code>ref</code>，<code>__self</code>，<code>__source</code>，第三个参数及后续的参数是<code>children</code></li>\n</ul>\n<pre><code class=\"language-javascript\">ReactElement.createElement=function(type,config,children){\n  var propName;\n  var props={};\n  var key=null,ref=null,self=null,source=null;\n  if(config!=null){\n    if(hasValidRef(config)){\n      ref=config.ref;\n    }\n    if(hasValidKey(config)){\n      key=''+config.key;\n    }\n  }\n  self=config.__self===undefined?null:config.__self;\n  source=config.__source===undefined?null:config.__source;\n  // 赋值config里配置的props\n  for(propName in config){\n    if(hasOWnProperty.call(config,propName) &#x26;&#x26; !['key','ref','__selft','__source'].includes(propName)){\n      props[propName]=config[propName];\n    }\n  }\n  // 赋值props.children\n  var childrenLength=arguments.length-2;\n  if(childrenLength===1){\n    props.children=children;\n  }else if(childrenLength>1){\n    var childArray=Array(childrenLength);\n    for(var i=0;i&#x3C;childrenLength;i++){\n      childArray[i]=arguments[i+2];\n    }\n    props.children=childArray;\n  }\n  // 赋值props的默认值\n  if(type &#x26;&#x26; type.defaultProps){\n    var defaultProps=type.defaultProps;\n    for(propName in defaultProps){\n      if(props[propName]===undefined){\n        props[propName]=defaultProps[propName];\n      }\n    }\n  }\n  // .... 非开发环境配置\n  // 返回react elment\n  return ReactElement(type,key,ref,self,source,ReactCurrentOwner.current,props);\n}\n</code></pre>\n<ul>\n<li><code>createFactory</code>，这个方法返回一个创建 react element 的函数。接受一个参数，<code>type</code>，用于指定要创建的 element 的类型。</li>\n</ul>\n<pre><code class=\"language-javascript\">ReactElement.createFactory = function(type) {\n  var factory = ReactElemet.createElement.bind(null, type)\n  factory.type = type\n  return factory\n}\n</code></pre>\n<ul>\n<li><code>cloneElement</code>，这个方法用于克隆一个已存在的 element，第一个参数就是<code>element</code>，用于被复制的，第二个是<code>config</code>，第三个是<code>children</code>，第二个和第三个参数与<code>createElement</code>意义一样，用于设置 props 和 children 的。其中，如果指定了 config，则会覆盖原 element 中的 props，如果指定了 children，则同样会覆盖原 element 的 children。</li>\n</ul>\n<pre><code class=\"language-javascript\">ReactElement.cloneElement = function(element, config, children) {\n  var propName\n  // 先复制原element的props和key,ref.\n  var props = _assign({}, element.props)\n  var key = element.key,\n    ref = element.ref\n  var self = element._self,\n    source = element._source,\n    owner = element._owner\n  // 如果config不为null,则覆盖原element的props和,key,self..\n  if (config != null) {\n    if (hasValidRef(config)) {\n      ref = config.ref\n      owner = ReactCurrentOwner.cuurent\n    }\n    if (hasValidKey(config)) {\n      key = config.key\n    }\n    var defaultProps\n    if (element.type &#x26;&#x26; element.defaultProps) {\n      defaultProps = element.type.defaultProps\n    }\n    for (propName in config) {\n      if (\n        hasOwnProperty.call(config, propName) &#x26;&#x26;\n        ![\"key\", \"ref\", \"__self\", \"__source\"].includes(propName)\n      ) {\n        if (\n          config[propName] === undefined &#x26;&#x26;\n          defaultProps[propName] !== undefined\n        ) {\n          props[propName] = defaultProps[propName]\n        } else {\n          props[propName] = config[propName]\n        }\n      }\n    }\n  }\n  // 如果children不为null,则重新指定新的element的children\n  var childrenLength = arguments.length - 2\n  if (childrenLength === 1) {\n    props.children = children\n  } else if (childrenLength > 1) {\n    var childArray = Array(childrenLength)\n    for (var i = 0; i &#x3C; childrenLength; i++) {\n      childArray[i] = arguments[i + 2]\n    }\n    props.children = childArray\n  }\n\n  // 最后也是使用ReactElement工厂创建新的react element\n  return ReactElement(element.type, key, ref, self, source, owner, props)\n}\n</code></pre>\n<ul>\n<li><code>isValidElement</code>，这个方法是用于来判断一个对象是否是 react element 对象。判断的依据就是 react element 的对象会有一个属性<code>$$typeof</code>，它等于<code>Symbol['for']('react.element')</code></li>\n</ul>\n<pre><code class=\"language-javascript\">ReactElement.isValidElement = function(object) {\n  return (\n    typeof object === \"object\" &#x26;&#x26;\n    object !== null &#x26;&#x26;\n    object.$$typeof === Symbol[\"for\"](\"react.element\")\n  )\n}\n</code></pre>\n<p>「react 版本 15.5.4」</p>","tableOfContents":"<ul></ul>","frontmatter":{"title":"阅读react源码--ReactElement部分","date":"May 30, 2017","tags":["react"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/post/reactelement_source/","previous":{"fields":{"slug":"/post/reactclass_source/"},"frontmatter":{"title":"阅读react源码--createClass部分"}},"next":{"fields":{"slug":"/post/reactdom_reactmount_source/"},"frontmatter":{"title":"阅读react-dom源码--ReactMount部分"}}}}