{"data":{"avatar":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIEBQP/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQD/2gAMAwEAAhADEAAAAcSerUQpOzXUqiMAb//EABsQAAMAAgMAAAAAAAAAAAAAAAABAhESAxQh/9oACAEBAAEFAjzJ1VJcZepyU9x0z//EABURAQEAAAAAAAAAAAAAAAAAABEg/9oACAEDAQE/AWP/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAbEAADAAIDAAAAAAAAAAAAAAAAASEQERIxMv/aAAgBAQAGPwImPUNtcTodiz//xAAcEAACAgMBAQAAAAAAAAAAAAAAAREhMUFRYXH/2gAIAQEAAT8hWbK7l6NWStvasZEW4S7fwfTTAkNzkQZ//9oADAMBAAIAAwAAABAs1wP/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEQ/9oACAEDAQE/EMLbwL//xAAXEQEBAQEAAAAAAAAAAAAAAAABEQAQ/9oACAECAQE/EIzR4rv/xAAfEAEAAwACAQUAAAAAAAAAAAABABEhMUFRYXGBodH/2gAIAQEAAT8QAjVRsF68R3WyhBpEB4otans9oxQXOZRxVfkow9YivuDFJrEfPmaECm2kqIiV2XP/2Q==","width":40,"height":40,"src":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg","srcSet":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg 1x,\n/static/9d156e8486b343189790da372acb0018/9c097/my.jpg 1.5x,\n/static/9d156e8486b343189790da372acb0018/bd6c6/my.jpg 2x"}}},"site":{"siteMetadata":{"title":"三洋的小站","author":"三洋"}},"markdownRemark":{"id":"73f82190-d5a9-5121-9a3e-7ba74057d9e1","excerpt":"众所周知，react的组件是有一个个的钩子函数，构建成的生命周期，在用es6的class与用createClass有所不同，其中createClass还包括了与。由于createClass 将在后续版本中移除，建议使用class形式。所以，下面讨论的都是class形式下的生命周期方式。初始阶段constructor…","html":"<p>众所周知，react的组件是有一个个的钩子函数，构建成的生命周期，在用es6的class与用createClass有所不同，其中createClass还包括了<code class=\"language-text\">getDefaultProps</code>与<code class=\"language-text\">getInitialState</code>。由于createClass 将在后续版本中移除，建议使用class形式。所以，下面讨论的都是class形式下的生命周期方式。</p>\n<h2>初始阶段</h2>\n<ul>\n<li>constructor ，构造函数，在初始化实例时首先触发</li>\n<li>componentWillMount，组件将渲染出来之前触发，可以调用setState，简单的合并state，不会触发render重新渲染</li>\n<li>render ，将组件渲染，不可以调用setState</li>\n<li>componentDidMount，组件渲染之后触发，可以调用setState，会重新触发render</li>\n</ul>\n<!--more-->\n<h2>更新阶段</h2>\n<ul>\n<li>componentWillReceivePorps，组件获取新的props时触发</li>\n<li>shouldComponentUpdate，组件在调用setState重新更新render之前调用，如果返回false,则不触发后续的生命周期的方法，不会更新组件的渲染，返回true，则一定会触发后续的生命周期方法，一定会重新更新组件的渲染，在这个方法里不能调用setState，如果不小心调用，会造成死循环</li>\n<li>componentWillUpdate，组件在更新阶段，即将更新组件之前触发，不可调用setState，如果不小心调用，会造成死循环</li>\n<li>Render，组件进行更新，不可调用setState</li>\n<li>componentDidUpdate，组件更新之后触发，</li>\n</ul>\n<h2>卸载阶段</h2>\n<ul>\n<li>componentWillUnmount，组件即将卸载之前触发，在这里一般做一些清理工作，也不可调用setState</li>\n</ul>\n<p>说完上面这些方法，就需要实际去验证了，我写了一个最基本的组件，且包含了它所有的生命周期的方法，看各个方法执行的情况。代码如下，其中Test与App大体类似，就不列出来了。</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            name<span class=\"token punctuation\">:</span> <span class=\"token string\">'zy'</span>\n        <span class=\"token punctuation\">}</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'main constructor'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">componentWillMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'main componentWillMount'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'main render'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Test</span></span> <span class=\"token attr-name\">name</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'main ComponentDidMount'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">componentWillReceiveProps</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'main componentWillReceiveProps'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">shouldComponentUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'main shouldComponentUpdate'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">componentWillUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'main componentWillUpdate'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">componentDidUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'main componentDidUpdate'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">componentWillUnmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'main componentWillUnmount'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>初始化时，查看Console控制台的打印情况如下，\n<a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/85b81ca394849cb5f45ef7941c3e35f4/db2b8/react_init.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 42.38532110091743%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAPoAAAD6AG1e1JrAAABAElEQVQY031RyXaDMBDz/38hm1PvJgaz2pSypSIcckhTvYcBMRqNBlKWpVKqqirOuTFGaZtk9H53jHPnKimlUto5xxgTQnjvu67r+75pGpAEV13XA4i+w/MY57oN0/dP98Q8z+M4rus6TRNe27a9+BAC2hHcrC3xeXviOI7Hiet84eJRXBQFhs3zHI0I2Np76BkXQioMjOb7vh9vgHhZlizLkCVJEvgT1CEANELqEOO6omA5/sIlhid2BDFykn3bYGWMlUprbdEILf4RU0qxV/ifYuTE/rQxEMcYQWFJV8hPzhgbJxZ5ZoabNvb2xaAv6M03zeMDIE7TFP8MYw/D8AuU8MTL4UQfhwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"react初始化\"\n        title=\"\"\n        src=\"/static/85b81ca394849cb5f45ef7941c3e35f4/b9e4f/react_init.png\"\n        srcset=\"/static/85b81ca394849cb5f45ef7941c3e35f4/cf440/react_init.png 148w,\n/static/85b81ca394849cb5f45ef7941c3e35f4/d2d38/react_init.png 295w,\n/static/85b81ca394849cb5f45ef7941c3e35f4/b9e4f/react_init.png 590w,\n/static/85b81ca394849cb5f45ef7941c3e35f4/f9b6a/react_init.png 885w,\n/static/85b81ca394849cb5f45ef7941c3e35f4/db2b8/react_init.png 1090w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a>\n可以看到，有2个点比较重要；第一个是， sub组件只有在main的render方法中实例化时才开始生命周期方法的调用；第二个是，main组件等sub组件实例化完成之后才完成。\n再来看看更新阶段的情况，\n<a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/23a4cb8de8fbf192233c7cad999ef784/06418/react_update.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 35.79335793357934%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAPoAAAD6AG1e1JrAAAA2klEQVQY03WQ246DIBRF/f8fNCJQ4UDUtgi2sV7R7gnzMnVKAg8nrL02ZKHv84KF0K/rOo7jNE3Y8zzvf1eM8TiOHpfzXClVFEXXdRmmt+utbtpLpeSl0poYF8jC1Q8eE0RzzokIsPc+27b1fndNeyVjh9cLchxoscV4htFISmmMQUQIAfAGD5GplE5mIaSxFjEf8mQuy1JrzRhzziU4GGOVprpumrZFhWVZjv8WzKk2IlLtH1gTcPt4PL0PwzCcH3w2/9Z2roMRtdGZcwlz3OM3WAiBNwPGb78BWtOL1XRnfEYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"react更新阶段\"\n        title=\"\"\n        src=\"/static/23a4cb8de8fbf192233c7cad999ef784/b9e4f/react_update.png\"\n        srcset=\"/static/23a4cb8de8fbf192233c7cad999ef784/cf440/react_update.png 148w,\n/static/23a4cb8de8fbf192233c7cad999ef784/d2d38/react_update.png 295w,\n/static/23a4cb8de8fbf192233c7cad999ef784/b9e4f/react_update.png 590w,\n/static/23a4cb8de8fbf192233c7cad999ef784/f9b6a/react_update.png 885w,\n/static/23a4cb8de8fbf192233c7cad999ef784/06418/react_update.png 1084w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a>\n上面是完整的更新阶段调用情况，也就是说我把shouldComponent都返回的是true，而实际中，shouldComponentUpdate可能在控制组件更新时返回false，那么返回false的情况下，后续的生命周期方法都不会调用，例如我把main的shouldComponentUpdate返回false，调用情况如下，\n<a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dd26204831e647520ce77cf30c750a20/d1783/react_update_false.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 9.94475138121547%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAPoAAAD6AG1e1JrAAAAV0lEQVQI122IMQ6AIAwA+f/3EOPKBpFWiy0wFJDVxBsulzPMvO0HALbWWKSUsrR6fOm9zzmJyFrrvXfOAYBRHSKS84N4pbQOngluyvMPVY0xImIIodb6AieHcj49ebNjAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"react更新\"\n        title=\"\"\n        src=\"/static/dd26204831e647520ce77cf30c750a20/b9e4f/react_update_false.png\"\n        srcset=\"/static/dd26204831e647520ce77cf30c750a20/cf440/react_update_false.png 148w,\n/static/dd26204831e647520ce77cf30c750a20/d2d38/react_update_false.png 295w,\n/static/dd26204831e647520ce77cf30c750a20/b9e4f/react_update_false.png 590w,\n/static/dd26204831e647520ce77cf30c750a20/f9b6a/react_update_false.png 885w,\n/static/dd26204831e647520ce77cf30c750a20/d1783/react_update_false.png 1086w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<p>最后，来看看卸载的调用情况，如下，\n<a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b76bca702c47b6c3a60b441a05e4e2f5/0c12f/react_destory.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 10.634328358208954%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAPoAAAD6AG1e1JrAAAAVUlEQVQI12WMwQqAMAxD9/9fOCy1jBZ0eth0wtgO1sqOyyGElxBXyrMAxuNsrdVah/fe30mqaq33npkBQESc0ZSvbY8rhRCMi4Wcb5v+80mISETj4gMarXEWkCJU5wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"react卸载\"\n        title=\"\"\n        src=\"/static/b76bca702c47b6c3a60b441a05e4e2f5/b9e4f/react_destory.png\"\n        srcset=\"/static/b76bca702c47b6c3a60b441a05e4e2f5/cf440/react_destory.png 148w,\n/static/b76bca702c47b6c3a60b441a05e4e2f5/d2d38/react_destory.png 295w,\n/static/b76bca702c47b6c3a60b441a05e4e2f5/b9e4f/react_destory.png 590w,\n/static/b76bca702c47b6c3a60b441a05e4e2f5/f9b6a/react_destory.png 885w,\n/static/b76bca702c47b6c3a60b441a05e4e2f5/0c12f/react_destory.png 1072w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>","frontmatter":{"title":"react组件生命周期浅谈","date":"June 19, 2017"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/post/react_component_life_cycle/","previous":{"fields":{"slug":"/post/reactdom_reactmount_source/"},"frontmatter":{"title":"阅读react-dom源码--ReactMount部分"}},"next":{"fields":{"slug":"/post/explanatio_of_ToPrimitive/"},"frontmatter":{"title":"javascript中ToPrimitive详解"}}}}