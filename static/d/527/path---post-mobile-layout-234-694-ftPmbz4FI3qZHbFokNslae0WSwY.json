{"data":{"avatar":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIEBQP/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQD/2gAMAwEAAhADEAAAAcSerUQpOzXUqiMAb//EABsQAAMAAgMAAAAAAAAAAAAAAAABAhESAxQh/9oACAEBAAEFAjzJ1VJcZepyU9x0z//EABURAQEAAAAAAAAAAAAAAAAAABEg/9oACAEDAQE/AWP/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAbEAADAAIDAAAAAAAAAAAAAAAAASEQERIxMv/aAAgBAQAGPwImPUNtcTodiz//xAAcEAACAgMBAQAAAAAAAAAAAAAAAREhMUFRYXH/2gAIAQEAAT8hWbK7l6NWStvasZEW4S7fwfTTAkNzkQZ//9oADAMBAAIAAwAAABAs1wP/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEQ/9oACAEDAQE/EMLbwL//xAAXEQEBAQEAAAAAAAAAAAAAAAABEQAQ/9oACAECAQE/EIzR4rv/xAAfEAEAAwACAQUAAAAAAAAAAAABABEhMUFRYXGBodH/2gAIAQEAAT8QAjVRsF68R3WyhBpEB4otans9oxQXOZRxVfkow9YivuDFJrEfPmaECm2kqIiV2XP/2Q==","width":40,"height":40,"src":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg","srcSet":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg 1x,\n/static/9d156e8486b343189790da372acb0018/9c097/my.jpg 1.5x,\n/static/9d156e8486b343189790da372acb0018/bd6c6/my.jpg 2x"}}},"site":{"siteMetadata":{"title":"三羊的小站","author":"三羊","postPath":"/post","contentUrl":"https://github.com/snayan/blog-source/tree/master/content/blog","menu":{"search":{"name":"搜索","link":"/search"}}}},"markdownRemark":{"id":"2eceb256-b89d-55b4-8766-f9d036255a6c","excerpt":"一直想抽时间总结一下现在业界可用的移动端布局方案。需求多，995 模式，身心被掏空，一拖再拖，终于在周六的晚上，做着梦弄完成的，不足之道 😪，请指教改正 🤠。media+百分比直接采用媒体查询加百分比去布局。核心思想：页面主体布局基本采用百分比去设置。然后，其他块内布局,例如 font-size…","html":"<p>一直想抽时间总结一下现在业界可用的移动端布局方案。需求多，995 模式，身心被掏空，一拖再拖，终于在周六的晚上，做着梦弄完成的，不足之道 😪，请指教改正 🤠。</p>\n\n          <h3 id='toc-3-1' >\n            media+百分比\n          </h3>\n        \n<p>直接采用媒体查询加百分比去布局。</p>\n<p>核心思想：</p>\n<ul>\n<li>页面主体布局基本采用百分比去设置。</li>\n<li>然后，其他块内布局,例如 font-size 等可通过设置媒体查询的断点来分设置，已达到兼容其他手机尺寸。</li>\n</ul>\n<!--more-->\n<p>优点：</p>\n<ul>\n<li>灵活，简单</li>\n<li>兼容性好，媒体查询，97.65%的浏览器都支持了。</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>媒体查询的断点设置麻烦，只能在选取的几个主流设备尺寸下呈现完美适配。</li>\n<li>1px 的问题，需要额外做处理，比如 transform:scaleX(0.5)。</li>\n</ul>\n<p>例子：京东\n<img src=\"./media.png\" alt=\"hotcss\"></p>\n\n          <h3 id='toc-3-2' >\n            hotcss\n          </h3>\n        \n<p>这个方案比较简单和实用，理解起来也不难。项目地址<a href=\"https://github.com/imochen/hotcss\">查看这里</a></p>\n<p>原理：</p>\n<ul>\n<li>自动通过 hotcss.js 计算页面的<code>html</code>的<code>font-size</code>的大小，其后在布局中使用 rem 作为像素单位，使得页面在不同的移动设备上可以视觉一致。</li>\n<li>通过获取 dpr，在<code>html</code>上设置属性<code>data-dpr</code>，在设置<code>font-size</code>时，可以配合<code>data-dpr</code>来使用 px 作为像素单位。</li>\n<li>计算 scale，为页面设置<code>viewport</code>，使得页面根据 dpr 进行缩放，最终达到，1 个物理像素=1px。这样，也有效解决了 1px 的问题。</li>\n<li>默认在 320px 屏幕中（非 Retina 屏），1rem=20px;</li>\n</ul>\n<p>核心源码：</p>\n<p>计算 dpr 并设置<code>data-dpr</code>和<code>scale</code></p>\n<pre><code class=\"language-javascript\">// 计算dpr\nvar dpr = window.devicePixelRatio || 1\n// 在其他的一些方案中，会区分ios和android，对android统一设置为1.\ndpr = dpr >= 3 ? 3 : dpr >= 2 ? 2 : 1\n// 设置data-dpr\ndocument.documentElement.setAttribute(\"data-dpr\", dpr)\n// 计算scale\nvar scale = 1 / dpr,\n  content =\n    \"width=device-width,initial-scale=\" +\n    scale +\n    \",minimum-scale=\" +\n    scale +\n    \",maximum-scale=\" +\n    scale +\n    \",user-scalable=no\"\n// 插入meta，设置页面缩放\nvar viewport = document.createElement(\"meta\")\nviewport.setAttribute(\"name\", \"viewport\")\nviewport.setAttribute(\"content\", content)\ndocument.head.appendChild(viewport)\n</code></pre>\n<p>计算<code>font-size</code>并设置<code>html</code>的<code>font-size</code></p>\n<pre><code class=\"language-javascript\">// 获取设备的宽度\nvar innerWidth =\n  document.documentElement.getBoundingClientRect().width || window.innerWidth\n// 计算font-seize，默认320px中，1rem=20px.\ndocument.documentElement.style.fontSize = (innerWidth * 20) / 320 + \"px\"\n</code></pre>\n<p>优点：</p>\n<ul>\n<li>后续布局处理简单，配合 px2rem 插件等，使用十分方便。</li>\n<li>基本能很好适配市面即大多数尺寸手机。</li>\n<li>兼容性也比较好，97.62%浏览器基本支持 rem 单位了。</li>\n<li>通过设置缩放比例，有效解决了 1px 的问题。</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>页面需要额外引入 js 脚本去计算，增加一次额外的 http 请求，或内嵌到页面中增加页面体积大小。</li>\n</ul>\n<p>例子：卷皮\n<img src=\"./hotcss.png\" alt=\"hotcss\"></p>\n\n          <h3 id='toc-3-3' >\n            flexible\n          </h3>\n        \n<p>这个是手机淘宝推出来一个方案，解决手机淘宝 H5 在移动端的布局。项目地址<a href=\"https://github.com/amfe/lib-flexible\">查看这里</a></p>\n<p>原理：</p>\n<ul>\n<li>自动通过 flexible.js 计算页面<code>html</code>的<code>font-size</code>的大小，然后在页面布局中使用 rem 作为单位，而非 px。</li>\n<li>如果页面指定了<code>meta[name=\"viewport\"]</code>，则直接根据已有的 meta 标签来设置缩放比例；否则，通过<code>dpr</code>来自动计算页面缩放比例。</li>\n<li>设置 1rem=10vw，例如，在 320px 屏幕（非 Retina 屏），1rem=32px；</li>\n</ul>\n<p>核心源码：</p>\n<p>计算缩放比例</p>\n<pre><code class=\"language-javascript\">// 参试获取页面已定义的缩放比例\nvar metaEl = doc.querySelector('meta[name=\"viewport\"]')\nif (metaEl) {\n  console.warn(\"将根据已有的meta标签来设置缩放比例\")\n  var match = metaEl.getAttribute(\"content\").match(/initial\\-scale=([\\d\\.]+)/)\n  if (match) {\n    scale = parseFloat(match[1])\n    dpr = parseInt(1 / scale)\n  }\n}\n// 如果没有，则自动计算\nif (!dpr &#x26;&#x26; !scale) {\n  var isAndroid = win.navigator.appVersion.match(/android/gi)\n  var isIPhone = win.navigator.appVersion.match(/iphone/gi)\n  var devicePixelRatio = win.devicePixelRatio\n  if (isIPhone) {\n    // iOS下，对于2和3的屏，用2倍的方案，其余的用1倍方案\n    if (devicePixelRatio >= 3 &#x26;&#x26; (!dpr || dpr >= 3)) {\n      dpr = 3\n    } else if (devicePixelRatio >= 2 &#x26;&#x26; (!dpr || dpr >= 2)) {\n      dpr = 2\n    } else {\n      dpr = 1\n    }\n  } else {\n    // 其他设备下，仍旧使用1倍的方案\n    dpr = 1\n  }\n  scale = 1 / dpr\n}\n</code></pre>\n<p>设置 meta</p>\n<pre><code class=\"language-javascript\">if (!metaEl) {\n  metaEl = doc.createElement(\"meta\")\n  metaEl.setAttribute(\"name\", \"viewport\")\n  metaEl.setAttribute(\n    \"content\",\n    \"initial-scale=\" +\n      scale +\n      \", maximum-scale=\" +\n      scale +\n      \", minimum-scale=\" +\n      scale +\n      \", user-scalable=no\"\n  )\n  if (docEl.firstElementChild) {\n    docEl.firstElementChild.appendChild(metaEl)\n  } else {\n    var wrap = doc.createElement(\"div\")\n    wrap.appendChild(metaEl)\n    doc.write(wrap.innerHTML)\n  }\n}\n</code></pre>\n<p>计算页面的 html 的 font-size</p>\n<pre><code class=\"language-javascript\">var width = docEl.getBoundingClientRect().width\n// 最大屏幕宽度为540*dpr\nif (width / dpr > 540) {\n  width = 540 * dpr\n}\n// 设置1rem=10vw\nvar rem = width / 10\ndocEl.style.fontSize = rem + \"px\"\nflexible.rem = win.rem = rem\n</code></pre>\n<p>优缺点同 hotcss。</p>\n<p>例子：淘宝\n<img src=\"./flexible.png\" alt=\"hotcss\"></p>\n\n          <h3 id='toc-3-4' >\n            rem+vw\n          </h3>\n        \n<p>这种方案就是在计算 html 的 font-size 时，是根据 vw 去自动计算，而不是用 js 脚本去动态计算。vw 是一种新的单位，类似的还有 vh，vmin，vmax。定义如下：</p>\n<ul>\n<li>vw：1vw 等于视口宽度的 1%；例如，320px 宽度视口中，1vw=3.2px，10vw=32px，100vw=320px；</li>\n<li>vh：1vh 等于视口高度的 1%；例如，568px 高度视口中，1vh=5.58px，10vh=56.8px，100vh=568px；</li>\n<li>vmin：选取 vw 和 vh 中最小的那个；</li>\n<li>vmax：选取 vw 和 vh 中最大的那个；</li>\n</ul>\n<p>核心思想：</p>\n<p>不用 js 去动态计算页面的 font-size ，而是设置根元素 html 的 font-size=<em>a</em> vw；这里的<em>a</em>，可以选取一种屏幕尺寸去参考计算。例如，我们想 iPhone6 下，html 的 font-size 为 100px。那个 html 的 font-size=100/375=0.26666666666666666vw。那么，其他屏幕的适配计算方式就是:</p>\n<pre><code class=\"language-javascript\">iphone5:屏幕是320*568\nhtml的font-size=0.26666666666666666*320=85.33333333333333\n\niphone6s:屏幕是414*736\nhtml的font-size=0.26666666666666666*414=110.39999999999999\n</code></pre>\n<p>页面布局采用 rem 布局，而非 px。根据 html 的 font-size 和 rem 单位自动计算出了布局 px。</p>\n<p>优点：</p>\n<ul>\n<li>不需要额外引入 js 脚本去计算，自动根据 vw 去计算 font-size</li>\n<li>后续布局也超级简单，采用 rem 即可。</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>vw 单位的支持相对比 rem 的浏览器少一些，目前有 93.65%的浏览器都支持了。</li>\n</ul>\n<p>例子：拼多多\n<img src=\"./vw+rem.png\" alt=\"hotcss\"></p>","tableOfContents":"<ul><li><a href=\"#toc-3-1\">media+百分比</a><ul></ul></li><li><a href=\"#toc-3-2\">hotcss</a><ul></ul></li><li><a href=\"#toc-3-3\">flexible</a><ul></ul></li><li><a href=\"#toc-3-4\">rem+vw</a><ul></ul></li></ul>","frontmatter":{"title":"移动端布局方案浅谈","date":"July 31, 2017","tags":["h5","mobile"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/post/mobile-layout/","previous":{"fields":{"slug":"/post/img_srcset_seizes/"},"frontmatter":{"title":"响应式图片加载"}},"next":{"fields":{"slug":"/post/mini_program_component_programming/"},"frontmatter":{"title":"小程序组件化编程"}}}}