{"data":{"avatar":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIEBQP/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQD/2gAMAwEAAhADEAAAAcSerUQpOzXUqiMAb//EABsQAAMAAgMAAAAAAAAAAAAAAAABAhESAxQh/9oACAEBAAEFAjzJ1VJcZepyU9x0z//EABURAQEAAAAAAAAAAAAAAAAAABEg/9oACAEDAQE/AWP/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAbEAADAAIDAAAAAAAAAAAAAAAAASEQERIxMv/aAAgBAQAGPwImPUNtcTodiz//xAAcEAACAgMBAQAAAAAAAAAAAAAAAREhMUFRYXH/2gAIAQEAAT8hWbK7l6NWStvasZEW4S7fwfTTAkNzkQZ//9oADAMBAAIAAwAAABAs1wP/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEQ/9oACAEDAQE/EMLbwL//xAAXEQEBAQEAAAAAAAAAAAAAAAABEQAQ/9oACAECAQE/EIzR4rv/xAAfEAEAAwACAQUAAAAAAAAAAAABABEhMUFRYXGBodH/2gAIAQEAAT8QAjVRsF68R3WyhBpEB4otans9oxQXOZRxVfkow9YivuDFJrEfPmaECm2kqIiV2XP/2Q==","width":40,"height":40,"src":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg","srcSet":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg 1x,\n/static/9d156e8486b343189790da372acb0018/9c097/my.jpg 1.5x,\n/static/9d156e8486b343189790da372acb0018/bd6c6/my.jpg 2x"}}},"site":{"siteMetadata":{"title":"ä¸‰æ´‹çš„å°ç«™","author":"ä¸‰æ´‹"}},"markdownRemark":{"id":"61acb6ff-a555-56b4-b3c2-56bfe6db2f18","excerpt":"æœ€è¿‘æƒ³äº†è§£ä¸€ä¸‹ React å’Œ Vue æ¡†æ¶åˆ†åˆ«åœ¨ virtual dom éƒ¨åˆ†çš„å®ç°ï¼Œä»¥åŠä»–ä»¬çš„ä¸åŒä¹‹å¤„ã€‚äºæ˜¯å…ˆç¿»å¼€ Vue çš„æºç å»æ‰¾ virtual dom çš„å®ç°ï¼Œçœ‹åˆ°å¼€å¤´ï¼Œå®ƒå°±æåˆ°äº† Vue çš„ virtual dom æ›´æ–°ç®—æ³•æ˜¯åŸºäº Snabbdom å®ç°çš„ã€‚äºæ˜¯ï¼Œåˆå»å…‹éš†äº† Snabbdomâ€¦","html":"<p>æœ€è¿‘æƒ³äº†è§£ä¸€ä¸‹ React å’Œ Vue æ¡†æ¶åˆ†åˆ«åœ¨ virtual dom éƒ¨åˆ†çš„å®ç°ï¼Œä»¥åŠä»–ä»¬çš„ä¸åŒä¹‹å¤„ã€‚äºæ˜¯å…ˆç¿»å¼€ Vue çš„æºç å»æ‰¾ virtual dom çš„å®ç°ï¼Œçœ‹åˆ°å¼€å¤´ï¼Œå®ƒå°±æåˆ°äº† Vue çš„ virtual dom æ›´æ–°ç®—æ³•æ˜¯åŸºäº Snabbdom å®ç°çš„ã€‚äºæ˜¯ï¼Œåˆå»å…‹éš†äº† Snabbdom çš„æºç ï¼Œå‘ç°å®ƒçš„æºç å¹¶ä¸æ˜¯å¾ˆå¤æ‚å¹¶ä¸”æ˜Ÿæ˜Ÿ ğŸŒŸ è¿˜å¾ˆå¤šï¼Œæ‰€ä»¥å°±ä»”ç»†çœ‹äº†ä¸€éäº†ï¼Œè¿™é‡Œå°±å°†è¯¦ç»†å­¦ä¹ ä¸€ä¸‹å®ƒæ˜¯å¦‚ä½•å®ç° virtual dom çš„ã€‚</p>\n<p>åœ¨ Snabbdom çš„ GitHub ä¸Šå°±è§£é‡Šäº†ï¼Œå®ƒæ˜¯ä¸€ä¸ªå®ç° virtual dom çš„åº“ï¼Œç®€å•åŒ–ï¼Œæ¨¡å—åŒ–ï¼Œä»¥åŠå¼ºå¤§çš„ç‰¹æ€§å’Œæ€§èƒ½ã€‚</p>\n<blockquote>\n<p>A virtual DOM library with focus on simplicity, modularity, powerful features and performance.</p>\n</blockquote>\n<p><a href=\"https://github.com/snabbdom/snabbdom\">è¿™é‡Œæ˜¯ Snabbdom çš„ä»“åº“åœ°å€</a>ã€‚</p>\n<h3>init</h3>\n<!--more-->\n<p>Snabbdom çš„ç®€å•æ˜¯åŸºäºå®ƒçš„æ¨¡å—åŒ–ï¼Œå®ƒå¯¹ virtual dom çš„è®¾è®¡éå¸¸å·§å¦™ï¼Œåœ¨æ ¸å¿ƒé€»è¾‘ä¸­åªä¼šä¸“æ³¨äº vNode çš„æ›´æ–°ç®—æ³•è®¡ç®—ï¼Œè€ŒæŠŠæ¯ä¸ªèŠ‚ç‚¹å…·ä½“è¦æ›´æ–°çš„éƒ¨åˆ†ï¼Œæ¯”å¦‚<code class=\"language-text\">props</code>ï¼Œ<code class=\"language-text\">class</code>ï¼Œ<code class=\"language-text\">styles</code>ï¼Œ<code class=\"language-text\">datalist</code>ç­‰æ”¾åœ¨ç‹¬ç«‹çš„æ¨¡å—é‡Œï¼Œé€šè¿‡åœ¨ä¸åŒæ—¶æœºè§¦å‘ä¸åŒ module çš„é’©å­å‡½æ•°å»å®Œæˆã€‚é€šè¿‡è¿™æ ·çš„æ–¹å¼è§£è€¦ï¼Œä¸ä»…å¯ä»¥ä½¿ä»£ç ç»„ç»‡ç»“æ„æ›´åŠ æ¸…æ™°ï¼Œæ›´å¯ä»¥ä½¿å¾—æ¯ä¸€éƒ¨åˆ†éƒ½ä¸“æ³¨äºå®ç°ç‰¹å®šçš„åŠŸèƒ½ï¼Œåœ¨è®¾è®¡æ¨¡å¼ä¸­ï¼Œè¿™ä¸ªä¹Ÿå«åšå•ä¸€èŒè´£åŸåˆ™ã€‚åœ¨å®é™…åœºæ™¯ä½¿ç”¨æ—¶ï¼Œå¯ä»¥åªå¼•å…¥éœ€è¦ç”¨åˆ°çš„ç‰¹å®šæ¨¡å—ã€‚æ¯”å¦‚æˆ‘ä»¬åªä¼šæ›´æ–°èŠ‚ç‚¹çš„ç±»åå’Œæ ·å¼ï¼Œè€Œä¸å…³å¿ƒå±æ€§ä»¥åŠäº‹ä»¶ï¼Œé‚£ä¹ˆå°±åªéœ€è¦å¼•ç”¨ class å’Œ style çš„æ¨¡å—å°±å¯ä»¥äº†ã€‚ä¾‹å¦‚ä¸‹é¢è¿™æ ·ï¼Œ</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// è¿™é‡Œæˆ‘ä»¬åªéœ€è¦ç”¨åˆ°classå’Œstyleæ¨¡å—ï¼Œæ‰€ä»¥å°±å¯ä»¥åªéœ€è¦å¼•ç”¨è¿™2ä¸ªæ¨¡å—</span>\n<span class=\"token keyword\">var</span> patch <span class=\"token operator\">=</span> snabbdom<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n  <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"snabbdom/modules/class\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>default<span class=\"token punctuation\">,</span>\n  <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"snabbdom/modules/style\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>default<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>å®ƒçš„æ ¸å¿ƒæ–¹æ³•å°±æ˜¯è¿™ä¸ª<code class=\"language-text\">init</code>ï¼Œæˆ‘ä»¬å…ˆæ¥ç®€å•çœ‹ä¸€ä¸‹è¿™ä¸ªå‡½æ•°çš„å®ç°ï¼Œ</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// è¿™é‡Œæ˜¯moduleä¸­çš„é’©å­å‡½æ•°</span>\n<span class=\"token keyword\">const</span> hooks <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"create\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"update\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"remove\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"destroy\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"pre\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"post\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">modules<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span>Partial<span class=\"token operator\">&lt;</span>Module<span class=\"token operator\">>></span><span class=\"token punctuation\">,</span> domApi<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">DOMAPI</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> i<span class=\"token punctuation\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>\n    j<span class=\"token punctuation\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>\n    cbs <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token keyword\">as</span> ModuleHooks\n  <span class=\"token keyword\">const</span> api<span class=\"token punctuation\">:</span> <span class=\"token constant\">DOMAPI</span> <span class=\"token operator\">=</span> domApi <span class=\"token operator\">!==</span> undefined <span class=\"token operator\">?</span> domApi <span class=\"token punctuation\">:</span> htmlDomApi\n  <span class=\"token comment\">// cbså­˜å‚¨äº†å¼•å…¥çš„modulesä¸­å®šä¹‰çš„é’©å­å‡½æ•°ï¼Œ</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> hooks<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>i<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    cbs<span class=\"token punctuation\">[</span>hooks<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;</span> modules<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>j<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> hook <span class=\"token operator\">=</span> modules<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>hooks<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>hook <span class=\"token operator\">!==</span> undefined<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        cbs<span class=\"token punctuation\">[</span>hooks<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>hook<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// è¿˜å®šä¹‰äº†ä¸€äº›å…¶ä»–çš„å†…éƒ¨æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•éƒ½æ˜¯æœåŠ¡äºpatch</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">emptyNodeAt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* ... */</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">createRmCb</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* ... */</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">createElm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* ... */</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">addVnodes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* ... */</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">invokeDestroyHook</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* ... */</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">removeVnodes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* ... */</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">updateChildren</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* ... */</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">patchVnode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* ... */</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// initè¿”å›äº†ä¸€ä¸ªpatchå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥å—2ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å°†è¢«æ›´æ–°çš„vNodeæˆ–è€…çœŸå®domèŠ‚ç‚¹ï¼Œç¬¬äºŒä¸ªæ˜¯ç”¨æ¥æ›´æ–°çš„æ–°çš„vNode</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token function\">patch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">oldVnode<span class=\"token punctuation\">:</span> VNode <span class=\"token operator\">|</span> Element<span class=\"token punctuation\">,</span> vnode<span class=\"token punctuation\">:</span> VNode</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> VNode <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ä»<code class=\"language-text\">init</code>å‡½æ•°æ•´ä½“æ¥çœ‹ï¼Œå®ƒæ¥å—ä¸€ä¸ª modules æ•°ç»„ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°<code class=\"language-text\">patch</code>ã€‚è¿™ä¸å°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„é—­åŒ…å‡½æ•°å—ï¼Ÿåœ¨<code class=\"language-text\">init</code>ä¸­ï¼Œå®ƒä¼šå°†å¼•å…¥æ¨¡å—çš„é’©å­å‡½æ•°é€šè¿‡éå†å­˜å‚¨åœ¨<code class=\"language-text\">cbs</code>å˜é‡é‡Œï¼Œåé¢åœ¨æ‰§è¡Œæ›´æ–°ç®—æ³•æ—¶ä¼šç›¸åº”çš„è§¦å‘è¿™äº›é’©å­å‡½æ•°ã€‚åªéœ€è¦åˆå§‹åŒ–ä¸€æ¬¡ï¼Œåé¢ virtual dom çš„æ›´æ–°éƒ½æ˜¯é€šè¿‡<code class=\"language-text\">patch</code>æ¥å®Œæˆçš„ã€‚</p>\n<p>æµç¨‹å›¾å¦‚ä¸‹ï¼Œ</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/720190efae0f3770bf6ccfb58a5a8c47/332be/main.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 120px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 242.50000000000003%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAxCAIAAABVih7fAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD+klEQVRIx7VWWW/TQBD2T0fiL/COEA+oD0g8FSjQA6pC6N2kZxzncOMr8RnH98G3u/GRJmmDqq5GyXp2xzszO9985vI8zzL85GN72uyqp7xcSVuee+TlM15uD/UoTnM6OGqYu34Ibb7GsFxfkE12JJfRcwea7XghJnGSJmmWZtk0iMyJ74exjVlMlEQScmZPMb0goidT445keGHM3s00fdXaOuS/HfEHrUEYJw+WbDeojO9HDs4pl5kLOBKbwigpfWargmwEVMkxLdy7FcdRUrhHPc/oXkyYJk6JpWq6XaWImfxRe2cawHnEU4ogGcd3EibdUiMbomanhXdc5dJCYtM0w+sWl8pH7kE8D4y77FbqlrVt3CNXutS4Pp5nnK0YMMH1Xg9G1NPlY/nJZTG8erfziGtcT7FQITWxqTiS7vBDfbNxJ+surmd+D9vmcKi+JE0nfugFMSp2ysQP2SSKk4kXuhA/xAQy9bEakZp3Aw4oy2dllKazaGfZWry8MihScEnKtbraeUf5sN38cyUe3gzPOvJAtdr3+vapcHA5+HnRO7qV9s57f2+GP04EFBzeaTgewgH+uYuOMrKmra6qOx60mjUFBgESxZhoposlSZ9IY2c4dljkuAIAExWOGLkLQYVB4/r+6HaI9NIatuDL4e0QTqGZwAy+4Jzr/gjggYNXfe1mMALa4Lbak82Pe5fQsi5z0pbgFZxEFHC4cSXuN/u/L8WDSxEHbOy24Dwalh9GHLayhK2q8FWDJGy/OYBLiErWJxBcL5swGWiWTGOmG4o9Y2yb4Ko5ZxqabmAtE8PxEby9esMTwOgpL4eqR4yTFZ1kvZOzDDf838bswlTDffvl5DFIlruDMC7FDyIEjGPffGqgGPFYW4qjggNmTR81CPSCdJChstHiEfq+QmqW6OmSOLJbPW2ObsBdQY0ZVo2CXmyApzIGJALCVRnipGXkENwHES0GH4ADnoAqTJixUzcGkhAJyvVzo7171gUSto74r4c8UA1IfD/ubP6929hpNQV1iTFOZlSIaiUdxw/Htuf6VSeCHr+M9JAIxscVxcIGGa6ENSbabug/aT0R5WdkrqTYnHEfst1XQWWzxGLSKYhOkGcCPXxEJ6AJeqq2hXXKcykhoDzAqaxO64M21pcmOuEZkEwZJPMnjRcZHMB4/X5vPeMss2v9CWWALocGPPHIBxlTsi+z8qTKmH2sKEXfRIvEb72xQkAjYKLio6soEs0ktLJO30YWUU6sz5fAMGf+kGtM6etcEAgBuWoV/EkKFkviIqr8+c9HUByI5heI5krM5vmEGodVbY8tEts6bgMe/L3OtlUJ4yUD+Si/ACBoFwyJdUHCWEuA+T/jRgYSeg3yowAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"main\"\n        title=\"\"\n        src=\"/static/720190efae0f3770bf6ccfb58a5a8c47/332be/main.png\"\n        srcset=\"/static/720190efae0f3770bf6ccfb58a5a8c47/332be/main.png 120w\"\n        sizes=\"(max-width: 120px) 100vw, 120px\"\n      />\n  </span>\n  </a></p>\n<h3>patch</h3>\n<p>æœ€ä¸ºå¤æ‚ä¹Ÿæœ€ä¸ºè€—æ—¶çš„éƒ¨åˆ†å°±æ˜¯å¦‚ä½•å®ç° virtual dom çš„æ›´æ–°ï¼Œæ›´æ–°ç®—æ³•çš„å¥½åç›´æ¥å½±å“æ•´ä¸ªæ¡†æ¶çš„æ€§èƒ½ï¼Œæ¯”å¦‚ React ä¸­çš„ react-reconciler æ¨¡å—ï¼Œåˆ° vue ä¸­çš„ vdom æ¨¡å—ï¼Œéƒ½æ˜¯æœ€å¤§å¯èƒ½ä¼˜åŒ–è¿™ä¸€éƒ¨åˆ†ã€‚åœ¨ Snabbdom ä¸­ virtual dom çš„æ›´æ–°é€»è¾‘å¤§è‡´å¦‚ä¸‹ï¼Œ</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// è¿™ä¸ªpatchå°±æ˜¯initè¿”å›çš„</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">patch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">oldVnode<span class=\"token punctuation\">,</span> vnode</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ç¬¬ä¸€æ­¥ï¼šå¦‚æœoldVnodeæ˜¯Elementï¼Œåˆ™æ ¹æ®Elementåˆ›å»ºä¸€ä¸ªç©ºçš„vnodeï¼Œè¿™ä¸ªä¹Ÿæ˜¯vnode treeçš„æ ¹èŠ‚ç‚¹</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">isVnode</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    oldVnode <span class=\"token operator\">=</span> <span class=\"token function\">emptyAtNode</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// ç¬¬äºŒæ­¥ï¼šåˆ¤æ–­oldVnodeæ˜¯å¦ä¸vnodeç›¸åŒçš„å…ƒç´ ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ›´æ–°å…ƒç´ å³å¯ã€‚</span>\n  <span class=\"token comment\">// è¿™é‡Œåˆ¤æ–­å®ƒä»¬æ˜¯å¦ç›¸åŒï¼Œæ˜¯å¯¹æ¯”äº†å®ƒä»¬çš„keyç›¸åŒä¸”tagNameç›¸åŒä¸”IDå±æ€§ç›¸åŒä¸”ç±»ç›¸åŒ</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">sameVnode</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">,</span> vnode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">patchVnode</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">,</span> vnode<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ç¬¬ä¸‰æ­¥ï¼šå¦‚æœä¸ç›¸åŒï¼Œåˆ™ç›´æ¥ç”¨vnodeåˆ›å»ºæ–°çš„elementå…ƒç´ æ›¿æ¢oldVnodeï¼Œä¸”åˆ é™¤æ‰oldVnodeã€‚</span>\n    elm <span class=\"token operator\">=</span> oldVnode<span class=\"token punctuation\">.</span>elm\n    parent <span class=\"token operator\">=</span> api<span class=\"token punctuation\">.</span><span class=\"token function\">parentNode</span><span class=\"token punctuation\">(</span>elm<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">createElm</span><span class=\"token punctuation\">(</span>vnode<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>parent <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      api<span class=\"token punctuation\">.</span><span class=\"token function\">insertBefore</span><span class=\"token punctuation\">(</span>parent<span class=\"token punctuation\">,</span> vnode<span class=\"token punctuation\">.</span>elm<span class=\"token punctuation\">,</span> api<span class=\"token punctuation\">.</span><span class=\"token function\">nextSlibing</span><span class=\"token punctuation\">(</span>elm<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token function\">removeVnodes</span><span class=\"token punctuation\">(</span>parent<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>oldVnode<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">patch</code>é€»è¾‘å¯ä»¥ç®€åŒ–ä¸ºä¸‹é¢ï¼š</p>\n<ol>\n<li>å¦‚æœ oldVnode æ˜¯ Element ç±»å‹ï¼Œåˆ™æ ¹æ® oldVnode åˆ›å»ºä¸€ä¸ªç©º vnodeï¼Œè¿™ä¸ªç©º vnode ä¹Ÿæ˜¯è¿™ä¸ª vnode tree çš„ root èŠ‚ç‚¹</li>\n<li>æ¯”è¾ƒ oldVnode ä¸ vnodeï¼Œå¦‚æœæ˜¯åŒä¸€ä¸ª vnodeï¼ˆkey å€¼ç›¸åŒï¼‰æˆ–è€…æ˜¯ç›¸åŒç±»å‹çš„å…ƒç´ ï¼ˆtagName ç›¸åŒä¸” id ç›¸åŒä¸” class ç›¸åŒï¼‰ï¼Œåˆ™ç›´æ¥è°ƒç”¨<code class=\"language-text\">patchVnode</code></li>\n<li>å¦åˆ™ï¼Œç›´æ¥æ ¹æ® vnode åˆ›å»ºä¸€ä¸ªæ–°çš„ elementï¼Œä¸”ç”¨æ–°çš„ element æ›¿æ¢æ‰ oldVnode çš„ elementï¼Œä¸”åˆ é™¤æ‰ oldVnode</li>\n</ol>\n<p>æµç¨‹å›¾å¦‚ä¸‹ï¼Œ</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4999d84bbe5e1352efca33b220329530/df24b/structure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 269px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 196.6542750929368%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAnCAIAAACABf9ZAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC40lEQVRIx52V53KjMBSFef9H2z9bJrObbIkTNzBgigSIIsn7ScQlLhliRsYScNs550pBN+i0qAup0rJm+ElTNd1uwhWUVdsPhlku1SIumFhrM6EmGRO5qNqm64kmajcRTVupfpIxPyKrbqhUl+SkoclkN+0KDjNtjNiXaj9rPBhT1u10y4vIdbf7zHU0BrlMNHdGjvPqeZ15qo6vD1OtbT9oAvT7MWgT8CnwYhnn9SaX87io296Yd+G1gfmmVn3T9tzhhftWNME6lUWlooyw+eM8+fmKHxVuJe/wskoF3z3MNklRy6b7NU+ivFomJYrCUaC1A/k5zFZpucmrH/+iKJOkZH32JMX/m4RdDImEt2VTVoonwaE2HOP+Flyu4J5AlphkNPhlYPeo8GJUJaHsBWBvS2vpBbuH9Ig2ChVeJB9cZEupB6fvjMsLY2Ano14bEM6d5XCF5zF50IIS2kv6geBwx2DedoPx2doTGRxrpjH/rLZjkzkZaKONnaQwDIAaevte2wsTnlAU8BIfpBnM6fwAhEn1aZFC/Twuvz9H3KlwQJC7HfDgF/7XW4FUfi/SdSqe5sm3vyGcBwTEGFW/bgoU9uVxiRdkkEunR5SHo5coZ2MbBsM3i7ichRm4OIW5TtYmkw2yJG2CEPUsc+O14VRU1qQQZhJSM6kCe6IhvjjThhOMXwD14OrYAT4Fs8RjcOr+jMYzzMYNA1Ku9LOTgY98i5+xOsJe38NA7lTVZNf6DYCMkDSDfri1h9mvf8IRGOGFBaQQyVId5fVeJCQD6NyjrYQwqoIh1V7Z9C/LQSQd28XDSwz7y7h8mMWzMKfvTzV/U55kSGCkggCWiUAPV9vrujElgQSlrhLBQZcUlRPAxINuFMDI4RjQWHvfidHeeWIAeFl93viwAUp/St5z3LgG3MpLJXxkDDzCNedAu0GV6jSVU8JUqtAgwnbbRSpQMrTnlZpq3PpGwcCdGL43i2nI/Qfjc/LjXfxRFgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"structure\"\n        title=\"\"\n        src=\"/static/4999d84bbe5e1352efca33b220329530/df24b/structure.png\"\n        srcset=\"/static/4999d84bbe5e1352efca33b220329530/cf440/structure.png 148w,\n/static/4999d84bbe5e1352efca33b220329530/df24b/structure.png 269w\"\n        sizes=\"(max-width: 269px) 100vw, 269px\"\n      />\n  </span>\n  </a></p>\n<p>åœ¨è¿›è¡Œç¬¬ 3 æ­¥æ—¶ï¼Œå½“ oldVnode ä¸ vnode ä¸ç›¸åŒï¼Œæ˜¯ç›´æ¥æŠ›å¼ƒäº†æ—§çš„èŠ‚ç‚¹ï¼Œåˆ›å»ºæ–°çš„èŠ‚ç‚¹æ¥æ›¿æ¢ï¼Œåœ¨ç”¨æ–° vnode æ¥åˆ›å»ºèŠ‚ç‚¹æ—¶ä¼šæ£€æŸ¥å½“å‰ vnode æœ‰æ²¡æœ‰ childrenï¼Œå¦‚æœæœ‰ï¼Œåˆ™ä¹Ÿä¼šéå† children åˆ›å»ºå‡ºæ–°çš„ elementã€‚è¿™æ„å‘³ oldVnode ä»¥åŠåŒ…å«çš„æ‰€æœ‰å­èŠ‚ç‚¹å°†è¢«ä½œä¸ºä¸€ä¸ªæ•´ä½“è¢«æ–°çš„ vnode æ›¿æ¢ã€‚ç¤ºæ„å›¾å¦‚ä¸‹ï¼Œ</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d314eb8360980f79354cff845e8c9083/59a95/replace.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 416px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 53.605769230769226%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABb0lEQVQoz22Q207jMBCG8/6vwg03oOVQqBYERSAEWu5WidL0SJImwa5P48MwSdoSBL9Glmfm/+yxI0RcdsqybDabpWm6Xq/jOFZKYSdjTJIkZVlOp9OsE9moQoaI2nVdV6025CiKgjGW5zkA9LBzjoqc87Jr00JWqpAhwr2sD9r6Qxr2OlR8IMMgR4x6G+2arVpt+KCFXb0N3xm40uuKW+eH8E5CeSZ0z9BU9PLFYqGk6o+hRerABQxPj8BnFKsqbdSUS13z1g2dhFQSluBT47JVmXCdNII1XO+Ham8+03A1e59zPfkQYll+Te4CgntCPNH1mMVvFv7kbFU0+vARBP9VMObi3rg7sNaA+4I9wS+I1/BxYfKR89cSKtMOvoeVPufyEvHSuJsQ/PBJBNvwAuWRVxdenKr62CHrv3IHz4uYywnB+ieMQfJ/In4IbmSbMUsfwdbf4Ir91zD59WZKNHs1788hjNz2djt/BdgM4U8tLXYbsgjxsAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"replace\"\n        title=\"\"\n        src=\"/static/d314eb8360980f79354cff845e8c9083/59a95/replace.png\"\n        srcset=\"/static/d314eb8360980f79354cff845e8c9083/cf440/replace.png 148w,\n/static/d314eb8360980f79354cff845e8c9083/d2d38/replace.png 295w,\n/static/d314eb8360980f79354cff845e8c9083/59a95/replace.png 416w\"\n        sizes=\"(max-width: 416px) 100vw, 416px\"\n      />\n  </span>\n  </a></p>\n<p>å¦‚æœ B ä¸ Bâ€™ä¸ç›¸åŒï¼Œåˆ™ B åœ¨è¢« Bâ€™æ›¿æ¢çš„è¿‡ç¨‹ä¸­ï¼ŒB çš„å­èŠ‚ç‚¹ D ä¹Ÿå°±è¢« Bâ€™çš„å­èŠ‚ç‚¹ Dâ€™å’Œ Eâ€™ä¸€èµ·æ›¿æ¢æ‰äº†ã€‚</p>\n<h3>patchVnode</h3>\n<p>æˆ‘ä»¬å†æ¥çœ‹çœ‹ç¬¬ 2 æ­¥ï¼Œå¦‚æœ oldVnode ä¸ vnode ç›¸åŒï¼Œåˆ™ä¼šå¤ç”¨ä¹‹å‰å·²ç»åˆ›å»ºå¥½çš„ domï¼Œåªæ˜¯æ›´æ–°è¿™ä¸ª dom ä¸Šçš„å·®å¼‚ç‚¹ï¼Œæ¯”å¦‚ textï¼Œclassï¼Œdatalistï¼Œstyle ç­‰ã€‚è¿™ä¸ªæ˜¯åœ¨å‡½æ•°<code class=\"language-text\">patchVnode</code>ä¸­å®ç°çš„ï¼Œä¸‹é¢ä¸ºå®ƒçš„å¤§è‡´é€»è¾‘ï¼Œ</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">patchVnode</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">oldVnode<span class=\"token punctuation\">,</span> vnode</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token comment\">// è·å–oldVnodeçš„domå¯¹è±¡</span>\n  <span class=\"token keyword\">const</span> elm <span class=\"token operator\">=</span> oldVnode<span class=\"token punctuation\">.</span>elm\n  <span class=\"token comment\">// å°†vnodeçš„elmç›´æ¥æŒ‡å‘elmï¼Œå¤ç”¨oldVnodeçš„domå¯¹è±¡ï¼Œå› ä¸ºå®ƒä»¬ç±»å‹ç›¸åŒ</span>\n  vnode<span class=\"token punctuation\">.</span>elm <span class=\"token operator\">=</span> elm\n  <span class=\"token comment\">// å¦‚æœoldVnodeä¸vnodeç›¸ç­‰ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œæ ¹æœ¬ä¸ç”¨æ›´æ–°äº†</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>oldVnode <span class=\"token operator\">===</span> vnode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// å¦‚æœvnodeæ˜¯åŒ…å«textï¼Œä¸”ä¸ç­‰äºoldVnode.textï¼Œåˆ™ç›´æ¥æ›´æ–°elmçš„textContentä¸ºvnode.text</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>vnode<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> vnode<span class=\"token punctuation\">.</span>text <span class=\"token operator\">!==</span> oldVnode<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> api<span class=\"token punctuation\">.</span><span class=\"token function\">setTextContext</span><span class=\"token punctuation\">(</span>elm<span class=\"token punctuation\">,</span> vnode<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">let</span> oldCh <span class=\"token operator\">=</span> oldVnode<span class=\"token punctuation\">.</span>children <span class=\"token comment\">// è·å–oldVnodeçš„å­èŠ‚ç‚¹</span>\n  <span class=\"token keyword\">let</span> ch <span class=\"token operator\">=</span> vnode<span class=\"token punctuation\">.</span>children <span class=\"token comment\">// è·å–vnodeçš„å­èŠ‚ç‚¹</span>\n\n  <span class=\"token comment\">// å¦‚æœoldVnodeæ²¡æœ‰å­èŠ‚ç‚¹ï¼Œè€Œvnodeæœ‰å­èŠ‚ç‚¹,åˆ™æ·»åŠ vnodeçš„å­èŠ‚ç‚¹</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isUndef</span><span class=\"token punctuation\">(</span>oldCh<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>ch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// å¦‚æœoldVnodeæœ‰textå€¼ï¼Œåˆ™å…ˆå°†elmçš„textContentæ¸…ç©º</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">idDef</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      api<span class=\"token punctuation\">.</span><span class=\"token function\">setTextContext</span><span class=\"token punctuation\">(</span>elm<span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">addVnodes</span><span class=\"token punctuation\">(</span>elm<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> ch<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> ch<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// å¦‚æœoldVnodeæœ‰å­èŠ‚ç‚¹ï¼Œè€Œvnodeæ²¡æœ‰å­èŠ‚ç‚¹ï¼Œåˆ™åˆ é™¤oldVnodeçš„å­èŠ‚ç‚¹</span>\n  <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isUndef</span><span class=\"token punctuation\">(</span>ch<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>oldCh<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">reoveVnodes</span><span class=\"token punctuation\">(</span>elm<span class=\"token punctuation\">,</span> oldCh<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> oldCh<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// å¦‚æœå®ƒä»¬éƒ½æœ‰å­èŠ‚ç‚¹ï¼Œå¹¶ä¸”å­èŠ‚ç‚¹ä¸ç›¸åŒï¼Œåˆ™æ›´æ–°å®ƒä»¬çš„å­èŠ‚ç‚¹</span>\n  <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ch <span class=\"token operator\">!==</span> oldCh<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">updateChildren</span><span class=\"token punctuation\">(</span>elm<span class=\"token punctuation\">,</span> oldCh<span class=\"token punctuation\">,</span> ch<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// å¦åˆ™å°±æ˜¯å®ƒä»¬éƒ½æœ‰å­èŠ‚ç‚¹ï¼Œä¸”å­èŠ‚ç‚¹ç›¸åŒï¼Œå¦‚æœoldVnodeæœ‰textå€¼ï¼Œåˆ™å°†elmçš„textContentæ¸…ç©º</span>\n  <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">ifDef</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    api<span class=\"token punctuation\">.</span><span class=\"token function\">setTextContext</span><span class=\"token punctuation\">(</span>elm<span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">patchVnode</code>é€»è¾‘å¯ä»¥ç®€åŒ–ä¸ºä¸‹é¢ï¼š</p>\n<ol>\n<li>ç›´æ¥å°† vnode çš„ elm è®¾ç½®ä¸º oldVnode çš„ elmï¼Œä»¥è¾¾åˆ°å¤ç”¨å·²æœ‰çš„ dom å¯¹è±¡ï¼Œé¿å…äº†åˆ›å»ºæ–°çš„ dom å¯¹è±¡çš„å¼€é”€</li>\n<li>æ¯”è¾ƒ oldVnode === vnodeï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œä¸åŒæ›´æ–°ï¼Œå› ä¸ºå®ƒä»¬å°±æ˜¯åŒä¸€ä¸ªå¯¹è±¡</li>\n<li>å¦‚æœ vnode æœ‰ text å€¼ï¼Œåˆ™è¯´æ˜ elm å°±åªåŒ…å«äº†çº¯ text æ–‡æœ¬ï¼Œæ— å…¶ä»–ç±»å‹å­èŠ‚ç‚¹ï¼Œå¦‚æœå®ƒçš„å€¼ä¸ oldVnode çš„ text ä¸ç›¸åŒï¼Œåˆ™æ›´æ–° elm çš„ textContentï¼Œå¹¶è¿”å›ã€‚</li>\n<li>\n<p>è¿™ä¸€æ­¥å¼€å§‹ï¼ŒçœŸæ­£æ¯”è¾ƒå®ƒä»¬çš„ children äº†ï¼Œ</p>\n<ul>\n<li>å¦‚æœ vnode æœ‰ childrenï¼ŒoldVnode æ²¡æœ‰ childrenï¼Œå…ˆæ¸…ç©º elm çš„ textContextï¼Œå†å°† vnode çš„ children æ·»åŠ è¿›æ¥</li>\n<li>å¦‚æœ vnode æ²¡æœ‰ childrenï¼ŒoldVnode æœ‰ childrenï¼Œåˆ™ç›´æ¥åˆ é™¤ oldVnode çš„ children</li>\n<li>å¦‚æœå®ƒä»¬éƒ½æœ‰ childrenï¼Œä¸”ä¸ç›¸åŒï¼Œåˆ™æ›´æ–°å®ƒä»¬çš„ children</li>\n<li>å¦‚æœå®ƒä»¬éƒ½æœ‰ childrenï¼Œä¸”ç›¸åŒï¼Œåˆ™æ¸…ç©º elm çš„ textContext</li>\n</ul>\n</li>\n</ol>\n<p>æµç¨‹å›¾å¦‚ä¸‹ï¼Œ</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e80ee100db03233ea070370bf65d67be/60c44/patchVnode.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 106.85249709639955%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAAAsTAAALEwEAmpwYAAABzklEQVQ4y42TTU4DMQyF52ywgQ1IXIOrIRYsWaAegxUSLJCKgM5fJoljO7zEbWlRZ8QoijJOnv3Fdpo88wVK3egjcZ7/mpNWVYW4dxFirGERGUb/0Lt75+87dzeFJ9hOi0V0M/p29L3zlIgoO/fSDjcf7cX71/Vndz6425y5mUNilRq4SOFLVUT6nFuRrs7jErYL1DmPGdQsWvUgygezzohz9jGNgTAnFhss22G/SEqzkExsn4SyFCbmWewp0GbwiAzmEpAFa1g6F6wEIaY5cSYWHMLMhp0YIPA4xVQcCnzRInZMC7t/saUQ1sFqkJYw3mVrSUww7M6BGQ0CS2L4AqYW2Jqq02JfqqoLyT8MvhWDE/Zhil/9hLmcOXCBNdKGbvnup25EHsAihlnEKRVOA0Pkws6/EbBFqQDXHJfOgrqquCkFDERIke6LxLEetxRijSC2C9Ga5S2kNUoFMd7sZ+dAazBIb+8CjD4kywK2wOxrt72yXPXTWesuB/8cqIFXCBDaQlknoRmosoECbq1g+HWqK+LHQCvmb7I716seVfv4zkcVrq9se+d/iNWg9g8OlFpVjSW9NsP2rcV6kRBLk6BVULvyPPYPs5YNBmz9AIGp0lKX3ASTAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"patchVnode\"\n        title=\"\"\n        src=\"/static/e80ee100db03233ea070370bf65d67be/b9e4f/patchVnode.png\"\n        srcset=\"/static/e80ee100db03233ea070370bf65d67be/cf440/patchVnode.png 148w,\n/static/e80ee100db03233ea070370bf65d67be/d2d38/patchVnode.png 295w,\n/static/e80ee100db03233ea070370bf65d67be/b9e4f/patchVnode.png 590w,\n/static/e80ee100db03233ea070370bf65d67be/60c44/patchVnode.png 861w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<p>åœ¨<code class=\"language-text\">patchVnode</code>æ›´æ–°æ—¶ï¼Œvnode ä¼šå…ˆæ˜¯é€šè¿‡è§¦å‘å®šä¹‰åœ¨ data æ•°æ®ä¸Šçš„é’©å­å‡½æ•°æ¥æ›´æ–°è‡ªå·±èŠ‚ç‚¹ä¸Šçš„ä¿¡æ¯ï¼Œæ¯”å¦‚ class æˆ–è€… styles ç­‰ï¼Œç„¶åå†å»æ›´æ–° children èŠ‚ç‚¹ä¿¡æ¯ã€‚</p>\n<h3>updateChildren</h3>\n<p>æ›´æ–° vnode.children ä¿¡æ¯æ˜¯é€šè¿‡<code class=\"language-text\">updateChildren</code>å‡½æ•°æ¥å®Œæˆçš„ã€‚åªæœ‰å½“ oldVnode ä¸Šå­˜åœ¨ childrenï¼Œä¸” vnode ä¸Šä¹Ÿå­˜åœ¨ children æ—¶ï¼Œå¹¶ä¸”<code class=\"language-text\">oldVnode.children !== vnode.children</code>æ—¶ï¼Œæ‰ä¼šå»è°ƒç”¨<code class=\"language-text\">updateChildren</code>ã€‚ä¸‹é¢æ¥æ¢³ç†ä¸€ä¸‹<code class=\"language-text\">updateChildren</code>çš„å¤§è‡´é€»è¾‘ï¼Œ</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">updateChildren</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">parentElm<span class=\"token punctuation\">,</span> oldCh<span class=\"token punctuation\">,</span> newCh</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// æ—§çš„children</span>\n  <span class=\"token keyword\">let</span> oldStartIdx <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n  <span class=\"token keyword\">let</span> oldEndIdx <span class=\"token operator\">=</span> oldCh<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span>\n  <span class=\"token keyword\">let</span> oldStartVnode <span class=\"token operator\">=</span> oldCh<span class=\"token punctuation\">[</span>oldStartIdx<span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">let</span> oldEndVnode <span class=\"token operator\">=</span> <span class=\"token function\">oldCh</span><span class=\"token punctuation\">(</span>oldEndIdx<span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// æ–°çš„children</span>\n  <span class=\"token keyword\">let</span> newStartIdx <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n  <span class=\"token keyword\">let</span> newEndIdx <span class=\"token operator\">=</span> newCh<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span>\n  <span class=\"token keyword\">let</span> newStartVnode <span class=\"token operator\">=</span> <span class=\"token function\">newCh</span><span class=\"token punctuation\">(</span>newStartIdx<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">let</span> newEndVnode <span class=\"token operator\">=</span> <span class=\"token function\">newCh</span><span class=\"token punctuation\">(</span>newEndIdx<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">let</span> before <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n\n  <span class=\"token comment\">// å¾ªç¯æ¯”è¾ƒ</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>oldStartIdx <span class=\"token operator\">&lt;=</span> oldEndIdx <span class=\"token operator\">&amp;&amp;</span> newStartIdx <span class=\"token operator\">&lt;=</span> newEndIdx<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>oldStartVnode <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// å½“å‰èŠ‚ç‚¹å¯èƒ½è¢«ç§»åŠ¨äº†</span>\n      oldStartVnode <span class=\"token operator\">=</span> oldCh<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>oldStartIdx<span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>oldEndVnode <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      oldEndVnode <span class=\"token operator\">=</span> oldCh<span class=\"token punctuation\">[</span><span class=\"token operator\">--</span>oldEndIdx<span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>newStartVnode <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      newStartVnode <span class=\"token operator\">=</span> newCh<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>newStartIdx<span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>newEndVnode <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      newEndVnode <span class=\"token operator\">=</span> newCh<span class=\"token punctuation\">[</span><span class=\"token operator\">--</span>newEndIdx<span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">sameVnode</span><span class=\"token punctuation\">(</span>oldStartVnode<span class=\"token punctuation\">,</span> newStartVnode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">patchVnode</span><span class=\"token punctuation\">(</span>oldStartVnode<span class=\"token punctuation\">,</span> newStartVnode<span class=\"token punctuation\">)</span> <span class=\"token comment\">// æ›´æ–°newStartVnode</span>\n      oldStartVnode <span class=\"token operator\">=</span> oldCh<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>oldStartIdx<span class=\"token punctuation\">]</span> <span class=\"token comment\">// oldStartIdx å‘å³ç§»åŠ¨</span>\n      newStartVnode <span class=\"token operator\">=</span> newCh<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>newStartIdx<span class=\"token punctuation\">]</span> <span class=\"token comment\">// newStartIdx å‘å³ç§»åŠ¨</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">sameVnode</span><span class=\"token punctuation\">(</span>oldEndVnode<span class=\"token punctuation\">,</span> newEndVnode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">patchVnode</span><span class=\"token punctuation\">(</span>oldEndVnode<span class=\"token punctuation\">,</span> newEndVnode<span class=\"token punctuation\">)</span> <span class=\"token comment\">// æ›´æ–°newEndVnode</span>\n      oldEndVnode <span class=\"token operator\">=</span> oldCh<span class=\"token punctuation\">[</span><span class=\"token operator\">--</span>oldEndIdx<span class=\"token punctuation\">]</span> <span class=\"token comment\">// oldEndIdx å‘å·¦ç§»åŠ¨</span>\n      newEndVnode <span class=\"token operator\">=</span> newCh<span class=\"token punctuation\">[</span><span class=\"token operator\">--</span>newEndIdx<span class=\"token punctuation\">]</span> <span class=\"token comment\">// newEndIdx å‘å·¦ç§»åŠ¨</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">sameVnode</span><span class=\"token punctuation\">(</span>oldStartVnode<span class=\"token punctuation\">,</span> newEndVnode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">patchVnode</span><span class=\"token punctuation\">(</span>oldStartVnode<span class=\"token punctuation\">,</span> newEndVnode<span class=\"token punctuation\">)</span> <span class=\"token comment\">//æ›´æ–°newEndVnode</span>\n      <span class=\"token keyword\">let</span> oldAfterVnode <span class=\"token operator\">=</span> api<span class=\"token punctuation\">.</span><span class=\"token function\">nextSibling</span><span class=\"token punctuation\">(</span>oldEndVnode<span class=\"token punctuation\">)</span>\n      <span class=\"token comment\">// å°†oldStartVnodeç§»åŠ¨åˆ°å½“å‰oldEndVnodeåé¢</span>\n      api<span class=\"token punctuation\">.</span><span class=\"token function\">insertBefore</span><span class=\"token punctuation\">(</span>parentElm<span class=\"token punctuation\">,</span> oldStartVnode<span class=\"token punctuation\">.</span>elm<span class=\"token punctuation\">,</span> oldAfterVnode<span class=\"token punctuation\">)</span>\n      oldStartVnode <span class=\"token operator\">=</span> oldCh<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>oldStartIdx<span class=\"token punctuation\">]</span> <span class=\"token comment\">// oldStartIdx å‘å³ç§»åŠ¨</span>\n      newEndVnode <span class=\"token operator\">=</span> newCh<span class=\"token punctuation\">[</span><span class=\"token operator\">--</span>newOldVnode<span class=\"token punctuation\">]</span> <span class=\"token comment\">// newEndIdx å‘å·¦ç§»åŠ¨</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">sameVnode</span><span class=\"token punctuation\">(</span>oldEndVnode<span class=\"token punctuation\">,</span> newStartVnode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">patchVnode</span><span class=\"token punctuation\">(</span>oldEndVnode<span class=\"token punctuation\">,</span> newStartVnode<span class=\"token punctuation\">)</span> <span class=\"token comment\">// æ›´æ–°newStartVnode</span>\n      <span class=\"token comment\">//å°†oldEndVnodeç§»åŠ¨åˆ°oldStartVnodeå‰é¢</span>\n      api<span class=\"token punctuation\">.</span><span class=\"token function\">insertBefore</span><span class=\"token punctuation\">(</span>parentElm<span class=\"token punctuation\">,</span> oldEndVnode<span class=\"token punctuation\">.</span>elm<span class=\"token punctuation\">,</span> oldStartVnode<span class=\"token punctuation\">.</span>elm<span class=\"token punctuation\">)</span>\n      oldEndVnode <span class=\"token operator\">=</span> oldCh<span class=\"token punctuation\">[</span><span class=\"token operator\">--</span>oldEndIdx<span class=\"token punctuation\">]</span> <span class=\"token comment\">// oldEndVnode å‘å³ç§»åŠ¨</span>\n      newStartVnode <span class=\"token operator\">=</span> newCh<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>newStartIdx<span class=\"token punctuation\">]</span> <span class=\"token comment\">// newStartVnode å‘å·¦ç§»åŠ¨</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">//è·å–å½“å‰æ—§çš„childrençš„èŠ‚ç‚¹çš„keyä¸å…¶indexçš„å¯¹åº”å€¼ï¼Œ</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>oldKeyIdx <span class=\"token operator\">==</span> undefined<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        oldKeyIdx <span class=\"token operator\">=</span> <span class=\"token function\">createKeyToOldIdx</span><span class=\"token punctuation\">(</span>oldCh<span class=\"token punctuation\">,</span> oldStartIdx<span class=\"token punctuation\">,</span> oldEndIdx<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token comment\">//è·å–å½“å‰newStartVnodeçš„keyæ˜¯å¦å­˜åœ¨æ—§çš„childrenæ•°ç»„é‡Œ</span>\n      idxInOld <span class=\"token operator\">=</span> oldKeyIdx<span class=\"token punctuation\">[</span>newStartVnode<span class=\"token punctuation\">.</span>key<span class=\"token punctuation\">]</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isUndef</span><span class=\"token punctuation\">(</span>idxInOld<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//å¦‚æœå½“å‰newStartVnodeçš„keyä¸å­˜åœ¨æ—§çš„childrenæ•°ç»„é‡Œï¼Œé‚£ä¹ˆè¿™ä¸ªnewStartVnodeå°±æ˜¯æ–°çš„ï¼Œéœ€è¦æ–°å»ºdom</span>\n        <span class=\"token keyword\">let</span> newDom <span class=\"token operator\">=</span> <span class=\"token function\">createElm</span><span class=\"token punctuation\">(</span>newStartVnode<span class=\"token punctuation\">)</span>\n        api<span class=\"token punctuation\">.</span><span class=\"token function\">insertBefore</span><span class=\"token punctuation\">(</span>parentElm<span class=\"token punctuation\">,</span> newDom<span class=\"token punctuation\">,</span> oldStartVnode<span class=\"token punctuation\">.</span>elm<span class=\"token punctuation\">)</span>\n        newStartVnode <span class=\"token operator\">=</span> newCh<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>newStartIdx<span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//å¦åˆ™ï¼Œå½“å‰newStartVnodeçš„keyå­˜åœ¨æ—§çš„childrené‡Œï¼Œè¯´æ˜å®ƒä»¬ä¹‹å‰æ˜¯åŒä¸€ä¸ªVnode,</span>\n        elmToMove <span class=\"token operator\">=</span> oldCh<span class=\"token punctuation\">[</span>idxInOld<span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>elmToMove<span class=\"token punctuation\">.</span>sel <span class=\"token operator\">!==</span> newStartVnode<span class=\"token punctuation\">.</span>sel<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">//èŠ‚ç‚¹ç±»å‹å˜äº†ï¼Œä¸æ˜¯åŒä¸€ä¸ªç±»å‹çš„domå…ƒç´ äº†,ä¹Ÿæ˜¯éœ€è¦æ–°å»ºçš„</span>\n          <span class=\"token keyword\">let</span> newDom <span class=\"token operator\">=</span> <span class=\"token function\">createElm</span><span class=\"token punctuation\">(</span>newStartVnode<span class=\"token punctuation\">)</span>\n          api<span class=\"token punctuation\">.</span><span class=\"token function\">insertBefore</span><span class=\"token punctuation\">(</span>parentElm<span class=\"token punctuation\">,</span> newDom<span class=\"token punctuation\">,</span> oldStartVnode<span class=\"token punctuation\">.</span>elm<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// å¦åˆ™ï¼Œå®ƒä»¬æ˜¯åŒä¸€ä¸ªVnodeä¸”domå…ƒç´ ä¹Ÿç›¸åŒï¼Œåˆ™ä¸éœ€è¦æ–°å»ºï¼Œåªéœ€è¦æ›´æ–°å³å¯</span>\n          <span class=\"token function\">patchVnode</span><span class=\"token punctuation\">(</span>elmToMove<span class=\"token punctuation\">,</span> newStartVnode<span class=\"token punctuation\">)</span>\n          oldCh<span class=\"token punctuation\">[</span>idxInOld<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> undefined <span class=\"token comment\">// æ ‡å¿—æ—§çš„childrenå½“å‰ä½ç½®çš„å…ƒç´ è¢«ç§»èµ°äº†ï¼Œ</span>\n          api<span class=\"token punctuation\">.</span><span class=\"token function\">insertBefore</span><span class=\"token punctuation\">(</span>parentElm<span class=\"token punctuation\">,</span> elmToMove<span class=\"token punctuation\">,</span> oldStartVnode<span class=\"token punctuation\">.</span>elm<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        newStartVnode <span class=\"token operator\">=</span> newCh<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>newStartIdx<span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// å¦‚æœå¾ªç¯ä¹‹åï¼Œè¿˜æœ‰æœªå¤„ç†çš„childrenï¼Œ</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>oldStartIdx <span class=\"token operator\">&lt;=</span> oldEndIdx <span class=\"token operator\">||</span> newStartIdx <span class=\"token operator\">&lt;=</span> newEndIdx<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// å¦‚æœæ–°çš„childrenè¿˜æœ‰éƒ¨åˆ†æœªå¤„ç†ï¼Œåˆ™æŠŠå¤šçš„éƒ¨åˆ†å¢åŠ è¿›å»</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>oldStartIdx <span class=\"token operator\">></span> oldEndIdx<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      before <span class=\"token operator\">=</span> newCh<span class=\"token punctuation\">[</span>newEndIdx <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">?</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">:</span> newCh<span class=\"token punctuation\">[</span>newEndIdx <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n      <span class=\"token function\">addVnodes</span><span class=\"token punctuation\">(</span>parentElm<span class=\"token punctuation\">,</span> before<span class=\"token punctuation\">,</span> newCh<span class=\"token punctuation\">,</span> newStartIdx<span class=\"token punctuation\">,</span> newEndIdx<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">//å¦‚æœæ—§çš„childrenè¿˜æœ‰æœªå¤„ç†ï¼Œåˆ™æŠŠå¤šçš„éƒ¨åˆ†åˆ é™¤æ‰</span>\n      <span class=\"token function\">removeVnodes</span><span class=\"token punctuation\">(</span>parentElm<span class=\"token punctuation\">,</span> oldCh<span class=\"token punctuation\">,</span> oldStartIdx<span class=\"token punctuation\">,</span> oldEndIdx<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">updateChildren</code>å‡½æ•°é€»è¾‘å¯ä»¥ç®€åŒ–ä¸ºï¼Œ</p>\n<ol>\n<li>åˆå§‹åŒ–å¾ªç¯å˜é‡</li>\n<li>æ ¹æ®å˜é‡å¾ªç¯éå† old children ä¸ new childrenï¼Œå¹¶é€ä¸ªæ¯”è¾ƒæ›´æ–°ï¼Œå½“ç±»å‹ç›¸åŒæ—¶ï¼Œåˆ™è°ƒç”¨<code class=\"language-text\">patchVnode</code>æ›´æ–°ï¼Œå½“ç±»å‹ä¸åŒæ—¶ï¼Œåˆ™ç›´æ¥æ–°å»º new vnode çš„ dom å…ƒç´ ï¼Œå¹¶æ’å…¥åˆ°åˆé€‚çš„ä½ç½®</li>\n<li>å¾ªç¯å®Œäº†ä¹‹åï¼Œå¢åŠ æ–°å¢çš„ new vnode èŠ‚ç‚¹å’Œç§»é™¤æ—§çš„å†—ä½™çš„ old vnode</li>\n</ol>\n<p>æµç¨‹å›¾å¦‚ä¸‹ï¼Œ</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9014e691bff7fad272912e7dcd597b1f/afda5/updateChildren.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 109.6728307254623%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAIAAABPIytRAAAACXBIWXMAAAsTAAALEwEAmpwYAAACCElEQVQ4y5VUS47TQBT0lRDSCFYI9lwAIVhzHljAhiOgWXEEFkhIXAEpyQyM8/GnP+9rqpMY4skkA61W27JdXe9VVbsa7hrmHjNv+hRJ3H04MapTL1QtZFY9iTwHxiDW4ey4A6zmJNpFmt80kTgLHvi/gs0cyFndXi27xbINif8DrKqrTbiq27oJ16tu3Se/H+yDslDmnLmsibo+YqcpUg/nCHZnYNCr2fjA+8TlIuJ2htmMiQG8ZRWs3u+lCuvNheWz6CfRS0zWywI2VCvyt3xwRoJaaHix7CCemAlZH1chP0v0IOSLNlyQPKywq4jKtDDeWtWGjAm3wQ/uGDchv4n5RZ9edfF1ppeVC2RSQ81qhdTKWugHI2GswzCqAArr3NvMa7MGhlaoGWBZN7xupGm5abULu68TTeTxUXkZ816BF7JMT0Um+cb6tUtfsBJ/hxUFjPQYyK3kpmjkB+Cym20bnl0vn87rxz9+PpnXjxb1c9HVFqxoPZFsugQj/IjZt9neZHof8rtf6w8hv0300SzuenbfF7y7VFuf7DgAeMtyu+dhmlNYZVTk9kOfWeGPNH2ADbjfyW8iRwnDU57EC65it1UbZzcN2qMSM4RUj4/HPp5CzEXIoijK6BMtm4DfECYUQoxKQk+eKmSIuRiuBiZ8/6eRcjBU7z2S2wMEkrE8RzEsw+kf4G+egwXRoay62AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"updateChildren\"\n        title=\"\"\n        src=\"/static/9014e691bff7fad272912e7dcd597b1f/b9e4f/updateChildren.png\"\n        srcset=\"/static/9014e691bff7fad272912e7dcd597b1f/cf440/updateChildren.png 148w,\n/static/9014e691bff7fad272912e7dcd597b1f/d2d38/updateChildren.png 295w,\n/static/9014e691bff7fad272912e7dcd597b1f/b9e4f/updateChildren.png 590w,\n/static/9014e691bff7fad272912e7dcd597b1f/afda5/updateChildren.png 703w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<p>åœ¨<code class=\"language-text\">updateChildren</code>å‡½æ•°ä¸­ï¼Œé€ä¸ªæ›´æ–° children ä¸­èŠ‚ç‚¹æ—¶ï¼Œå½“æ¯”è¾ƒçš„ä¸¤ä¸ªèŠ‚ç‚¹ç±»å‹ç›¸åŒæ—¶ï¼Œåˆä¼šåè¿‡æ¥è°ƒç”¨<code class=\"language-text\">patchVnode</code>æ¥æ›´æ–°èŠ‚ç‚¹ï¼Œè¿™æ ·ï¼Œå®é™…ä¸Šå­˜åœ¨äº†é—´æ¥çš„é€’å½’è°ƒç”¨ã€‚</p>\n<h3>life cycle hooks</h3>\n<p>åœ¨ä½¿ç”¨ React æˆ–è€… Vue æ—¶ï¼Œä½ ä¼šå‘ç°å®ƒä»¬éƒ½åˆ†åˆ«å®šä¹‰äº†ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œè™½ç„¶åç§°æˆ–è§¦å‘æ—¶æœºä¸å®Œå…¨ç›¸åŒï¼Œä½†æ˜¯åŸºæœ¬çš„é¡ºåºå’Œç›®çš„æ˜¯å·®ä¸å¤šçš„ã€‚Snabbdom ä¹Ÿæä¾›äº†ç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼Œä¸åŒçš„æ˜¯å®ƒæä¾›äº† 2 å¥—ï¼Œä¸€å¥—æ˜¯é’ˆå¯¹ virtual dom çš„ï¼Œæ¯”å¦‚ä¸€ä¸ª Vnode çš„<code class=\"language-text\">create</code>,<code class=\"language-text\">update</code>,<code class=\"language-text\">remove</code>ç­‰ï¼›ä¸€å¥—æ˜¯é’ˆå¯¹ modules çš„ï¼Œé€šè¿‡åœ¨ä¸åŒæ—¶æœºè§¦å‘ä¸åŒ module çš„é’©å­å‡½æ•°å»å®Œæˆå½“å‰ Vnode çš„æ›´æ–°æ“ä½œã€‚</p>\n<p>modules çš„ä¸Šçš„é’©å­å‡½æ•°å¦‚ä¸‹,</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Module</span> <span class=\"token punctuation\">{</span>\n  pre<span class=\"token punctuation\">:</span> PreHook\n  create<span class=\"token punctuation\">:</span> CreateHook\n  update<span class=\"token punctuation\">:</span> UpdateHook\n  destroy<span class=\"token punctuation\">:</span> DestroyHook\n  remove<span class=\"token punctuation\">:</span> RemoveHook\n  post<span class=\"token punctuation\">:</span> PostHook\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>å®ƒçš„è§¦å‘æ—¶æœºå›¾å¦‚ä¸‹ï¼Œ</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/49caa1ff4e35f00e776cda82c9004a9f/4f3bc/module_hooks.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 112.9360465116279%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAIAAACEf/j0AAAACXBIWXMAAAsTAAALEwEAmpwYAAADbUlEQVQ4y4VU329UVRDeP8ekCUFAKEhpayplSyGkGqMPYioPEEAD0lqoUVTQuKgxiKClhoqakNqEBAOaUBMhRH3Ql4ZIBIV0t9uyWdZtd3t37z3z4xvP3nYLFtB7z8s5Z7755pszMwl7yMeiQUilIIyIH2aTeNChmolfjl0lDAGZ25rhv8ESI+s+YCT33mKRi8S/CQ0wwR3Wy4JB0req9Lrah4xzghsKrpvpvWDENB72J+shwSaz1UCL4x2VcI/iKbNVilbW7azfK6QOqTPDK8MAbCWswWyF2XLmrko4Vq5kIjoKLDU0GpYADYJtivRcCIm6tg+InxfpNekzvGraI7KvGvWVg37iHkWvmV99wH7inY63Cf6aZ2YdYlnjKMuwcyGnirNngqgcS5M4xsxN9+1w9fxIkMtGfhu5/YouQTUhSCueIG03yZwy2xmUjuUm95ZnUl4basImczj58fTZ0/mzQ7nBT4qFaR/pO2aPkHyeYP3MiyTtNEn3w044dy3iYce7xZeJB+Pq7zwwKNdvuT9u0rHjfGvcOzxktkzwnAd3mzayJD1zVm2XcxtYtxKPxRHHz4ALo3w4RYdT7scr5A8dve35gGSCZb3lV0nUzpqJH1HL8y9erwxlK0WaM50xCwK/I/bgx4A2z5w0axLZwMhI2arH/3b7iuFwSWLBNdmwSzPfvVHc81HhYDa4UUsYvxmDn/Tg7b4GRDrIxukgygdy05/mgpcLdIp9sv1/0X7onn12cOroian3X5vdW7RQ2SdseRy2fmn2qGonyQTvtui0VseMUkbveWANfgYjL8iOn3hsVH7ZJa9MoWh8xGyJYGtCcUexUaUtst+ia7fDF8cpORH2pl1hgi3LNBlx+gj1dPCyLlo7Sl8Zl0LqN2sgHZkrkgvACtWkYKNPAbmkWIciydIeUbsPz/QZJ+tFNps+LboJWMn6ki/yxFxLsH4BX9K6xtBits50HbTFUWdQ3aJoU3vcrBnWotZktlTUl2dhoTHE40kvCrbUGkA9vpmku+puB6Fz9DWwFtYKW61oYn1XUbrbGAvNrMizDvjSAZoVjY42V0IfZyvQCHSyHhD9FfP9iEXDAPUBEgmuCs6TDlXppNo3gp8Fedw1wwPHEBamRG02qIW06Bb/OwBr9KKczU9fn8gHYRh7xP1G/wBQNsPpLeECLwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"modules_hook\"\n        title=\"\"\n        src=\"/static/49caa1ff4e35f00e776cda82c9004a9f/b9e4f/module_hooks.png\"\n        srcset=\"/static/49caa1ff4e35f00e776cda82c9004a9f/cf440/module_hooks.png 148w,\n/static/49caa1ff4e35f00e776cda82c9004a9f/d2d38/module_hooks.png 295w,\n/static/49caa1ff4e35f00e776cda82c9004a9f/b9e4f/module_hooks.png 590w,\n/static/49caa1ff4e35f00e776cda82c9004a9f/4f3bc/module_hooks.png 688w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<p>åœ¨è§¦å‘ modules çš„ hooks å‡½æ•°æ—¶ï¼Œä¸åŒçš„å‡½æ•°ä¼šæ¥å—ä¸åŒçš„å‚æ•°ï¼Œä¸‹é¢ä¸º modukes ä¸­é’©å­å‡½æ•°æ¥å—å‚æ•°æƒ…å†µï¼Œ</p>\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Triggered when</th>\n<th>Arguments to callback</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code class=\"language-text\">pre</code></td>\n<td>åœ¨<code class=\"language-text\">patch</code>å‡½æ•°å¼€å§‹å¤„</td>\n<td>æ— </td>\n</tr>\n<tr>\n<td><code class=\"language-text\">create</code></td>\n<td>åœ¨<code class=\"language-text\">createElm</code>å‡½æ•°ä¸­åˆ›å»ºä¸€ä¸ª element æ—¶</td>\n<td><code class=\"language-text\">vnode</code></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">update</code></td>\n<td>åœ¨<code class=\"language-text\">pathVnode</code>å‡½æ•°ä¸­æ›´æ–° Vnode æ—¶ï¼Œ</td>\n<td><code class=\"language-text\">oldVnode</code>ï¼Œ<code class=\"language-text\">newVnode</code></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">destroy</code></td>\n<td>åœ¨<code class=\"language-text\">removeVnodes</code>å‡½æ•°ä¸­ç§»é™¤ Vnode æ—¶ï¼Œ</td>\n<td><code class=\"language-text\">vnode</code></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">remove</code></td>\n<td>åœ¨<code class=\"language-text\">removeVnodes</code>å‡½æ•°ä¸­ç§»é™¤ Vnode æ—¶ï¼Œ</td>\n<td><code class=\"language-text\">vnode</code>ï¼Œ<code class=\"language-text\">removeCallback</code></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">post</code></td>\n<td>åœ¨<code class=\"language-text\">patch</code>å‡½æ•°æœ€åå¤„ï¼Œ</td>\n<td>æ— </td>\n</tr>\n</tbody>\n</table>\n<p>å¤§éƒ¨åˆ† module ä¸­éƒ½æ²¡æœ‰å®šä¹‰<code class=\"language-text\">pre</code>å‡½æ•°å’Œ<code class=\"language-text\">post</code>å‡½æ•°ï¼Œä¸»è¦æ˜¯åœ¨<code class=\"language-text\">create</code>ï¼Œ<code class=\"language-text\">update</code>ï¼Œ <code class=\"language-text\">destory</code>ï¼Œ<code class=\"language-text\">remove</code>ä¸­å¯¹å½“å‰ Vnode è¿›è¡Œæ“ä½œã€‚æ¯”å¦‚ï¼Œåœ¨ class module ä¸­åœ¨<code class=\"language-text\">create</code>å‡½æ•°å†…å¯¹ Vnode ä¸Šçš„æ“ä½œå¦‚ä¸‹ï¼Œ</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// class modules ä¸­åœ¨createé’©å­å‡½æ•°ä¸­å¯¹å½“å‰Vnodeæ“ä½œ</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">updateClass</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">oldVnode<span class=\"token punctuation\">:</span> VNode<span class=\"token punctuation\">,</span> vnode<span class=\"token punctuation\">:</span> VNode</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> cur<span class=\"token punctuation\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span>\n    name<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n    elm<span class=\"token punctuation\">:</span> Element <span class=\"token operator\">=</span> vnode<span class=\"token punctuation\">.</span>elm <span class=\"token keyword\">as</span> Element<span class=\"token punctuation\">,</span>\n    oldClass <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">.</span>data <span class=\"token keyword\">as</span> VNodeData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// æ—§çš„class</span>\n    klass <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>vnode<span class=\"token punctuation\">.</span>data <span class=\"token keyword\">as</span> VNodeData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span> <span class=\"token comment\">// æ–°çš„class</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>oldClass <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>klass<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token comment\">// éƒ½ä¸å­˜åœ¨class,ç›´æ¥è¿”å›</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>oldClass <span class=\"token operator\">===</span> klass<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token comment\">// ç›¸ç­‰ï¼Œç›´æ¥è¿”å›</span>\n  oldClass <span class=\"token operator\">=</span> oldClass <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  klass <span class=\"token operator\">=</span> klass <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// åˆ é™¤é‚£äº›å­˜åœ¨oldVnodeä¸Šè€Œä¸å­˜åœ¨vnodeä¸Šçš„</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>name <span class=\"token keyword\">in</span> oldClass<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>klass<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      elm<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// éå†å½“å‰vnodeä¸Šçš„classï¼Œ</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>name <span class=\"token keyword\">in</span> klass<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    cur <span class=\"token operator\">=</span> klass<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span>\n    <span class=\"token comment\">//å¦‚æœä¸æƒ³ç­‰</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cur <span class=\"token operator\">!==</span> oldClass<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// å¦‚æœå€¼ä¸ºtrueï¼Œåˆ™æ·»åŠ classï¼Œå¦åˆ™ç§»é™¤class</span>\n      <span class=\"token punctuation\">;</span><span class=\"token punctuation\">(</span>elm<span class=\"token punctuation\">.</span>classList <span class=\"token keyword\">as</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>cur <span class=\"token operator\">?</span> <span class=\"token string\">\"add\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">\"remove\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>å…¶ä»– module çš„å…¶ä»– hook å‡½æ•°ä¹Ÿéƒ½ä¼šå¯¹å½“å‰ vnode æ›´æ–°ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ã€‚</p>\n<p>æˆ‘ä»¬å†æ¥çœ‹çœ‹å¯¹ Vnode ä¸Šçš„é’©å­å‡½æ•°å¦‚ä¸‹ï¼Œ</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Hooks</span> <span class=\"token punctuation\">{</span>\n  init<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> InitHook\n  create<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> CreateHook\n  insert<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> InsertHook\n  prepatch<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> PrePatchHook\n  update<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> UpdateHook\n  postpatch<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> PostPatchHook\n  destroy<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> DestroyHook\n  remove<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> RemoveHook\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>å®ƒçš„è§¦å‘æ—¶æœºä»¥åŠæ¥å—å‚æ•°æƒ…å†µå¦‚ä¸‹ï¼Œ</p>\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Triggered when</th>\n<th>Arguments to callback</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code class=\"language-text\">init</code></td>\n<td>åœ¨<code class=\"language-text\">createElm</code>æ—¶ä¼šå…ˆè§¦å‘<code class=\"language-text\">init</code></td>\n<td><code class=\"language-text\">vnode</code></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">create</code></td>\n<td>åœ¨<code class=\"language-text\">createElm</code>æ—¶ï¼Œå·²ç»å»ºå¥½äº† elementï¼Œå·²ç»å¯¹åº”çš„ children éƒ½åˆ›å»ºå®Œæ¯•ï¼Œä¹‹ååœ¨è§¦å‘<code class=\"language-text\">create</code></td>\n<td><code class=\"language-text\">emptyVnode</code>ï¼Œ<code class=\"language-text\">vnode</code></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">insert</code></td>\n<td>å½“<code class=\"language-text\">vnode.elm</code>å·²ç»æ›´æ–°åˆ° dom æ–‡æ¡£ä¸Šäº†ï¼Œæœ€ååœ¨<code class=\"language-text\">patch</code>å‡½æ•°ç»“å°¾å¤„è§¦å‘</td>\n<td><code class=\"language-text\">vnode</code></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">prepatch</code></td>\n<td>åœ¨<code class=\"language-text\">patchVnode</code>å¼€å§‹å¤„å°±è§¦å‘äº†<code class=\"language-text\">prepatch</code></td>\n<td><code class=\"language-text\">oldVnode</code>ï¼Œ<code class=\"language-text\">vnode</code></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">update</code></td>\n<td>åœ¨<code class=\"language-text\">patchVnode</code>ä¸­ï¼Œ<code class=\"language-text\">vnode.elm=oldVnode.elm</code>ä¹‹åï¼Œæ›´æ–° children ä¹‹å‰è§¦å‘</td>\n<td><code class=\"language-text\">oldVnode</code>ï¼Œ<code class=\"language-text\">vnode</code></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">postpatch</code></td>\n<td>åœ¨<code class=\"language-text\">patchVnode</code>ä¸­ç»“å°¾å¤„ï¼Œå·²ç»æ›´æ–°ä¸º children åè§¦å‘ï¼Œ</td>\n<td><code class=\"language-text\">oldvnode</code>ï¼Œ<code class=\"language-text\">vnode</code></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">destroy</code></td>\n<td>åœ¨<code class=\"language-text\">removeVnodes</code>ä¸­è§¦å‘ï¼Œæ­¤æ—¶è¿˜æ²¡æœ‰è¢«ç§»é™¤</td>\n<td><code class=\"language-text\">vnode</code></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">remove</code></td>\n<td>åœ¨<code class=\"language-text\">removeVnodes</code>ä¸­ï¼Œ<code class=\"language-text\">destroy</code>ä¹‹åè§¦å‘ï¼Œæ­¤æ—¶è¿˜æ²¡æœ‰çœŸæ­£è¢«ç§»é™¤ï¼Œéœ€è°ƒç”¨<code class=\"language-text\">removeCallback</code>æ‰çœŸæ­£å°† element ç§»é™¤</td>\n<td><code class=\"language-text\">vnode</code>ï¼Œ<code class=\"language-text\">removeCallback</code></td>\n</tr>\n</tbody>\n</table>\n<p>åœ¨<code class=\"language-text\">Vnode</code>ä¸Šçš„é’©å­å‡½æ•°å°±æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„äº†ï¼Œå®šä¹‰åœ¨<code class=\"language-text\">data.hooks</code>ä¸­ï¼Œä¾‹å¦‚ï¼Œ</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token function\">h</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"div.row\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  key<span class=\"token punctuation\">:</span> movie<span class=\"token punctuation\">.</span>rank<span class=\"token punctuation\">,</span>\n  hook<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">insert</span><span class=\"token punctuation\">:</span> <span class=\"token parameter\">vnode</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      movie<span class=\"token punctuation\">.</span>elmHeight <span class=\"token operator\">=</span> vnode<span class=\"token punctuation\">.</span>elm<span class=\"token punctuation\">.</span>offsetHeight\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>å°ç»“</h3>\n<p>åœ¨çœ‹äº†æºç ä¹‹åï¼Œå…¶å®æœ€ä¸ºå¤æ‚çš„åœ°æ–¹å°±æ˜¯<code class=\"language-text\">updateChildren</code>ä¸­æ›´æ–°å­èŠ‚ç‚¹ï¼Œè¿™é‡Œä¸ºäº†é¿å…é‡å¤åˆ›å»º elementï¼Œè€Œåšäº†å¾ˆå¤šçš„åˆ¤æ–­å’Œæ¯”è¾ƒï¼Œä»¥è¾¾åˆ°æœ€å¤§åŒ–çš„å¤ç”¨ä¹‹å‰å·²ç»åˆ›å»ºå¥½çš„ elementã€‚ä¸ React å’Œ Vue ç±»ä¼¼ï¼Œå®ƒåœ¨æ¯”è¾ƒä¸­ä¹Ÿæ·»åŠ äº†<code class=\"language-text\">key</code>æ¥ä¼˜åŒ–è¿™ä¸€ç‚¹ã€‚åœ¨æ›´æ–° Vnode å¯¹åº”çš„ element æ—¶ï¼Œå®ƒå°†ä¸åŒæ•°æ®åˆ†è§£åˆ°ä¸åŒ module ä¸­å»æ›´æ–°ï¼Œé€šè¿‡é’©å­å‡½æ•°æ¥è§¦å‘ï¼Œè¿™ä¸€ç‚¹éå¸¸çš„ä¼˜é›…ã€‚</p>","frontmatter":{"title":"ç†è§£virtual domçš„å®ç°ç»†èŠ‚-snabbdom","date":"December 31, 2018"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/post/understand_the_details_of_vritual_dom_snabbdom/","previous":{"fields":{"slug":"/post/resolve_issue_of_using_audio/"},"frontmatter":{"title":"HTML5ä¸­Audioä½¿ç”¨è¸©å‘æ±‡æ€»"}},"next":{"fields":{"slug":"/post/understand_the_details_of_h5_and_native(ios)_communication/"},"frontmatter":{"title":"ç†è§£h5ä¸native(ios)é€šä¿¡ç»†èŠ‚"}}}}