{"data":{"avatar":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIEBQP/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQD/2gAMAwEAAhADEAAAAcSerUQpOzXUqiMAb//EABsQAAMAAgMAAAAAAAAAAAAAAAABAhESAxQh/9oACAEBAAEFAjzJ1VJcZepyU9x0z//EABURAQEAAAAAAAAAAAAAAAAAABEg/9oACAEDAQE/AWP/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAbEAADAAIDAAAAAAAAAAAAAAAAASEQERIxMv/aAAgBAQAGPwImPUNtcTodiz//xAAcEAACAgMBAQAAAAAAAAAAAAAAAREhMUFRYXH/2gAIAQEAAT8hWbK7l6NWStvasZEW4S7fwfTTAkNzkQZ//9oADAMBAAIAAwAAABAs1wP/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEQ/9oACAEDAQE/EMLbwL//xAAXEQEBAQEAAAAAAAAAAAAAAAABEQAQ/9oACAECAQE/EIzR4rv/xAAfEAEAAwACAQUAAAAAAAAAAAABABEhMUFRYXGBodH/2gAIAQEAAT8QAjVRsF68R3WyhBpEB4otans9oxQXOZRxVfkow9YivuDFJrEfPmaECm2kqIiV2XP/2Q==","width":40,"height":40,"src":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg","srcSet":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg 1x,\n/static/9d156e8486b343189790da372acb0018/9c097/my.jpg 1.5x,\n/static/9d156e8486b343189790da372acb0018/bd6c6/my.jpg 2x"}}},"site":{"siteMetadata":{"title":"三羊的小站","author":"三羊","postPath":"/post","contentUrl":"https://github.com/snayan/blog-source/tree/master/content/blog","menu":{"search":{"name":"搜索","link":"/search"}}}},"markdownRemark":{"id":"df656330-b1e8-57fe-a943-7d06b2511477","excerpt":"2019 年，在前端圈听到最多的就是 flutter 了。作为一个跨平台新宠，国内已有一些大厂，将它用在了实际的项目中。对于一个新技术，到底要不要跟进学习，笔者不做任何评论。笔者只是纯粹以学习的目的，去学习了 flutter，并通过写一个 demo 加深对它的理解。下面将结合自己开发的一个 demo…","html":"<p>2019 年，在前端圈听到最多的就是 flutter 了。作为一个跨平台新宠，国内已有一些大厂，将它用在了实际的项目中。对于一个新技术，到底要不要跟进学习，笔者不做任何评论。笔者只是纯粹以学习的目的，去学习了 flutter，并通过写一个 demo 加深对它的理解。下面将结合自己开发的一个 demo 项目，从前端的角度去阐述，希望能对你学习 flutter 有所帮助。</p>\n<p>flutter demo 项目地址：<a href=\"https://github.com/snayan/flutter_juejin\">点击这里</a></p>\n<h2>跨平台</h2>\n<h3>渲染</h3>\n<p>flutter 最大的特性就是跨平台。一套代码，即可搞定 iOS，Android，web 三端，真可谓之强大。为何它能跨平台呢，因为它将 widget 和渲染器从平台移到了应用程序自身上。它通过自带渲染引擎 skia，封装了系统提供的 2D 绘图接口。不管是 iOS，android，web，只需要提供一个 2D 渲染环境(canvas)，flutter 就可以渲染界面。</p>\n<p>业界其他跨平台方案还有 H5，react native 等。当做一个技术选型时，需要根据实际业务需求来衡量，所以这里对它们不做任何优劣之分，仅仅只是从实现原理去理解它们。只有真正了解它们的实现差异，才能对某一个具体业务选择最合适的方案。</p>\n<p>h5，最简单，平台支持度最高的。它需要不同平台提供一个 web view，渲染方式就是 web view 提供的渲染引擎去完成的。不同平台的 webview 实现方式可能不一样，但是它们都遵循 w3c 标准，所以一套 H5 代码能运行在不同平台之上。渲染之前需要通过平台生成一个 webview 实例，然后通过 http 请求，加载所需的静态资源（包含 html，css，js，image 等），这些前置步骤会导致一个白屏时间的存在。并且 js 是运行时编译的，所以它的运行速度不如原生的快。对于平台功能，需要通过 bridge 等方式来获得支持。</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1d59af1fd52ecdbe37c23cd7f7704e04/eef7a/h5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 49.1283676703645%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAACI0lEQVQoz2P4++/vv/9QAGT/RwL/wOAvGP35+/fGzZvnz5+/e/cuUANEkAGo6Nfn79/ffPr54QtcAwT8+QPUgmzcnx/fvgABnM9QeWVR0MGW0AOtPnvrKi4vBOmHWAsm3337nbf5dsyKa4mrb8SsvHHm6WeghUVb72RtvAUUZ1DZksCwzI55lRvDMlvVjTF3b915/ebNWxB49+71yz2nLglVHGQoP8BSc4ghe3fPtkv3HjxkqzrAUHOIAyiiuyuHYZUH81p/hpVuWjuz/v/59/vPnx+/f/788/v/3z9P3n1xmHVBf9IZs6lntfrPbL/17ufvvy5zLzrMueg05yKD9s5szvUhMlsTuTeEae7MBDsYGoJADwN9DvfE3x9ffn98/efbZ4SfgbaxrQsS2xzLui5QfWcGUOjxt9dRJ3vm3N8FZL/5+jNn4+30DbeKtt+LWXrBf+bRmCXnCrfdydtyJ3PDLQa9XbkMqzxZgM5e5aG2Lf3/7/9Hnl3m3Rieemry/9//bj5/K1R/mKfhiGLfKaC3WWqO8DQeU+g9Kd11gqfuMIPatmSGZfbMK90Zltopb479/+f/8efXONaHJJyYAGTfev5OouWYWNsx9QlnuOsPc9UcYq8+JN99UrztOG/9EYaNz07Of7Bn8cP98x7s3vD0BNCp7399mXN/95E314Dsr7/+bLz2ZtP1Nztuv99w7c3qy69WXny18fqbNZdfr770CgARebbPqRWqvAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <picture>\n        <source\n          srcset=\"/static/1d59af1fd52ecdbe37c23cd7f7704e04/cc182/h5.webp 148w,\n/static/1d59af1fd52ecdbe37c23cd7f7704e04/f7e40/h5.webp 295w,\n/static/1d59af1fd52ecdbe37c23cd7f7704e04/1a2f4/h5.webp 590w,\n/static/1d59af1fd52ecdbe37c23cd7f7704e04/d51b6/h5.webp 631w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/1d59af1fd52ecdbe37c23cd7f7704e04/cf440/h5.png 148w,\n/static/1d59af1fd52ecdbe37c23cd7f7704e04/d2d38/h5.png 295w,\n/static/1d59af1fd52ecdbe37c23cd7f7704e04/b9e4f/h5.png 590w,\n/static/1d59af1fd52ecdbe37c23cd7f7704e04/eef7a/h5.png 631w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n          src=\"/static/1d59af1fd52ecdbe37c23cd7f7704e04/b9e4f/h5.png\"\n          alt=\"h5\"\n          title=\"\"\n        />\n      </picture>\n  </span>\n  </a></p>\n<p>rn，使用 jsx 的方式声明 UI，然后通过 bridge 通信，使用平台控件来渲染界面。相比 h5 的 webview 渲染，平台控件渲染减少了 web view 实例化的过程，并且体验也更加流畅一些。每次 jsx 的变化，都需要通过 bridge 通知到平台那边。所以对于动画，滚动等高频率的改变，它的性能就会急剧下降。跟 h5 类似，也存在 js 的运行时性能不够好，对于平台功能，需要通过 bridge 等方式来获得支持。</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f53f1be58636ad62c3e8795fa16075e9/b2a12/rn.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 47.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAACH0lEQVQoz2P4DwP/gBDGAKF///7+/Qvk/v0LEn//4cPFi5du3Ljx5s1bkCBI/j/Dl3cf3zx79fndx/+oACj5588fZJE/v358+fLl169fcBEGv0NNAQeaXPdWd95cCxFquLYs8mT3518/gOwt19/4L7oSvfJ64OKreVvuAkW233wbufJ60tpbVTvvMTAsd2JZ7cGw1MbzYDVEs83eQpYVrmeuX3n/+EHR2gsM5QfZaw8x1BwSaz78/sXTqo0XGcoOMFQf1Ow5xcCw2pNlrR/Dcmf/Yy0Qza6H6/g2hj//BPTb35UXX9jPuuC78LLHgsspG+4AZTdcfe2/5ErU6hu5m24ziGyOUd6RzrUxHOjyx/cf3rl71+tAveHewpff34MDDwqAgff6+ZOXzx7/+P4d4WfmdQFAexhWe3kdavj59TswSLwPN8ptT3794xNQeuO11wGLr+RsuZO18bb/vLMB886mrLuev+1u0rqbpdvuMjCs8mRZA3S2k8/RZoh5joeqGVf7Pnj9/P+/X007bzEU7pXrOiHccpSx6hBL9WHRtuMqfae46g/r9p8G+tmbdW0gwwpXX5hmh4OVTGt8X375AGT3H37IXnPIcOpZzQmnBRuPijQdFW05pjXxDHfdYZsZ5xkOvr5y+PW1/a8uX/n4EKL57Ps7e19e/PUXFMmPP/zYd/f98Ycfjz38ePDe+4P33x+4+/7Igw/77rw78+QTAGQdt3ulN47oAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <picture>\n        <source\n          srcset=\"/static/f53f1be58636ad62c3e8795fa16075e9/cc182/rn.webp 148w,\n/static/f53f1be58636ad62c3e8795fa16075e9/f7e40/rn.webp 295w,\n/static/f53f1be58636ad62c3e8795fa16075e9/1a2f4/rn.webp 590w,\n/static/f53f1be58636ad62c3e8795fa16075e9/eae19/rn.webp 630w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/f53f1be58636ad62c3e8795fa16075e9/cf440/rn.png 148w,\n/static/f53f1be58636ad62c3e8795fa16075e9/d2d38/rn.png 295w,\n/static/f53f1be58636ad62c3e8795fa16075e9/b9e4f/rn.png 590w,\n/static/f53f1be58636ad62c3e8795fa16075e9/b2a12/rn.png 630w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n          src=\"/static/f53f1be58636ad62c3e8795fa16075e9/b9e4f/rn.png\"\n          alt=\"rn\"\n          title=\"\"\n        />\n      </picture>\n  </span>\n  </a></p>\n<p>flutter，由于自带高性能的渲染引擎，所有的 UI 显示都可以自己搞定，不需要 bridge 等中间层通信，所以在渲染方面表现出的性能要比 rn 优秀一点。flutter 支持 AOT，在 release 编译中，会将 dart 代码编译成对应平台的本地代码，其运行速度远比 js 的快。对于平台功能，flutter 也提供了类似 bridge 的 Method Channel 的方式来获得支持。</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/883f359513d17cdc5fd17459828c3e3a/83cbb/flutter.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 48.40764331210191%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAAB/UlEQVQoz2P4jwT+/PsLQX///4MAoCCEfPjw4blz527evPn9+3e4eoYPb98/e/z07avX/1EBUM9foCFI3F+/fv358wdiFlSz3d4K+90VtrvLA4+3VVxe2HB1eeHFueueHPv/9/+fv3+QjfsL1ta8/2HA0mvhK69X7rzHwLDChXG1B8Mqd4YVbmyrfcS2pTCs9o7Y1/D03uPXb9+8g4G3b9++fvP25cO7dpNPMpTuZ6g4YDzpDAPDak+mtX4Mq71EN8dkX5hZcHFu6rmpKx8fBtr86/cvoNPBIQB0/7+/YPd2H3ocu/ZG2qbb9XseMMhsS5beliSyOVZ/T/5fkKL//1D9DPHkp8+f79+/9/jxk1+/fyP8zLTWn31dEOMaP6kt8RNub5p6d2vnjTV7X10Cyn3/9TthzQ23+Zdi1t30XnTJcspJl9lno1Zdj1p7033h5dxNt4HO9mZe6w/UzLbWn2ttgPT2VIa1fvGHO///+PP09RvNnhMMlQdk+06x1R1iqjrIXndYtOuEVO8p5tpDNjPOM7CuC+BaHwK0HOhnjyMNEad6PY40Tbi1CeTU7z8sZ5yT6DxuPPO8fM9JkdZjIi3HpLtOqE08w9NwxGfRZYYLH+5d/HD//Pt7Nz49QYvnP3/+3nn3/eqrrzfefLv2+iuQAUFA9pWXXx+8/w4AX42+1Xdro3kAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <picture>\n        <source\n          srcset=\"/static/883f359513d17cdc5fd17459828c3e3a/cc182/flutter.webp 148w,\n/static/883f359513d17cdc5fd17459828c3e3a/f7e40/flutter.webp 295w,\n/static/883f359513d17cdc5fd17459828c3e3a/1a2f4/flutter.webp 590w,\n/static/883f359513d17cdc5fd17459828c3e3a/939a5/flutter.webp 628w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/883f359513d17cdc5fd17459828c3e3a/cf440/flutter.png 148w,\n/static/883f359513d17cdc5fd17459828c3e3a/d2d38/flutter.png 295w,\n/static/883f359513d17cdc5fd17459828c3e3a/b9e4f/flutter.png 590w,\n/static/883f359513d17cdc5fd17459828c3e3a/83cbb/flutter.png 628w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n          src=\"/static/883f359513d17cdc5fd17459828c3e3a/b9e4f/flutter.png\"\n          alt=\"flutter\"\n          title=\"\"\n        />\n      </picture>\n  </span>\n  </a></p>\n<p>新创建一个 flutter 项目时，目录结构中会有 ios，android，web 三个目录，它们分别就是对应到三个端的宿主平台代码。一般在开发时，不需要关心它们，实际 flutter 项目的代码，会放在 lib 目录中。flutter 选择了 dart 作为开发语言，dart 也是类似 JavaScript 的单线程语言，与 JavaScript 有许多相似之处，学习成本很低，这里不详细展开，更多可以去<a href=\"http://dartlang.org/\">官网</a>了解。需要提到的一点是，官方有<a href=\"https://dart.dev/tools/dart2js\">dart2js</a>的工具，将 dart 代码转换为 js 代码。实际上 flutter 能运行到 web 端，也就是在编译的时候，会进行 dart2js 的转换。</p>\n<h3>通信</h3>\n<p>有时候，产品功能会比较复杂，需要调用原生操作系统底层能力去实现某一部分功能，比如打开相机拍照等。仅仅使用 flutter 框架能力是无法实现的，这个时候就需要 flutter 层去调用原生层的服务了。flutter 通<a href=\"https://api.flutter.dev/flutter/services/MethodChannel-class.html\">MethodChannel</a>去实现这种场景，与 H5 通过 bridge 调用 native 功能的方式比较类似。如不清楚 H5 与 native 的通信细节，可以看看我之前写的<a href=\"/post/understand_the_details_of_h5_and_native(ios)_communication/\">「理解 h5 与 native(ios)通信细节」</a>。下面，我们通过<a href=\"https://pub.dev/packages/url_launcher\">url_launcher</a>来详细了解一下 MethodChannel 的实现和使用。</p>\n<p>url_launcher 的功能之一，就是支持在 iOS 和 android 设备上打开一个 URL 链接。在 flutter 中使用如下</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token function\">_launchURL</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token string\">'https://flutter.dev'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> <span class=\"token function\">canLaunch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">await</span> <span class=\"token function\">launch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token string\">'Could not launch $url'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>选择<code class=\"language-text\">canLaunch</code>函数作为切人点，一起看看它在 flutter 中的实现如下，</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token keyword\">const</span> MethodChannel _channel <span class=\"token operator\">=</span> <span class=\"token function\">MethodChannel</span><span class=\"token punctuation\">(</span><span class=\"token string\">'plugins.flutter.io/url_launcher'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/// Checks whether the specified URL can be handled by some app installed on the</span>\n<span class=\"token comment\">/// device.</span>\nFuture<span class=\"token operator\">&lt;</span>bool<span class=\"token operator\">></span> <span class=\"token function\">canLaunch</span><span class=\"token punctuation\">(</span>String urlString<span class=\"token punctuation\">)</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>urlString <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">await</span> _channel<span class=\"token punctuation\">.</span>invokeMethod<span class=\"token operator\">&lt;</span>bool<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">'canLaunch'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token operator\">&lt;</span>String<span class=\"token punctuation\">,</span> Object<span class=\"token operator\">></span><span class=\"token punctuation\">{</span><span class=\"token string\">'url'</span><span class=\"token punctuation\">:</span> urlString<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>实现比较简单，就是简单的判断了 urlString 是否为空，然后通过<code class=\"language-text\">MethodChannel#invokeMethod</code>去调用平台的接口了，并将参数封装为 Map 的形式传递过去。我们选择 Android 平台，看看平台是如何通过 MethodChannel 定义接口的，iOS 中实现也是类似的步骤。</p>\n<p>第一步，需要在 MainActivity 中注册 MethodChannel</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">// Android入口</span>\n<span class=\"token keyword\">class</span> MainActivity<span class=\"token operator\">:</span> <span class=\"token function\">FlutterActivity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span>savedInstanceState<span class=\"token operator\">:</span> Bundle<span class=\"token operator\">?</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span>savedInstanceState<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// 这里会注册插件</span>\n    GeneratedPluginRegistrant<span class=\"token punctuation\">.</span><span class=\"token function\">registerWith</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">GeneratedPluginRegistrant</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">registerWith</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PluginRegistry</span> registry<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 先判断是否已经注册过了</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">alreadyRegisteredWith</span><span class=\"token punctuation\">(</span>registry<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n   <span class=\"token class-name\">UrlLauncherPlugin</span><span class=\"token punctuation\">.</span><span class=\"token function\">registerWith</span><span class=\"token punctuation\">(</span>registry<span class=\"token punctuation\">.</span><span class=\"token function\">registrarFor</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"io.flutter.plugins.urllauncher.UrlLauncherPlugin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>第二步，定义接口，通过<code class=\"language-text\">call.argument</code>获取参数，<code class=\"language-text\">call.method</code>获取方法名称</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Override</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onMethodCall</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MethodCall</span> call<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Result</span> result<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> url <span class=\"token operator\">=</span> call<span class=\"token punctuation\">.</span><span class=\"token function\">argument</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"url\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>call<span class=\"token punctuation\">.</span>method<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">\"canLaunch\"</span><span class=\"token operator\">:</span>\n      <span class=\"token function\">onCanLaunch</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">\"launch\"</span><span class=\"token operator\">:</span>\n      <span class=\"token function\">onLaunch</span><span class=\"token punctuation\">(</span>call<span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">\"closeWebView\"</span><span class=\"token operator\">:</span>\n      <span class=\"token function\">onCloseWebView</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n      result<span class=\"token punctuation\">.</span><span class=\"token function\">notImplemented</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>第三步，实现并返回结果</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onCanLaunch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Result</span> result<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> url<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  result<span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span>urlLauncher<span class=\"token punctuation\">.</span><span class=\"token function\">canLaunch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* urlLauncher.canLaunch */</span>\n<span class=\"token comment\">/** Returns whether the given {@code url} resolves into an existing component. */</span>\n<span class=\"token keyword\">boolean</span> <span class=\"token function\">canLaunch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> url<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token class-name\">Intent</span> launchIntent <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Intent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Intent</span><span class=\"token punctuation\">.</span>ACTION_VIEW<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  launchIntent<span class=\"token punctuation\">.</span><span class=\"token function\">setData</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Uri</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token class-name\">ComponentName</span> componentName <span class=\"token operator\">=</span>\n    launchIntent<span class=\"token punctuation\">.</span><span class=\"token function\">resolveActivity</span><span class=\"token punctuation\">(</span>applicationContext<span class=\"token punctuation\">.</span><span class=\"token function\">getPackageManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> componentName <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span>\n    <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span><span class=\"token string\">\"{com.android.fallback/com.android.fallback.Fallback}\"</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>componentName<span class=\"token punctuation\">.</span><span class=\"token function\">toShortString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>对于一个底层能力的插件，需要在 iOS 和 Android 端分别实现，这样在 flutter 层就无需关注原生实现细节，只需要通过 MethodChannel 调用就可以了。感觉实际项目开发中，还是需要 iOS，Android 同学去开发底层能力，然后业务功能可以使用 flutter 开发。幸好，大部分这种通用底层能力的接口，官方或社区都以插件的形式实现了，直接安装即可使用。</p>\n<h2>包管理</h2>\n<p>flutter 选择 dart 作为开发语言，dart 使用的包管理是<a href=\"https://pub.dev/\">pub</a>，它与 npm 类似。下面列举它们的差异点。</p>\n<table>\n<thead>\n<tr>\n<th>包管理</th>\n<th>pub</th>\n<th>npm</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>配置文件</td>\n<td>pubspec.yaml</td>\n<td>package.json</td>\n</tr>\n<tr>\n<td>版本锁文件</td>\n<td>pubspec.lock</td>\n<td>Package-lock.json</td>\n</tr>\n<tr>\n<td>安装目录</td>\n<td>flutter 目录.pub-cache 下</td>\n<td>项目 node_modules 下</td>\n</tr>\n</tbody>\n</table>\n<p>如需在 flutter 中安装一个插件，比如 url_launch，步骤如下，</p>\n<p>第一步，在 pubspec.yaml 中 dependencies 中声明，如是开发环境依赖包，则在 dev_dependencies 中声明，与 package.json 类似。</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">dependencies</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">flutter</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">sdk</span><span class=\"token punctuation\">:</span> flutter\n\n  <span class=\"token key atrule\">url_launcher</span><span class=\"token punctuation\">:</span> ^5.2.3</code></pre></div>\n<p>第二步，可以执行如下命令，一般在 pubspec.yaml 中改变了，vscode 获取 Android studio 会自动安装的，所以这一步一般可以省略。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">flutter pub get</code></pre></div>\n<p>第三步，就是直接在项目中引用使用即可，如下，</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token keyword\">import</span> <span class=\"token string\">'package:url_launcher/url_launcher.dart'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">_launchURL</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token string\">'https://flutter.dev'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> <span class=\"token function\">canLaunch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">await</span> <span class=\"token function\">launch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token string\">'Could not launch $url'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>小结</h2>\n<p>对于跨平台的框架，一般需要满足最基本的两个条件，其一是能够在不同平台上高效的渲染，，其二是能够通过某种方式调用平台的服务。flutter 无疑在这两方面都做的比较出色，它通过自带的渲染引擎可以高效的在 Android 和 iOS，web 等平台上渲染界面，同时通过 method channel 等 bridge 方式调用平台服务。</p>\n<p>flutter 选择 dart 作为开发语言，它也有类似 npm 的包管理器 pub，可以很方便的安装或者发布特定功能的插件。</p>\n<h2>参考</h2>\n<ul>\n<li>\n<p><a href=\"https://hackernoon.com/whats-revolutionary-about-flutter-946915b09514\">What’s Revolutionary about Flutter</a></p>\n</li>\n<li>\n<p><a href=\"https://hackernoon.com/why-native-app-developers-should-take-a-serious-look-at-flutter-e97361a1c073\">Why native app developers should take a serious look at Flutter</a></p>\n</li>\n</ul>","tableOfContents":"<ul>\n<li>\n<p><a href=\"/post/2019/flutter-learn-1/#%E8%B7%A8%E5%B9%B3%E5%8F%B0\">跨平台</a></p>\n<ul>\n<li><a href=\"/post/2019/flutter-learn-1/#%E6%B8%B2%E6%9F%93\">渲染</a></li>\n<li><a href=\"/post/2019/flutter-learn-1/#%E9%80%9A%E4%BF%A1\">通信</a></li>\n</ul>\n</li>\n<li><a href=\"/post/2019/flutter-learn-1/#%E5%8C%85%E7%AE%A1%E7%90%86\">包管理</a></li>\n<li><a href=\"/post/2019/flutter-learn-1/#%E5%B0%8F%E7%BB%93\">小结</a></li>\n<li><a href=\"/post/2019/flutter-learn-1/#%E5%8F%82%E8%80%83\">参考</a></li>\n</ul>","frontmatter":{"title":"flutter 学习小结（一）","date":"November 16, 2019","tags":["flutter"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/post/2019/flutter-learn-1/","previous":{"fields":{"slug":"/post/2019/diy_a_babel_plugin/"},"frontmatter":{"title":"DIY 一个 Babel 插件"}},"next":{"fields":{"slug":"/post/2019/flutter-learn-2/"},"frontmatter":{"title":"flutter 学习小结（二）"}}}}