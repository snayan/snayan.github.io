{"data":{"avatar":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIEBQP/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQD/2gAMAwEAAhADEAAAAcSerUQpOzXUqiMAb//EABsQAAMAAgMAAAAAAAAAAAAAAAABAhESAxQh/9oACAEBAAEFAjzJ1VJcZepyU9x0z//EABURAQEAAAAAAAAAAAAAAAAAABEg/9oACAEDAQE/AWP/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAbEAADAAIDAAAAAAAAAAAAAAAAASEQERIxMv/aAAgBAQAGPwImPUNtcTodiz//xAAcEAACAgMBAQAAAAAAAAAAAAAAAREhMUFRYXH/2gAIAQEAAT8hWbK7l6NWStvasZEW4S7fwfTTAkNzkQZ//9oADAMBAAIAAwAAABAs1wP/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEQ/9oACAEDAQE/EMLbwL//xAAXEQEBAQEAAAAAAAAAAAAAAAABEQAQ/9oACAECAQE/EIzR4rv/xAAfEAEAAwACAQUAAAAAAAAAAAABABEhMUFRYXGBodH/2gAIAQEAAT8QAjVRsF68R3WyhBpEB4otans9oxQXOZRxVfkow9YivuDFJrEfPmaECm2kqIiV2XP/2Q==","width":40,"height":40,"src":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg","srcSet":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg 1x,\n/static/9d156e8486b343189790da372acb0018/9c097/my.jpg 1.5x,\n/static/9d156e8486b343189790da372acb0018/bd6c6/my.jpg 2x"}}},"site":{"siteMetadata":{"title":"三洋的小站","author":"三洋"}},"markdownRemark":{"id":"b2807f1a-7dfb-524e-8eef-2c815a1f7f9a","excerpt":"看了这么多框架方面的东西，但注意，基础很重要。今天就来说说 javascipt 中容易忽略的类型转换问题。\n在 javascript 中有…","html":"<p>看了这么多框架方面的东西，但注意，基础很重要。今天就来说说 javascipt 中容易忽略的类型转换问题。\n在 javascript 中有 7 种基本类型，它们为：<code class=\"language-text\">string</code>，<code class=\"language-text\">number</code>，<code class=\"language-text\">boolean</code>，<code class=\"language-text\">undefined</code>，<code class=\"language-text\">null</code>，<code class=\"language-text\">symbol</code>，<code class=\"language-text\">object</code>。判断类型的方式是<code class=\"language-text\">typeof</code>。我们把<code class=\"language-text\">string</code>，<code class=\"language-text\">number</code>，<code class=\"language-text\">boolean</code>，<code class=\"language-text\">undefined</code>，<code class=\"language-text\">null</code>，<code class=\"language-text\">symbol</code>这几类称为原始类型。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">typeof</span> <span class=\"token number\">1</span> <span class=\"token comment\">//'number'</span>\n<span class=\"token keyword\">typeof</span> <span class=\"token string\">\"aa\"</span> <span class=\"token comment\">//'string'</span>\n<span class=\"token keyword\">typeof</span> <span class=\"token boolean\">true</span> <span class=\"token comment\">//'boolean'</span>\n<span class=\"token keyword\">typeof</span> <span class=\"token function\">Symbol</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//'symbol'</span>\n<span class=\"token keyword\">typeof</span> <span class=\"token keyword\">undefined</span> <span class=\"token comment\">//'undefined'</span>\n<span class=\"token keyword\">typeof</span> <span class=\"token keyword\">null</span> <span class=\"token comment\">//'object'</span>\n<span class=\"token keyword\">typeof</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token comment\">//'object'</span>\n<span class=\"token keyword\">typeof</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token comment\">//'function'</span></code></pre></div>\n<p>注意两点，一是，对于函数，实际上也可以认为是<code class=\"language-text\">object</code>，但使用<code class=\"language-text\">typeof</code>得到的结果是<code class=\"language-text\">function</code>；二是，对于<code class=\"language-text\">null</code>，<code class=\"language-text\">typeof</code>得到的结果是<code class=\"language-text\">object</code>。</p>\n<!--more-->\n<p>再来看看这些类型之间是怎么转换的呢？今天我们讨论的是<code class=\"language-text\">object</code>类型转为原始值，对于原始值转为<code class=\"language-text\">object</code>，可以直接进行包装即可，例如<code class=\"language-text\">new Number(1)</code>，本次不予讨论，本次也不讨论原始类型之间的相互转换。</p>\n<h3>object 转为 number</h3>\n<p>先看看下面的几个情况，<code class=\"language-text\">object</code>转<code class=\"language-text\">number</code>，输出的值是几多</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//NaN</span>\nobj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">valueOf</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">1</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//1</span>\nobj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">toString</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">2</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//2</span>\nobj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">valueOf</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">1</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">toString</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">2</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//1</span></code></pre></div>\n<p>从上面的例子可以看出，<code class=\"language-text\">object</code>转为<code class=\"language-text\">number</code>是根<code class=\"language-text\">valueOf</code>和<code class=\"language-text\">toString</code>函数有关的。具体步骤如下：</p>\n<ol>\n<li>调用对象的<code class=\"language-text\">valueOf()</code>方法，如果返回结果是原始类型，则根据这个原始类型再转换为<code class=\"language-text\">number</code>。</li>\n<li>否则，调用对象的<code class=\"language-text\">toString()</code>方法，如果返回的结果是原始类型，则根据这个原始类型再转换为<code class=\"language-text\">number</code>。</li>\n<li>否则，抛出一个异常<code class=\"language-text\">TypeError</code>。注意一点的是，<code class=\"language-text\">symbol</code>转为<code class=\"language-text\">number</code>时会抛出异常的，<code class=\"language-text\">null</code>转为<code class=\"language-text\">number</code>是<code class=\"language-text\">0</code>。</li>\n</ol>\n<h3>object 转为 string</h3>\n<p>我们再来看看下面的例子，输出是几多</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">String</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//\"[object Object]\"</span>\nobj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">valueOf</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">\"a\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">String</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//\"[object Object]\"</span>\nobj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">toString</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">\"b\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">String</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"b\"</span><span class=\"token punctuation\">)</span>\nobj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">valueOf</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">\"a\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">toString</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">\"b\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">String</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//\"b\"</span></code></pre></div>\n<p>从上面的例子可以看出，<code class=\"language-text\">object</code>转为<code class=\"language-text\">string</code>时也是与<code class=\"language-text\">valueOf</code>和<code class=\"language-text\">toString</code>有关，步骤如下：</p>\n<ol>\n<li>调用对象的<code class=\"language-text\">toString()</code>方法，如果返回值是原始类型，则再把这个原始类型转为<code class=\"language-text\">string</code></li>\n<li>否则调用对象的<code class=\"language-text\">valueOf()</code>方法，如果返回值为原始类型，则再把这个原始类型转为<code class=\"language-text\">string</code></li>\n<li>否则，抛出一个异常<code class=\"language-text\">TypeError</code>。注意，<code class=\"language-text\">symbol</code>转为<code class=\"language-text\">string</code>时会抛出异常。</li>\n</ol>\n<h3>object 转为 boolean</h3>\n<p><code class=\"language-text\">object</code>转为<code class=\"language-text\">boolean</code>时总是<code class=\"language-text\">true</code>，在 javascript 中转为<code class=\"language-text\">boolean</code>且值为<code class=\"language-text\">false</code>时只有以下几种值；<code class=\"language-text\">false</code>，<code class=\"language-text\">&#39;&#39;</code>，<code class=\"language-text\">0</code>，<code class=\"language-text\">NaN</code>，<code class=\"language-text\">undefined</code>，<code class=\"language-text\">null</code>。</p>\n<p>看了这么多，实际上主要是<code class=\"language-text\">object</code>转<code class=\"language-text\">number</code>和<code class=\"language-text\">string</code>时比较复杂，涉及 javascript 中内部的 ToPrimitive 方法。下面为 ecmascript262 中的官方定义：</p>\n<blockquote>\n<p>The abstract operation ToPrimitive takes an input argument and an optional argument PreferredType. The abstract operation ToPrimitive converts its input argument to a non-Object type. If an object is capable of converting to more than one primitive type, it may use the optional hint PreferredType to favour that type.</p>\n</blockquote>\n<p>函数签名为<code class=\"language-text\">ToPrimitive(input[,PreferredType])=&gt;PreferredType</code>。如果 PreferredType 为 Number,则执行以下步骤：</p>\n<ol>\n<li>如果 input 是原始值，则返回这个值，结束。</li>\n<li>否则，如果 input 是对象，则调用<code class=\"language-text\">input.valueOf()</code>。如果结果是原始值，则把结果值转为<code class=\"language-text\">Number</code>。</li>\n<li>否则，调用<code class=\"language-text\">input.toString()</code>。如果结果是原始值，则把结果值转为<code class=\"language-text\">Number</code>。</li>\n<li>否则，抛出一个<code class=\"language-text\">TypeError</code>。</li>\n</ol>\n<p>如果<code class=\"language-text\">PreferredType</code>是<code class=\"language-text\">String</code>，则把第二步和第三步进行交换。<code class=\"language-text\">PreferredType</code>也可以省略的，这种情况下，日期会被认为是<code class=\"language-text\">String</code>而其他值会被认为是<code class=\"language-text\">Number</code>。\n需要注意的是，每个对象都有默认的<code class=\"language-text\">valueOf</code>和<code class=\"language-text\">toString</code>方法，<code class=\"language-text\">valueOf</code>，<code class=\"language-text\">toString</code>则根据具体的类型有所区别，  如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> obj<span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// \"[object Object]\"</span>\nobj <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> obj<span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// \"1,2\"</span>\n<span class=\"token function-variable function\">obj</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> obj<span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// \"function (){}\"</span>\nobj <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 1497082546564</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> obj<span class=\"token punctuation\">)</span> <span class=\"token comment\">// false</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// \"Sat Jun 10 2017 16:15:46 GMT+0800 (CST)\"</span>\n<span class=\"token comment\">//......</span></code></pre></div>\n<h4>参考</h4>\n<p><a href=\"http://www.ecma-international.org/ecma-262/6.0/#sec-toprimitive\">ecma-262</a></p>","frontmatter":{"title":"javascript中ToPrimitive详解","date":"July 06, 2017"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/post/explanatio_of_ToPrimitive/","previous":{"fields":{"slug":"/post/react_component_life_cycle/"},"frontmatter":{"title":"react组件生命周期浅谈"}},"next":{"fields":{"slug":"/post/img_srcset_seizes/"},"frontmatter":{"title":"响应式图片加载"}}}}