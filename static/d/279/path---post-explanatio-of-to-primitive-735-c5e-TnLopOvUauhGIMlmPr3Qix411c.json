{"data":{"avatar":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIEBQP/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQD/2gAMAwEAAhADEAAAAcSerUQpOzXUqiMAb//EABsQAAMAAgMAAAAAAAAAAAAAAAABAhESAxQh/9oACAEBAAEFAjzJ1VJcZepyU9x0z//EABURAQEAAAAAAAAAAAAAAAAAABEg/9oACAEDAQE/AWP/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAbEAADAAIDAAAAAAAAAAAAAAAAASEQERIxMv/aAAgBAQAGPwImPUNtcTodiz//xAAcEAACAgMBAQAAAAAAAAAAAAAAAREhMUFRYXH/2gAIAQEAAT8hWbK7l6NWStvasZEW4S7fwfTTAkNzkQZ//9oADAMBAAIAAwAAABAs1wP/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEQ/9oACAEDAQE/EMLbwL//xAAXEQEBAQEAAAAAAAAAAAAAAAABEQAQ/9oACAECAQE/EIzR4rv/xAAfEAEAAwACAQUAAAAAAAAAAAABABEhMUFRYXGBodH/2gAIAQEAAT8QAjVRsF68R3WyhBpEB4otans9oxQXOZRxVfkow9YivuDFJrEfPmaECm2kqIiV2XP/2Q==","width":40,"height":40,"src":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg","srcSet":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg 1x,\n/static/9d156e8486b343189790da372acb0018/9c097/my.jpg 1.5x,\n/static/9d156e8486b343189790da372acb0018/bd6c6/my.jpg 2x"}}},"site":{"siteMetadata":{"title":"三羊的小站","author":"三羊","postPath":"/post","contentUrl":"https://github.com/snayan/blog-source/tree/master/content/blog","menu":{"search":{"name":"搜索","link":"/search"}}}},"markdownRemark":{"id":"b2807f1a-7dfb-524e-8eef-2c815a1f7f9a","excerpt":"看了这么多框架方面的东西，但注意，基础很重要。今天就来说说 javascipt 中容易忽略的类型转换问题。\n在 javascript 中有…","html":"<p>看了这么多框架方面的东西，但注意，基础很重要。今天就来说说 javascipt 中容易忽略的类型转换问题。\n在 javascript 中有 7 种基本类型，它们为：<code>string</code>，<code>number</code>，<code>boolean</code>，<code>undefined</code>，<code>null</code>，<code>symbol</code>，<code>object</code>。判断类型的方式是<code>typeof</code>。我们把<code>string</code>，<code>number</code>，<code>boolean</code>，<code>undefined</code>，<code>null</code>，<code>symbol</code>这几类称为原始类型。</p>\n<pre><code class=\"language-javascript\">typeof 1 // 'number'\ntypeof \"aa\" // 'string'\ntypeof true // 'boolean'\ntypeof Symbol() // 'symbol'\ntypeof undefined // 'undefined'\ntypeof null // 'object'\ntypeof {} // 'object'\ntypeof function() {} // 'function'\n</code></pre>\n<p>注意两点，一是，对于函数，实际上也可以认为是<code>object</code>，但使用<code>typeof</code>得到的结果是<code>function</code>；二是，对于<code>null</code>，<code>typeof</code>得到的结果是<code>object</code>。</p>\n<!--more-->\n<p>再来看看这些类型之间是怎么转换的呢？今天我们讨论的是<code>object</code>类型转为原始值，对于原始值转为<code>object</code>，可以直接进行包装即可，例如<code>new Number(1)</code>，本次不予讨论，本次也不讨论原始类型之间的相互转换。</p>\n\n          <h3 id='toc-3-1' >\n            object 转为 number\n          </h3>\n        \n<p>先看看下面的几个情况，<code>object</code>转<code>number</code>，输出的值是几多</p>\n<pre><code class=\"language-javascript\">var obj = {}\nconsole.log(Number(obj)) // NaN\nobj = {\n  valueOf: function() {\n    return 1\n  },\n}\nconsole.log(Number(obj)) // 1\nobj = {\n  toString: function() {\n    return 2\n  },\n}\nconsole.log(Number(obj)) // 2\nobj = {\n  valueOf: function() {\n    return 1\n  },\n  toString: function() {\n    return 2\n  },\n}\nconsole.log(Number(obj)) // 1\n</code></pre>\n<p>从上面的例子可以看出，<code>object</code>转为<code>number</code>是根<code>valueOf</code>和<code>toString</code>函数有关的。具体步骤如下：</p>\n<ol>\n<li>调用对象的<code>valueOf()</code>方法，如果返回结果是原始类型，则根据这个原始类型再转换为<code>number</code>。</li>\n<li>否则，调用对象的<code>toString()</code>方法，如果返回的结果是原始类型，则根据这个原始类型再转换为<code>number</code>。</li>\n<li>否则，抛出一个异常<code>TypeError</code>。注意一点的是，<code>symbol</code>转为<code>number</code>时会抛出异常的，<code>null</code>转为<code>number</code>是<code>0</code>。</li>\n</ol>\n\n          <h3 id='toc-3-2' >\n            object 转为 string\n          </h3>\n        \n<p>我们再来看看下面的例子，输出是几多</p>\n<pre><code class=\"language-javascript\">var obj = {}\nconsole.log(String(obj)) // \"[object Object]\"\nobj = {\n  valueOf: function() {\n    return \"a\"\n  },\n}\nconsole.log(String(obj)) // \"[object Object]\"\nobj = {\n  toString: function() {\n    return \"b\"\n  },\n}\nconsole.log(String(obj))\n;(\"b\")\nobj = {\n  valueOf: function() {\n    return \"a\"\n  },\n  toString: function() {\n    return \"b\"\n  },\n}\nconsole.log(String(obj)) // \"b\"\n</code></pre>\n<p>从上面的例子可以看出，<code>object</code>转为<code>string</code>时也是与<code>valueOf</code>和<code>toString</code>有关，步骤如下：</p>\n<ol>\n<li>调用对象的<code>toString()</code>方法，如果返回值是原始类型，则再把这个原始类型转为<code>string</code></li>\n<li>否则调用对象的<code>valueOf()</code>方法，如果返回值为原始类型，则再把这个原始类型转为<code>string</code></li>\n<li>否则，抛出一个异常<code>TypeError</code>。注意，<code>symbol</code>转为<code>string</code>时会抛出异常。</li>\n</ol>\n\n          <h3 id='toc-3-3' >\n            object 转为 boolean\n          </h3>\n        \n<p><code>object</code>转为<code>boolean</code>时总是<code>true</code>，在 javascript 中转为<code>boolean</code>且值为<code>false</code>时只有以下几种值；<code>false</code>，<code>''</code>，<code>0</code>，<code>NaN</code>，<code>undefined</code>，<code>null</code>。</p>\n<p>看了这么多，实际上主要是<code>object</code>转<code>number</code>和<code>string</code>时比较复杂，涉及 javascript 中内部的 ToPrimitive 方法。下面为 ecmascript262 中的官方定义：</p>\n<blockquote>\n<p>The abstract operation ToPrimitive takes an input argument and an optional argument PreferredType. The abstract operation ToPrimitive converts its input argument to a non-Object type. If an object is capable of converting to more than one primitive type, it may use the optional hint PreferredType to favour that type.</p>\n</blockquote>\n<p>函数签名为<code>ToPrimitive(input[,PreferredType])=>PreferredType</code>。如果 PreferredType 为 Number,则执行以下步骤：</p>\n<ol>\n<li>如果 input 是原始值，则返回这个值，结束。</li>\n<li>否则，如果 input 是对象，则调用<code>input.valueOf()</code>。如果结果是原始值，则把结果值转为<code>Number</code>。</li>\n<li>否则，调用<code>input.toString()</code>。如果结果是原始值，则把结果值转为<code>Number</code>。</li>\n<li>否则，抛出一个<code>TypeError</code>。</li>\n</ol>\n<p>如果<code>PreferredType</code>是<code>String</code>，则把第二步和第三步进行交换。<code>PreferredType</code>也可以省略的，这种情况下，日期会被认为是<code>String</code>而其他值会被认为是<code>Number</code>。\n需要注意的是，每个对象都有默认的<code>valueOf</code>和<code>toString</code>方法，<code>valueOf</code>，<code>toString</code>则根据具体的类型有所区别，  如下：</p>\n<pre><code class=\"language-javascript\">var obj = {}\nconsole.log(obj.valueOf() === obj) // true\nconsole.log(obj.toString()) // \"[object Object]\"\nobj = [1, 2]\nconsole.log(obj.valueOf() === obj) // true\nconsole.log(obj.toString()) // \"1,2\"\nobj = function() {}\nconsole.log(obj.valueOf() === obj) // true\nconsole.log(obj.toString()) // \"function (){}\"\nobj = new Date()\nconsole.log(obj.valueOf()) // 1497082546564\nconsole.log(obj.valueOf() === obj) // false\nconsole.log(obj.toString()) // \"Sat Jun 10 2017 16:15:46 GMT+0800 (CST)\"\n//......\n</code></pre>\n\n          <h4 id='toc-4-1' >\n            参考\n          </h4>\n        \n<p><a href=\"http://www.ecma-international.org/ecma-262/6.0/#sec-toprimitive\">ecma-262</a></p>","tableOfContents":"<ul><li><a href=\"#toc-3-1\">object 转为 number</a><ul><li><a href=\"#toc-4-1\">参考</a></li></ul></li><li><a href=\"#toc-3-2\">object 转为 string</a><ul></ul></li><li><a href=\"#toc-3-3\">object 转为 boolean</a><ul></ul></li></ul>","frontmatter":{"title":"javascript中ToPrimitive详解","date":"July 06, 2017","tags":["javascript"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/post/explanatio_of_ToPrimitive/","previous":{"fields":{"slug":"/post/react_component_life_cycle/"},"frontmatter":{"title":"react组件生命周期浅谈"}},"next":{"fields":{"slug":"/post/img_srcset_seizes/"},"frontmatter":{"title":"响应式图片加载"}}}}