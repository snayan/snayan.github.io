{"data":{"avatar":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIEBQP/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQD/2gAMAwEAAhADEAAAAcSerUQpOzXUqiMAb//EABsQAAMAAgMAAAAAAAAAAAAAAAABAhESAxQh/9oACAEBAAEFAjzJ1VJcZepyU9x0z//EABURAQEAAAAAAAAAAAAAAAAAABEg/9oACAEDAQE/AWP/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAbEAADAAIDAAAAAAAAAAAAAAAAASEQERIxMv/aAAgBAQAGPwImPUNtcTodiz//xAAcEAACAgMBAQAAAAAAAAAAAAAAAREhMUFRYXH/2gAIAQEAAT8hWbK7l6NWStvasZEW4S7fwfTTAkNzkQZ//9oADAMBAAIAAwAAABAs1wP/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEQ/9oACAEDAQE/EMLbwL//xAAXEQEBAQEAAAAAAAAAAAAAAAABEQAQ/9oACAECAQE/EIzR4rv/xAAfEAEAAwACAQUAAAAAAAAAAAABABEhMUFRYXGBodH/2gAIAQEAAT8QAjVRsF68R3WyhBpEB4otans9oxQXOZRxVfkow9YivuDFJrEfPmaECm2kqIiV2XP/2Q==","width":40,"height":40,"src":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg","srcSet":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg 1x,\n/static/9d156e8486b343189790da372acb0018/9c097/my.jpg 1.5x,\n/static/9d156e8486b343189790da372acb0018/bd6c6/my.jpg 2x"}}},"site":{"siteMetadata":{"title":"三羊的小站","author":"三羊","postPath":"/post","contentUrl":"https://github.com/snayan/blog-source/tree/master/content/blog","menu":{"search":{"name":"搜索","link":"/search"}}}},"markdownRemark":{"id":"ece5b7c1-bfae-555c-8c18-3c1938669b60","excerpt":"React 中比较重要的就是React elements了，可以理解为页面中可看到的节点元素。结构一个React element的结构为下面这样，\n可以看到比较重要的几个属性：$$typeof，key，props，ref，type。$$typeof：固定为，在验证React element时就是取的这个值。key…","html":"<p>React 中比较重要的就是<strong>React elements</strong>了，可以理解为页面中可看到的节点元素。</p>\n\n          <h2 id='toc-2-1' >\n            结构\n          </h2>\n        \n<p>一个<strong>React element</strong>的结构为下面这样，\n<img src=\"./react_element.jpg\" alt=\"react element\"></p>\n<!--more-->\n<p>可以看到比较重要的几个属性：<strong>$$typeof</strong>，<strong>key</strong>，<strong>props</strong>，<strong>ref</strong>，<strong>type</strong>。</p>\n<ul>\n<li>$$typeof：固定为<code>Symbol(react.element)</code>，在验证React element时就是取的这个值。</li>\n</ul>\n<pre><code class=\"language-javascript\">export function isValidElement(object) {\n  return (\n    typeof object === \"object\" &#x26;&#x26;\n    object !== null &#x26;&#x26;\n    object.$$typeof === REACT_ELEMENT_TYPE\n  )\n}\n</code></pre>\n<ul>\n<li>key：在循环输出 React elements 时加上 key 属性，可以极大的优化性能，react 在进行节点\"diff\"比较时，会取 key 值进行比较。</li>\n<li>props：传递给 element 的属性对象，也包含了当前元素的子节点<code>children</code></li>\n</ul>\n<p><img src=\"./element_prop.jpg\" alt=\"element prop\"></p>\n<ul>\n<li>ref：保存了对应真实 dom 的节点的访问的名称</li>\n</ul>\n<pre><code class=\"language-javascript\">const ref = function(value) {\n  const refs = inst.refs === emptyObject ? (inst.refs = {}) : inst.refs\n  if (value === null) {\n    delete refs[stringRef]\n  } else {\n    refs[stringRef] = value\n  }\n}\n</code></pre>\n<ul>\n<li>type：当前元素的类型，取值为 html 元素，自定义组件，Fragment，StrictMode，AsyncMode。</li>\n</ul>\n<pre><code class=\"language-javascript\">export default function isValidElementType(type: mixed) {\n  return (\n    typeof type === \"string\" ||\n    typeof type === \"function\" ||\n    // Note: its typeof might be other than 'symbol' or 'number' if it's a polyfill.\n    type === REACT_FRAGMENT_TYPE ||\n    type === REACT_ASYNC_MODE_TYPE ||\n    type === REACT_STRICT_MODE_TYPE ||\n    (typeof type === \"object\" &#x26;&#x26;\n      type !== null &#x26;&#x26;\n      (type.$$typeof === REACT_PROVIDER_TYPE ||\n        type.$$typeof === REACT_CONTEXT_TYPE ||\n        type.$$typeof === REACT_FORWARD_REF_TYPE))\n  )\n}\n</code></pre>\n\n          <h2 id='toc-2-2' >\n            源码分析\n          </h2>\n        \n<p><strong>React elements</strong>是通过<code>React.createElement</code>函数创建的，可以创建内部预定义的元素类型，这些预定义的就是对应 html 中的原始 tagName（定义在 validateDOMNesting.js 文件中），也可以创建自定义组件的元素类型。</p>\n<pre><code class=\"language-javascript\">export function createElement(type, config, children) {\n  let propName\n\n  // Reserved names are extracted\n  const props = {}\n\n  let key = null\n  let ref = null\n  let self = null\n  let source = null\n\n  if (config != null) {\n    if (hasValidRef(config)) {\n      ref = config.ref\n    }\n    if (hasValidKey(config)) {\n      key = \"\" + config.key\n    }\n\n    self = config.__self === undefined ? null : config.__self\n    source = config.__source === undefined ? null : config.__source\n    // Remaining properties are added to a new props object\n    for (propName in config) {\n      if (\n        hasOwnProperty.call(config, propName) &#x26;&#x26;\n        !RESERVED_PROPS.hasOwnProperty(propName)\n      ) {\n        props[propName] = config[propName]\n      }\n    }\n  }\n\n  // Children can be more than one argument, and those are transferred onto\n  // the newly allocated props object.\n  const childrenLength = arguments.length - 2\n  if (childrenLength === 1) {\n    props.children = children\n  } else if (childrenLength > 1) {\n    const childArray = Array(childrenLength)\n    for (let i = 0; i &#x3C; childrenLength; i++) {\n      childArray[i] = arguments[i + 2]\n    }\n    props.children = childArray\n  }\n\n  // Resolve default props\n  if (type &#x26;&#x26; type.defaultProps) {\n    const defaultProps = type.defaultProps\n    for (propName in defaultProps) {\n      if (props[propName] === undefined) {\n        props[propName] = defaultProps[propName]\n      }\n    }\n  }\n  return {\n    $$typeof: REACT_ELEMENT_TYPE,\n    type,\n    key,\n    ref,\n    props,\n    _owner: owner,\n  }\n}\n</code></pre>\n\n          <h2 id='toc-2-3' >\n            JSX\n          </h2>\n        \n<p>在创建<strong>React elements</strong>时，用<code>React.createElement</code>完全可以满足任何场景，并且 javascript 函数式编程的极大体现，极大的灵活。但是呢，在一些结构复杂，且嵌套层级多的结构中，我们使用<code>React.createElement</code>写会觉得比较繁琐，并且直观上不容易理解元素的结构。于是，<code>JSX</code>应运而生，用写 html 的方式写 React elements 的结构。实际背后是 babel，会把<code>JSX</code>转换为<code>React.createElement</code>的方式。详见：<a href=\"https://babeljs.io/docs/plugins/transform-react-jsx\">transform-react-jsx</a></p>","tableOfContents":"<ul><li><a href=\"#toc-2-1\">结构</a><ul></ul></li><li><a href=\"#toc-2-2\">源码分析</a><ul></ul></li><li><a href=\"#toc-2-3\">JSX</a><ul></ul></li></ul>","frontmatter":{"title":"react 16学习(四)","date":"April 11, 2018","tags":["react"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/post/learn_react16_part4/","previous":{"fields":{"slug":"/post/learn_react16_part3/"},"frontmatter":{"title":"react 16学习(三)"}},"next":{"fields":{"slug":"/post/vue_technology_stack/"},"frontmatter":{"title":"vue 全家桶初探"}}}}