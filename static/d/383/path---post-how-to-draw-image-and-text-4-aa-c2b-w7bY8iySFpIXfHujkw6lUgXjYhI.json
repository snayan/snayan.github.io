{"data":{"avatar":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIEBQP/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQD/2gAMAwEAAhADEAAAAcSerUQpOzXUqiMAb//EABsQAAMAAgMAAAAAAAAAAAAAAAABAhESAxQh/9oACAEBAAEFAjzJ1VJcZepyU9x0z//EABURAQEAAAAAAAAAAAAAAAAAABEg/9oACAEDAQE/AWP/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAbEAADAAIDAAAAAAAAAAAAAAAAASEQERIxMv/aAAgBAQAGPwImPUNtcTodiz//xAAcEAACAgMBAQAAAAAAAAAAAAAAAREhMUFRYXH/2gAIAQEAAT8hWbK7l6NWStvasZEW4S7fwfTTAkNzkQZ//9oADAMBAAIAAwAAABAs1wP/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEQ/9oACAEDAQE/EMLbwL//xAAXEQEBAQEAAAAAAAAAAAAAAAABEQAQ/9oACAECAQE/EIzR4rv/xAAfEAEAAwACAQUAAAAAAAAAAAABABEhMUFRYXGBodH/2gAIAQEAAT8QAjVRsF68R3WyhBpEB4otans9oxQXOZRxVfkow9YivuDFJrEfPmaECm2kqIiV2XP/2Q==","width":40,"height":40,"src":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg","srcSet":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg 1x,\n/static/9d156e8486b343189790da372acb0018/9c097/my.jpg 1.5x,\n/static/9d156e8486b343189790da372acb0018/bd6c6/my.jpg 2x"}}},"site":{"siteMetadata":{"title":"三羊的小站","author":"三羊","postPath":"/post","contentUrl":"https://github.com/snayan/blog-source/tree/master/content/blog","ableZan":true,"menu":{"search":{"name":"搜索","link":"/search"}}}},"markdownRemark":{"id":"919446d9-cfbb-5a92-b2ae-56702c0ad264","excerpt":"这篇是学习和回顾 canvas 系列笔记的第三篇，完整笔记详见：canvas 核心技术通过上一篇canvas 核心技术-如何绘制图形的学习，我们知道了如何绘制任意多边形以及图片的填充规则。在 canvas 中应用比较多的还有绘制图片和文本。这篇文章，我们就来详细聊聊图片和文本的绘制。在 canvas…","html":"<p>这篇是学习和回顾 canvas 系列笔记的第三篇，完整笔记详见：<a href=\"/post/core_html5_canvas/\">canvas 核心技术</a></p>\n<p>通过上一篇<a href=\"/post/how_to_draw_graphics/\">canvas 核心技术-如何绘制图形</a>的学习，我们知道了如何绘制任意多边形以及图片的填充规则。在 canvas 中应用比较多的还有绘制图片和文本。这篇文章，我们就来详细聊聊图片和文本的绘制。</p>\n\n        <h3 id='toc-3-1' >\n          图片\n        </h3>\n      \n<p>在 canvas 中，我们可以把一张图片直接绘制到 canvas 上，跟使用<code class=\"language-text\">img</code>标签类似，不同的是，图片是绘制到 canvas 画布上的，而非独立的 html 元素。canvas 提供了<code class=\"language-text\">drawImage</code>方法来绘制图片，这个方法可以有三种形式的用法，如下，</p>\n<ul>\n<li><code class=\"language-text\">void drawImage(image,dx,dy);</code>直接将图片绘制到指定的 canvas 坐标上，图片由 image 传入，坐标由 dx 和 dy 传入。</li>\n<li><code class=\"language-text\">void drawImage(image,dx,dy,dw,dh);</code>同上面形式，只不过指定了图片绘制的宽度和高度，宽高由 dw 和 dh 传入。</li>\n<li><code class=\"language-text\">void drawImage(image,sx,sy,sw,sh,dx,dy,dw,dh);</code>这个是最复杂，最灵活的使用形式，第一参数是待绘制的图片元素，第二个到第五个参数，指定了原图片上的坐标和宽高，这部分区域将会被绘制到 canvas 中，而其他区域将忽略，最后四个参数跟形式二一样，指定了 canvas 目标中的坐标和宽高。</li>\n</ul>\n<!--more-->\n<p>根据参数个数，我们会分别调用不同形式的<code class=\"language-text\">drawImage</code>，第一种形式最简单，就是将原图片直接绘制到目标 canvas 指定坐标处，图片宽高就是原图片宽高，不会缩放。第二种形式呢，指定了目标 canvas 绘制区域的宽高，那么图片最终被绘制在 canvas 上的宽高被固定了，图片会被缩放，如果指定的 dw 和 dh 与原图片的宽高不是等比例的，图片会被压缩或者拉伸变形。第三种形式，分别指定了原图片被绘制的区域和目标 canvas 中的区域，通过 sx，sy，sw，sh 我们可只选择原图片中某一部分区域，也可以指定完整的图片，通过 dx，dy，dw，dh 我们待绘制的目标 canvas 区域。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 创建img元素</span>\n<span class=\"token keyword\">let</span> img <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"img\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// 指定img的src</span>\nimg<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token string\">\"./learn9/google.png\"</span>\nimg<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"load\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 将img元素调用drawImage(img,dx,dy)绘制出来</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token boolean\">false</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/68264343ddf2fc9585c5af15a797cd6f/52699/drawImage1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 52.03761755485894%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAPoAAAD6AG1e1JrAAAB+UlEQVQoz31SXWsTQRTdP+C70J8hWNCq1FQLCoUo1NLiW599EvWhoGxLQH2wrYIiSCwWiUVFCX2SapMU0qalhRJrjFTNLqFNsjM7Mzub3Z2vdbbVFxEPw3zcey733OEYnue5rqsY+dF0c8XOsw+dlSoMfOwRjBD+DyCEhgOAktGLkt9vwiuzaPwpPjvlXstiP2BCcMY5Z4xHUbL/AWNMSg4hMFgXvSqHp0xarPH4ABZQ+U3GZfw3lPp9HFy0ZGOvDc9l8MJqpN9C/oPNvlT9hfloYy2WMlYJQ5Lt2J7BjUWj/Nk5M4kt57BOza9EmffBvXwwvdi1aBzNPd4/fwJNXO8MpdCdG0mDnzNs6Ui8mXLXrhpbdXDaxPU9oRNcqGwhNN8G9/P+8clw+VPDv9DrlwpJqvG9PXAyLOXFao+w53SEoI5BiTv2iNx+HSR6VLI0qo1ocFZayxV0sU9AcDiEMzpMsxNyvUeSWlJMsNGlaMeOBjLerZy/bYndlny3wfqnyJOPLFZhKz2I75qSYPryeSvVy+2GWD8mtobjyMbNggEg1C31zDdz3fQDemmajjykbypMBxO1X3fA+KgzMgTG0mFxKfkVryYqfap0FJUvG9ohDoABxTzAzZa7a7vaHSLQDkEuhDgIEaXgW13TMGMIAkRChEPUrrX37V8qpP4rw23BXAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <picture>\n        <source\n          srcset=\"/static/68264343ddf2fc9585c5af15a797cd6f/cc182/drawImage1.webp 148w,\n/static/68264343ddf2fc9585c5af15a797cd6f/f7e40/drawImage1.webp 295w,\n/static/68264343ddf2fc9585c5af15a797cd6f/1a2f4/drawImage1.webp 590w,\n/static/68264343ddf2fc9585c5af15a797cd6f/e2250/drawImage1.webp 638w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/68264343ddf2fc9585c5af15a797cd6f/cf440/drawImage1.png 148w,\n/static/68264343ddf2fc9585c5af15a797cd6f/d2d38/drawImage1.png 295w,\n/static/68264343ddf2fc9585c5af15a797cd6f/b9e4f/drawImage1.png 590w,\n/static/68264343ddf2fc9585c5af15a797cd6f/52699/drawImage1.png 638w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n          src=\"/static/68264343ddf2fc9585c5af15a797cd6f/b9e4f/drawImage1.png\"\n          alt=\"drawImage1\"\n          title=\"\"\n        />\n      </picture>\n  </span>\n  </a></p>\n<p>上面这个示例，这张 Google 图片的原始大小是 544*184，而 canvas 区域的大小是默认的 300*150。我们调用了第一种形式，直接将图片绘制到 canvas 的坐标原点处，图片没有被缩放，超出了 canvas 区域，超出的部分，会被 canvas 忽略的。有一点需要注意的是，我是在图片的<code class=\"language-text\">onload</code>事件中才开始绘制的，因为图片没有加载完毕，直接绘制图片是无效的。下面的代码示例，我都将只贴出<code class=\"language-text\">onload</code>事件里的代码，图片加载部分代码都相同，就省略了。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 获取canvas宽度</span>\n<span class=\"token keyword\">let</span> canvasWidth <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span>width\n<span class=\"token comment\">// 获取canvas高度</span>\n<span class=\"token keyword\">let</span> canvasHeight <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span>height\nctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> canvasWidth<span class=\"token punctuation\">,</span> canvasHeight<span class=\"token punctuation\">)</span></code></pre></div>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/633c2addbf104e5d0392f818a406a181/77dff/drawImage2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 51.446945337620576%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAPoAAAD6AG1e1JrAAAB+ElEQVQoz3WSXWsTQRSG9//4X8S79qJ4V0FEKMQWaVM0UClZidQSxcaPRUm6abVpmtiaXvgVWmMjplqwEquFpGmSzX5vdie7sztz3N1gb4oHBs487xwOc97DaKrcEaR7eSHGdw+PZUNXFUU9Hz7TNa0tdj8f13RN94kkSYxpqHPrg3gRL25jrowBgFA4H5QGtG322NrjIcEYM+/3xdkVM5SHBwiyPKEzJAQ1qWv5uYFI34KmLrC1J0DB7Zxie8CkSkKuOvDl/BcnW3FPBMeaj4pjl+zdKtWKuHwBDscN5N3MovEl53a++fAo4/DL8pUxPbfKPN0WVitB8YsP6OoK8IkScAtOV9CiEe9g1BsI0Iisl4rZKtRbdOJlJ7lz17w13X+QEKM3mMoPaTJjhr8gj/bg7f0cbKQJgDZzzf066vm4w6bX0u/qoPdhutBdLLP65RFUWLNVhUGmurCFJpdR7BWayXlu+1Sbuq7NRvrcc9Kaw7UROLj4q9Ga4t1oFk/wjeTPZ1b8jh6PKakk4w/ddb3NfZzZcQwr6GR/q5kZjtoOJab3h6XaHqbwqW5zH53ElnriND2hZ3JL6KgeFBNC4D9Bwvn/7pL5Ao6/dkrfXf/qhWYGVomi6NstK6okny2EosrSv1xSFNnfhdyumHrTCzVFCR7Ikij+BdaoAFT8eWrVAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <picture>\n        <source\n          srcset=\"/static/633c2addbf104e5d0392f818a406a181/cc182/drawImage2.webp 148w,\n/static/633c2addbf104e5d0392f818a406a181/f7e40/drawImage2.webp 295w,\n/static/633c2addbf104e5d0392f818a406a181/1a2f4/drawImage2.webp 590w,\n/static/633c2addbf104e5d0392f818a406a181/bc6b6/drawImage2.webp 622w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/633c2addbf104e5d0392f818a406a181/cf440/drawImage2.png 148w,\n/static/633c2addbf104e5d0392f818a406a181/d2d38/drawImage2.png 295w,\n/static/633c2addbf104e5d0392f818a406a181/b9e4f/drawImage2.png 590w,\n/static/633c2addbf104e5d0392f818a406a181/77dff/drawImage2.png 622w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n          src=\"/static/633c2addbf104e5d0392f818a406a181/b9e4f/drawImage2.png\"\n          alt=\"drawImage2\"\n          title=\"\"\n        />\n      </picture>\n  </span>\n  </a></p>\n<p>我们把目标 canvas 区域指定为 canvas 的宽高，图片总是会被绘制在整个 canvas 中，同时也可以看到绘制出来的图片变形了。我们可以通过计算出原图片的宽高比，根据 canvas 目标区域的宽度来计算出 canvas 目标区域的高度，或者根据 canvas 目标区域的高度来计算出 canvas 目标区域的宽度。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 获取图片的宽度</span>\n<span class=\"token keyword\">let</span> imgWidth <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>width\n<span class=\"token comment\">// 获取图片的高度</span>\n<span class=\"token keyword\">let</span> imgHeight <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>height\n<span class=\"token comment\">// 指定目标canvas区域的宽度</span>\n<span class=\"token keyword\">let</span> targetWidth <span class=\"token operator\">=</span> canvasWidth\n<span class=\"token comment\">// 计算出目标canvas区域的高度</span>\n<span class=\"token keyword\">let</span> targetHeight <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>imgHeight <span class=\"token operator\">*</span> targetWidth<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> imgWidth\nctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> targetWidth<span class=\"token punctuation\">,</span> targetHeight<span class=\"token punctuation\">)</span></code></pre></div>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/825fe68212d72cbc99b8aa467948cc3f/f1147/drawImage3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 51.75718849840256%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAPoAAAD6AG1e1JrAAABqUlEQVQoz5VQz08TQRTeP9OjB6NXVBJjD+IFaKAxoh7UgNFKDaQQoaH4A1KxwoUDtlZLmu2KCdAu+2Nmd2Z/dXfePHcLxnqTLzPz3jff+17ynuIx+6BjTK/o9970tw5M7lJCHco4JSQ7jkdpGonjkIBztadtd774zKOc6/2+0j0mueXgx6nUXeyeSUSUUYQuxQwSEwNlnGY8AgRs2Z255utM8TnjXFmsGS93gpR+aAyW9+GwbUZPZ2n+frjzGYzF+Nt1PJro9rxCNSysw/T2YfF7EYpFkhszKqtK7as5+dZLzX0rvlvF1ckyludFlNDxq6JxRaTCr1tPlt7taaie4NiG9qKSC25c81ZK5sdNxWO0tBsUNqKFWvi8DuHJKX8w5T7M+5U16D1K2jdRu906sp7VBnNVuLPeKbdLg5k8ezxr1T8p6T4kQI+AqotEZDMDtRNNHY6cAGuidI4JvqqHU2vBZiNEFMIP4KfqmmZmFgLwfD/y4o6S9PUH8n0z3mrFiRhyyL4ZY5kZAIbF8k8LOZpf9BqRztV/zP+Pv2bbti3LopeE4zi6rv8G1cQZHCR5oPsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <picture>\n        <source\n          srcset=\"/static/825fe68212d72cbc99b8aa467948cc3f/cc182/drawImage3.webp 148w,\n/static/825fe68212d72cbc99b8aa467948cc3f/f7e40/drawImage3.webp 295w,\n/static/825fe68212d72cbc99b8aa467948cc3f/1a2f4/drawImage3.webp 590w,\n/static/825fe68212d72cbc99b8aa467948cc3f/61a1a/drawImage3.webp 626w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/825fe68212d72cbc99b8aa467948cc3f/cf440/drawImage3.png 148w,\n/static/825fe68212d72cbc99b8aa467948cc3f/d2d38/drawImage3.png 295w,\n/static/825fe68212d72cbc99b8aa467948cc3f/b9e4f/drawImage3.png 590w,\n/static/825fe68212d72cbc99b8aa467948cc3f/f1147/drawImage3.png 626w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n          src=\"/static/825fe68212d72cbc99b8aa467948cc3f/b9e4f/drawImage3.png\"\n          alt=\"drawImage3\"\n          title=\"\"\n        />\n      </picture>\n  </span>\n  </a></p>\n<p>从图可以看到，根据图片宽高比计算出来的目标 canvas 区域，最终，图片绘制出来的效果是等比例缩放，没有变形。</p>\n<p>我们再来看看最为复杂，且最为灵活的第三种方式。使用这种方式，我们可以把 Google 这张图片中的红色的那个 o 部分绘制出来。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> <span class=\"token number\">143</span><span class=\"token punctuation\">,</span> <span class=\"token number\">48</span><span class=\"token punctuation\">,</span> <span class=\"token number\">90</span><span class=\"token punctuation\">,</span> <span class=\"token number\">90</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">90</span><span class=\"token punctuation\">,</span> <span class=\"token number\">90</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c81c3c01e60b22a639d468dd05807b49/83cbb/drawImage4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 51.910828025477706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAPoAAAD6AG1e1JrAAAA50lEQVQoz2N49/Hjm9evn69Y/Kip+vn61e8/fnr/4cP7d+/e4wUfPnx4+fIlA4iuKnwX5v25q+mtv8uXntb/QPDv33/c4B9Y9tOnTwwvtm167mj65+ljIP/Xtcsv7Y1/3bgKUvL3L2HNzxbMeRXsARX9+uWVl92Pw/tBnD9/CGt+c+US0OYvi2b//fzp04TOV94Ofz9+xO9yhOYPX799O7DnbUzQ61CvN4nhP8+fwe9mFM3AoPsL5Pz6+ff9u3+/fxEMLXTNf37/RgjjtRObzURowBFgb968ffv2AykAaN/Hjx9fvHgBAAeYL5mauaQMAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <picture>\n        <source\n          srcset=\"/static/c81c3c01e60b22a639d468dd05807b49/cc182/drawImage4.webp 148w,\n/static/c81c3c01e60b22a639d468dd05807b49/f7e40/drawImage4.webp 295w,\n/static/c81c3c01e60b22a639d468dd05807b49/1a2f4/drawImage4.webp 590w,\n/static/c81c3c01e60b22a639d468dd05807b49/939a5/drawImage4.webp 628w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/c81c3c01e60b22a639d468dd05807b49/cf440/drawImage4.png 148w,\n/static/c81c3c01e60b22a639d468dd05807b49/d2d38/drawImage4.png 295w,\n/static/c81c3c01e60b22a639d468dd05807b49/b9e4f/drawImage4.png 590w,\n/static/c81c3c01e60b22a639d468dd05807b49/83cbb/drawImage4.png 628w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n          src=\"/static/c81c3c01e60b22a639d468dd05807b49/b9e4f/drawImage4.png\"\n          alt=\"drawImage4\"\n          title=\"\"\n        />\n      </picture>\n  </span>\n  </a></p>\n<p>Google 这张图中，红色字母 o 在原图片中的坐标是(143,48)，宽高是 90*90，我们简单的把这个字母绘制在了 canvas 的(0,0)坐标处，宽高也是 90*90。可以再来复杂点，把这个红色的字母 o，让它的高度跟 canvas 的高度一样，且等比例放大宽度，且圆心正好在 canvas 中心，实现如下，</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 获取字母o的宽度</span>\n<span class=\"token keyword\">let</span> oWidth <span class=\"token operator\">=</span> <span class=\"token number\">90</span>\n<span class=\"token comment\">// 获取字母o的高度</span>\n<span class=\"token keyword\">let</span> oHeight <span class=\"token operator\">=</span> <span class=\"token number\">90</span>\n<span class=\"token comment\">// 指定目标canvas区域的高度</span>\n<span class=\"token keyword\">let</span> targetHeight <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span>height\n<span class=\"token comment\">// 计算出目标canvas区域的宽度</span>\n<span class=\"token keyword\">let</span> targetWidth <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>oWidth <span class=\"token operator\">*</span> targetHeight<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> oHeight\n<span class=\"token comment\">// 移动目标canvas坐标X</span>\n<span class=\"token keyword\">let</span> targetX <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>canvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">-</span> targetWidth<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span>\nctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>\n  img<span class=\"token punctuation\">,</span>\n  <span class=\"token number\">143</span><span class=\"token punctuation\">,</span>\n  <span class=\"token number\">48</span><span class=\"token punctuation\">,</span>\n  oWidth<span class=\"token punctuation\">,</span>\n  oHeight<span class=\"token punctuation\">,</span>\n  targetX<span class=\"token punctuation\">,</span>\n  <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  targetWidth<span class=\"token punctuation\">,</span>\n  targetHeight\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a2bea64fa42523a62e57469f7238a0be/f1147/drawImage5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 52.39616613418531%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAPoAAAD6AG1e1JrAAABfElEQVQoz2N49+7d27dv38PBu3fvv3z58OPn6/Nnn69c8mzJ/JcH973/+PHD9x/vkZR9+PDh5cuXDEDW379//0PAv38g4uvnL52NbxyMXxkoAdFrC+2POUl/7t5GKACTnz59QtIMFgKC9+V5z3Xk3saFfF274vuOLSCuocrrANc/z55ClGHR/O/PHyD549D+F0aqb2OD/r59A1IKlvrYWgs07vOETrDIH5yav8ye8lxL5su8GSB1v36BEJA+f/qFmda71CiY53Bo/jxz8nNtua9L5oFU/fwJ1Xzl4gtLnbdJEf///cWn+fv2Tc/1ld7lJP379ROkH2LijInPdeU/ttRAPIIzwP79+P42JRKo/0Nlwa9L53/fvvl5+oSX1novnc1+3biKrhkYz2hR9efxw/fZiS8MVF4YKL8wVnuuq/Am0PXn0YPw8INo/vjxIwMwuoH6P8DBu3cfv3//8O7tyy0bnk7ufTqx+/myRe8e3P/489cHJGVAna9fvwYA4tYCA297Q74AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <picture>\n        <source\n          srcset=\"/static/a2bea64fa42523a62e57469f7238a0be/cc182/drawImage5.webp 148w,\n/static/a2bea64fa42523a62e57469f7238a0be/f7e40/drawImage5.webp 295w,\n/static/a2bea64fa42523a62e57469f7238a0be/1a2f4/drawImage5.webp 590w,\n/static/a2bea64fa42523a62e57469f7238a0be/61a1a/drawImage5.webp 626w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/a2bea64fa42523a62e57469f7238a0be/cf440/drawImage5.png 148w,\n/static/a2bea64fa42523a62e57469f7238a0be/d2d38/drawImage5.png 295w,\n/static/a2bea64fa42523a62e57469f7238a0be/b9e4f/drawImage5.png 590w,\n/static/a2bea64fa42523a62e57469f7238a0be/f1147/drawImage5.png 626w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n          src=\"/static/a2bea64fa42523a62e57469f7238a0be/b9e4f/drawImage5.png\"\n          alt=\"drawImage5\"\n          title=\"\"\n        />\n      </picture>\n  </span>\n  </a></p>\n<p><code class=\"language-text\">drawImage</code>返回的第一参数 image，不仅可以是图片元素，实际上还可以是 canavs 元素，video 元素。常见的离屏 canvas 的使用，依就是将离屏不可见的 canvas 绘制到当前显示屏幕 canvas 上。离屏幕 canvas 这一部分将会在后续游戏部分中说到，这里不详细说了。</p>\n\n        <h3 id='toc-3-2' >\n          图像像素\n        </h3>\n      \n<p>跟图片绘制有关的函数还有 3 个，它们分别是<code class=\"language-text\">getImageData</code>，<code class=\"language-text\">putImageData</code>，<code class=\"language-text\">createImageData</code>。这些函数是直接可以改变图像中某一个具体的像素值，从而可以对图片做一些操作，比如滤镜。</p>\n<p>我们先来看看<code class=\"language-text\">getImageData</code>方法，它的调用方式是<code class=\"language-text\">let imgData = ctx.getImageData(sx,sy,sw,sh)</code>，接受四个参数，表示 canvas 区域的某一个矩形区域，这个矩形区域的左上角坐标是(sx,sy)，宽高是 sw 和 sh，它的返回值是一个<code class=\"language-text\">ImageData</code>类型的对象，包含的属性有<code class=\"language-text\">width</code>，<code class=\"language-text\">height</code>，<code class=\"language-text\">data</code>。</p>\n<ul>\n<li><code class=\"language-text\">ImageData.width</code>，无符号长整型，表示这个图像区域的像素的宽度。</li>\n<li><code class=\"language-text\">ImageData.height</code>，无符号长整型，表示这个图像区域的像素的高度。</li>\n<li><code class=\"language-text\">ImageData.data</code>，一个<code class=\"language-text\">Uint8ClampedArray</code>数组，数组里每 4 个单元，表示一个像素值。一个像数值用 RGBA 表示的，这 4 个单元分别表示 R，G，B，A，表示意思是红，绿，蓝，透明度，取值范围是 0 ～ 255。</li>\n</ul>\n<p>需要注意的是，如果我们在调用<code class=\"language-text\">ctx.getImageData(sx,sy,sw,sh)</code>，参数表示的矩形区域超出了 canvas 的区域，那么超出的部分将是用黑色的透明度为 0 的 RGBA 值表示，也就是(0,0,0,0)。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 获取图片的宽度</span>\n<span class=\"token keyword\">let</span> imgWidth <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>width\n<span class=\"token comment\">// 获取图片的高度</span>\n<span class=\"token keyword\">let</span> imgHeight <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>height\n<span class=\"token comment\">// 指定目标canvas区域的宽度</span>\n<span class=\"token keyword\">let</span> targetWidth <span class=\"token operator\">=</span> canvasWidth\n<span class=\"token comment\">// 计算出目标canvas区域的高度</span>\n<span class=\"token keyword\">let</span> targetHeight <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>imgHeight <span class=\"token operator\">*</span> targetWidth<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> imgWidth\nctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> targetWidth<span class=\"token punctuation\">,</span> targetHeight<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">let</span> imgData <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">getImageData</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> canvasWidth<span class=\"token punctuation\">,</span> canvasHeight<span class=\"token punctuation\">)</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`canvas.width = </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>canvasWidth<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`canvas.height = </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>canvasHeight<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>imgData<span class=\"token punctuation\">)</span></code></pre></div>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/246d7fddb814354be2075d7b277ea3f2/d02d5/getImageData1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 35.22561863173217%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAPoAAAD6AG1e1JrAAABKElEQVQY012QyU7DMBCG8/43kOCKkDhwLE/AdmmFqNgplCap6tZJ3HiJE4+dxjZOuJR+8mH+8Sy/HY0/2fVbU8kaRAWKaQWo5B/53FR127bW2vUAISRJEpxl6SZ/mv2sc4JWq2g0qe5j/zga29G5T4/Tr5uTsbu6PLIXZ7Drm/FAQQrGuJRSyIYJSRnnjEWLdT1JfPm93D0/eH6XLuent93sdWpfptq03nsFgPrdmzwvioJUogpJ51yYGwGA30O3DnMbgq7rjDEhCOYpY5QzIUSjVDi7gVAQyfBaMKBAK6VBGQ1dqyHooahf4h1eYZSgbUmyAYRQHMfhCyL/H9db2pO2F/W2we94saBlqbquDUODnWD5sPlwVsA7A6YmklOglGUZ1lr/3f4Cy+iJlCTBEkEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <picture>\n        <source\n          srcset=\"/static/246d7fddb814354be2075d7b277ea3f2/cc182/getImageData1.webp 148w,\n/static/246d7fddb814354be2075d7b277ea3f2/f7e40/getImageData1.webp 295w,\n/static/246d7fddb814354be2075d7b277ea3f2/1a2f4/getImageData1.webp 590w,\n/static/246d7fddb814354be2075d7b277ea3f2/4837b/getImageData1.webp 885w,\n/static/246d7fddb814354be2075d7b277ea3f2/2f819/getImageData1.webp 1180w,\n/static/246d7fddb814354be2075d7b277ea3f2/d3d11/getImageData1.webp 1374w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/246d7fddb814354be2075d7b277ea3f2/cf440/getImageData1.png 148w,\n/static/246d7fddb814354be2075d7b277ea3f2/d2d38/getImageData1.png 295w,\n/static/246d7fddb814354be2075d7b277ea3f2/b9e4f/getImageData1.png 590w,\n/static/246d7fddb814354be2075d7b277ea3f2/f9b6a/getImageData1.png 885w,\n/static/246d7fddb814354be2075d7b277ea3f2/2d849/getImageData1.png 1180w,\n/static/246d7fddb814354be2075d7b277ea3f2/d02d5/getImageData1.png 1374w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n          src=\"/static/246d7fddb814354be2075d7b277ea3f2/b9e4f/getImageData1.png\"\n          alt=\"getImageData1\"\n          title=\"\"\n        />\n      </picture>\n  </span>\n  </a></p>\n<p>可以看到，我们的 canvas 默认宽高是 300*150，通过<code class=\"language-text\">ctx.getImageData</code>获取整个 canvas 区域的像素数据值，得到的<code class=\"language-text\">ImageData</code>的设备像素的宽高也是 300*150 ，<code class=\"language-text\">Imagedata.data</code> 的数组的长度是 180000，这个是因为，这个 imgData 的像素数是 300*150，而每个像素是由 4 个分量表示的，所以<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>300</mn><mo>∗</mo><mn>150</mn><mo>∗</mo><mn>4</mn><mo>=</mo><mn>180000</mn></mrow><annotation encoding=\"application/x-tex\">300*150*4 = 180000</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">3</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">5</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">4</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">8</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span></span></span></span>了。</p>\n<p>当我们通过<code class=\"language-text\">getImageData</code>得到 canvas 某一个矩形区域的像素数据之后，我们可以通过改变这个<code class=\"language-text\">imageData.data</code>数组里的颜色分量值，再将改变后的<code class=\"language-text\">ImageData</code>通过<code class=\"language-text\">putImageData</code>方法绘制到 canvas 上。<code class=\"language-text\">putImageData</code>的用法有 2 种调用形式，如下，</p>\n<ul>\n<li><code class=\"language-text\">ctx.putImageData(imgData,dx,dy)</code>，这种方式，将 imgData 绘制到 canvas 区域(dx,dy)坐标处，绘制到 canvas 的区域的矩形大小就是 imgData 的矩形的大小。</li>\n<li><code class=\"language-text\">ctx.putImageData(imgData,dx,dy,dirtyX,dirtyY,dirtyW,dirtyH)</code>，不仅指定了 canvas 区域(dx,dy)，也指定了 imgData 脏数据区域的(dirtyX,dirtyY)和宽高 dirtyW，dirtyH。这种形式，可以只将 imgData 种某一块区域绘制到 canvas 上。</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> canvasWidth <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span>width\n<span class=\"token keyword\">let</span> canvasHeight <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span>height\n<span class=\"token keyword\">let</span> img <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"img\"</span><span class=\"token punctuation\">)</span>\nimg<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token string\">\"./learn9/google.png\"</span>\nimg<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"load\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 获取图片的宽度</span>\n    <span class=\"token keyword\">let</span> imgWidth <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>width\n    <span class=\"token comment\">// 获取图片的高度</span>\n    <span class=\"token keyword\">let</span> imgHeight <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>height\n    <span class=\"token comment\">// 指定目标canvas区域的宽度</span>\n    <span class=\"token keyword\">let</span> targetWidth <span class=\"token operator\">=</span> canvasWidth\n    <span class=\"token comment\">// 计算出目标canvas区域的高度</span>\n    <span class=\"token keyword\">let</span> targetHeight <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>imgHeight <span class=\"token operator\">*</span> targetWidth<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> imgWidth\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> targetWidth<span class=\"token punctuation\">,</span> targetHeight<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// 操作ImageData像素数据</span>\n    <span class=\"token keyword\">let</span> imgData <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">getImageData</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> canvasWidth<span class=\"token punctuation\">,</span> canvasHeight<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">oprImageData</span><span class=\"token punctuation\">(</span>imgData<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">r<span class=\"token punctuation\">,</span> g<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span> a</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>a <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 将透明的黑色像素值改变为不透明</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">,</span> g<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">,</span> g<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// 将imgData绘制到canvas的中心。超出canvas区域将被自动忽略</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">putImageData</span><span class=\"token punctuation\">(</span>imgData<span class=\"token punctuation\">,</span> canvasWidth <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> canvasHeight <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token boolean\">false</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// 遍历像素数据</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">oprImageData</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">imgData<span class=\"token punctuation\">,</span> oprFunction</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> data <span class=\"token operator\">=</span> imgData<span class=\"token punctuation\">.</span>data\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> l <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> l<span class=\"token punctuation\">;</span> i <span class=\"token operator\">=</span> i <span class=\"token operator\">+</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> pixel <span class=\"token operator\">=</span> <span class=\"token function\">oprFunction</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    data<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> pixel<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n    data<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> pixel<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n    data<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> pixel<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n    data<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> pixel<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/04688a589c6c7c1782233aeb815be937/83cbb/putImageData1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 52.547770700636946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAPoAAAD6AG1e1JrAAACXklEQVQoz2N48ertkn0v5+x4cfXem48f3r198+bt69dv37599+7tu7evQOjduzdv3716DeS+v/LoxpOXT9+/efvm9es3b94w1K76tvjwt81nfmw9//3//79///779///v3//gKy/QD5UCIj//P//v+/s/Euvb/4Hg9evXzMsOvwLyHrz+d/jN3+//v3/49DejxM6fl27/v//lz+3Gv7c6/n//8epu3+n7Pq6/ez/7rNLrz25+GfNqm+b1rx5/oxh6/nfQM0bT30vXft/wewzf3vrfty8/r6h8dfJlF8v1v57MOH+qZaadf+vP/laueh7xYk1Z3qLPzfUvC7LfXZoP0PRku8XHv5+//l3847/x9Ye+91b/+fLp/fVtT8PBvz9fP7/161PzpZ1bAOa/3Pqrv8tt3benVr5v6vt/+1rHx8/Yrj1/F/35u/N674duApy/9dN6z40Vnw7cfL//0+nljpNLJQ6dOlZ/cb/1lk77KKmBlWltTaXTnd16jTV27JwHsN/bOD3b5Bf2jt7JdxmKXt0KFimqtplMIAAIxCzsLAAyfj4eJDmP3/+//n7/+8/sD4Q58+f38Cw/bv+xCcl1wYmBgZeYQUBKT1GbmF/Bem5tqbWYuKcbAzLp+aANP/DAL//AE36veXqf1HDeKBmNfs87YQNySnTV5lr2MlIrrC0WVoism91HlQzhrNBsTpl3nqV0GXCSjYsHAKKwTODHROmq0tysjDP0zVYW8K1ZFoywxts4OXLlz9+/po7a1p4ak390qc1i54WdGxyc3fZVJj7or58dnpmaqLHq8uzAURV3kPk2hh9AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <picture>\n        <source\n          srcset=\"/static/04688a589c6c7c1782233aeb815be937/cc182/putImageData1.webp 148w,\n/static/04688a589c6c7c1782233aeb815be937/f7e40/putImageData1.webp 295w,\n/static/04688a589c6c7c1782233aeb815be937/1a2f4/putImageData1.webp 590w,\n/static/04688a589c6c7c1782233aeb815be937/939a5/putImageData1.webp 628w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/04688a589c6c7c1782233aeb815be937/cf440/putImageData1.png 148w,\n/static/04688a589c6c7c1782233aeb815be937/d2d38/putImageData1.png 295w,\n/static/04688a589c6c7c1782233aeb815be937/b9e4f/putImageData1.png 590w,\n/static/04688a589c6c7c1782233aeb815be937/83cbb/putImageData1.png 628w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n          src=\"/static/04688a589c6c7c1782233aeb815be937/b9e4f/putImageData1.png\"\n          alt=\"putImageData1\"\n          title=\"\"\n        />\n      </picture>\n  </span>\n  </a></p>\n<p>上面，我们遍历了<code class=\"language-text\">ImageData</code>中 data 数组，并将透明度为 0 的像素值的透明度变为 1（<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>255</mn><mi mathvariant=\"normal\">/</mi><mn>255</mn><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">255/255=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">2</span><span class=\"mord\">5</span><span class=\"mord\">5</span><span class=\"mord\">/</span><span class=\"mord\">2</span><span class=\"mord\">5</span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>）。在遍历像素数组时，我们每便利一次，<code class=\"language-text\">i</code> 的值加 4，这个是因为一个像素值是用 4 个数组单元值表示的，分别为 R，G，B，A，我们可以只改变某一个像素值的某一个分量值，例如透明度。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">ctx<span class=\"token punctuation\">.</span><span class=\"token function\">putImageData</span><span class=\"token punctuation\">(</span>imgData<span class=\"token punctuation\">,</span> canvasWidth <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> canvasHeight <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">79</span><span class=\"token punctuation\">,</span> <span class=\"token number\">27</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f61f220565cc8d80911f64b684df3dbb/83cbb/putImageData2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 52.22929936305732%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAPoAAAD6AG1e1JrAAAB4klEQVQoz4VSS2sTURQeBF24FFyIP8O9/8A/4aYrF1XELOKDCq1JDamL1CJJECXWRKuYFFTy0NgGrLRjNW1RY6UNtjPamfuYzCtz597TO1MVV/px7j33O/d8cM7hKK5Nd3Qj//Jnek5vqIZFMEIYW1bkpJEBxgQhRAi2Lbq7p3W+vrMIlQmmaSomQuPPvPnVsKfD8jcOEpyD58EBhAuCSR+EAgTs2HpaLUThoR8EgVJfMW7WHMmXesH8+2Bty/dLeTxxxWu0BGmy7ghsJhHBufowU2PZen964x6rVfG1S/RpRVG/mFcfRWKDslQD7mQX4Pa4LIAkRtnimZAPQUuVnxQfq7CHxfk5Lfc6NRg5OygVredVxbVxddm/UfVmO8NckyGduNMZa+aW/WCWa0X2OQG90a3+Zr4tCk12sbx9f6PkTGVwdsJeaClyKCC4Rni3z7yhiFq2aPBpTbCoVU5XgenIgbttb7LmPXwbyFgYcvi+7ZuGgjFmIf81HRFZfP6Q6MVC8Wo9qK/D4pJKO+0fb1qdFVV+RGLOOfyWxMl/Ex5zEGEo74/ZyXMnjl04ebx5OSG5LBsdiP8NHpfnzkydOnzo9NEju+nrvhRTSuMd+A/kwji+/6JS7o4lP4wlK8WC5Tj7o5IHzJcYGRcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <picture>\n        <source\n          srcset=\"/static/f61f220565cc8d80911f64b684df3dbb/cc182/putImageData2.webp 148w,\n/static/f61f220565cc8d80911f64b684df3dbb/f7e40/putImageData2.webp 295w,\n/static/f61f220565cc8d80911f64b684df3dbb/1a2f4/putImageData2.webp 590w,\n/static/f61f220565cc8d80911f64b684df3dbb/939a5/putImageData2.webp 628w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/f61f220565cc8d80911f64b684df3dbb/cf440/putImageData2.png 148w,\n/static/f61f220565cc8d80911f64b684df3dbb/d2d38/putImageData2.png 295w,\n/static/f61f220565cc8d80911f64b684df3dbb/b9e4f/putImageData2.png 590w,\n/static/f61f220565cc8d80911f64b684df3dbb/83cbb/putImageData2.png 628w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n          src=\"/static/f61f220565cc8d80911f64b684df3dbb/b9e4f/putImageData2.png\"\n          alt=\"putImageData2\"\n          title=\"\"\n        />\n      </picture>\n  </span>\n  </a></p>\n<p>我们通过指定了<code class=\"language-text\">ImageData</code>中脏数据区域，只绘制了红色字母 o，其他部分忽略。上面在调用<code class=\"language-text\">putImageData</code>之前，我们通过遍历像素数据改变了部分像素值的透明度，这种可以操作像素值的方式，在图像处理等领域是非常有用的，例如常见的图像灰度和反相颜色等。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 操作ImageData像素数据</span>\n<span class=\"token keyword\">let</span> imgData <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">getImageData</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> canvasWidth<span class=\"token punctuation\">,</span> canvasHeight<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// 清除canvas</span>\nctx<span class=\"token punctuation\">.</span><span class=\"token function\">clearRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> canvasWidth<span class=\"token punctuation\">,</span> canvasHeight<span class=\"token punctuation\">)</span>\n<span class=\"token function\">oprImageData</span><span class=\"token punctuation\">(</span>imgData<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">r<span class=\"token punctuation\">,</span> g<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span> a</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 反相颜色</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token number\">255</span> <span class=\"token operator\">-</span> r<span class=\"token punctuation\">,</span> <span class=\"token number\">255</span> <span class=\"token operator\">-</span> g<span class=\"token punctuation\">,</span> <span class=\"token number\">255</span> <span class=\"token operator\">-</span> b<span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\nctx<span class=\"token punctuation\">.</span><span class=\"token function\">putImageData</span><span class=\"token punctuation\">(</span>imgData<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fd1c081adcbce3a92c4c154b7ce6245b/24a49/putImageData3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 52.6813880126183%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAPoAAAD6AG1e1JrAAAB2UlEQVQoz5VSz2sTQRTeP8yTdyNYLyoUEekt4CGtqCdBKEo9SKEITTCYGMQSWkk8Fa22pbVpU7Vpkq5ubHezidmfszu1ZrPzyzcb/wD7MW947837HjPfGwXhYU/b12ply9QQCjzPc8A8H+C6vu34CTzPtT1I/LI9C9I+1CCElJ/rC19eXFWrD9orGUJGnAsA55xSKgSDxRgF40we9Kuqu2OKBD6Q69lLnMYQkAgDyx6RrGE18B/IVD+z7DsaU0HObHMrF/Q+mm/qp7uDjeHZewcHYag0l9JQZ+7kG6XJw7eZdKtX0K0ZTXtU+X3nGZstkennRK9MGVv5/Vcpc6FQXtVvq52J2lFBPVbqi6nQqMkrbc5vLt+91bbBf9o/ufDErXwQg0Bczjjt4hVI/vj0cDCfn1tRJw6/r9qoMbAVdFL7Vrh2ULzRLKdFfPrS9K7vHT3uGF2HTc7GqfvR2oEIW69by9N7uYt6cclo4nsdfaapbxh9hYEwnDMyTISSW/RPHUGoiEagmehu547X5hqlm1HYhzCmdCQEhjdTQgSXFZwlXZIOjEs+l0vKP0R6d3sR974mZSC97I2CQCGE8P/AeDxjH+jgB0BO5nk+jHtJMnyf8JwAGsbYsqy/v0RJyVNb3IkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <picture>\n        <source\n          srcset=\"/static/fd1c081adcbce3a92c4c154b7ce6245b/cc182/putImageData3.webp 148w,\n/static/fd1c081adcbce3a92c4c154b7ce6245b/f7e40/putImageData3.webp 295w,\n/static/fd1c081adcbce3a92c4c154b7ce6245b/1a2f4/putImageData3.webp 590w,\n/static/fd1c081adcbce3a92c4c154b7ce6245b/ab069/putImageData3.webp 634w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/fd1c081adcbce3a92c4c154b7ce6245b/cf440/putImageData3.png 148w,\n/static/fd1c081adcbce3a92c4c154b7ce6245b/d2d38/putImageData3.png 295w,\n/static/fd1c081adcbce3a92c4c154b7ce6245b/b9e4f/putImageData3.png 590w,\n/static/fd1c081adcbce3a92c4c154b7ce6245b/24a49/putImageData3.png 634w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n          src=\"/static/fd1c081adcbce3a92c4c154b7ce6245b/b9e4f/putImageData3.png\"\n          alt=\"putImageData3\"\n          title=\"\"\n        />\n      </picture>\n  </span>\n  </a></p>\n<p>将颜色分量的 RGB 值都用 255 减去原颜色分量值，可以看到，Google 每个字母的颜色都与原图片的颜色不一样了。这个在改变每个颜色分量的值，用不通的逻辑计算，就可以得到不同的处理后的图片。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 操作ImageData像素数据</span>\n<span class=\"token keyword\">let</span> imgData <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">getImageData</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> canvasWidth<span class=\"token punctuation\">,</span> canvasHeight<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// 清除canvas</span>\nctx<span class=\"token punctuation\">.</span><span class=\"token function\">clearRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> canvasWidth<span class=\"token punctuation\">,</span> canvasHeight<span class=\"token punctuation\">)</span>\n<span class=\"token function\">oprImageData</span><span class=\"token punctuation\">(</span>imgData<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">r<span class=\"token punctuation\">,</span> g<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span> a</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> avg <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>r <span class=\"token operator\">+</span> g <span class=\"token operator\">+</span> b<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">3</span>\n  <span class=\"token comment\">// 灰度</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>avg<span class=\"token punctuation\">,</span> avg<span class=\"token punctuation\">,</span> avg<span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\nctx<span class=\"token punctuation\">.</span><span class=\"token function\">putImageData</span><span class=\"token punctuation\">(</span>imgData<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/07d27fe6d857c545d1aa9076e542db60/f84ea/putImageData4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 52.84810126582279%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAPoAAAD6AG1e1JrAAABWklEQVQoz5WSzYuCUBTF/f/XuQpaaWghfWGBRREFLSKpsFYRQSgVZVkQ9DHO/PQyzrY5i8fxvXPuue8+lSiKNpvNbDYLguB8PodheDweT6cThBUephCy2+0Oh4N8IlYmk0mtVhsMBr1e7/V6faeI4/j9fgv/+gXccRz0sp+YK5WKHDweD9bb7UYh3/fhdLRYLCh0v9/n8zlp9Xp9Op1ut9vlcnm5XJR2u43O87xWq9Xtdg3DGI1GpmkOh0OqjMdjCE1hRlAsFkulEhpVVfv9fpLMTfBz3Gw2NU2DQwqFAslkWpZl2zabruvqup7L5TgibL1eK8zJTtHpdOif2Hw+Twj9c0P6RLBarQhnNNVqlYxGo1Eul/ErMhgZFddjfT6fQqgl+xjoXyqKGNf1ek3MmTROIVUy8IkOP4+UDR+SDIwy8QfInhD8mbP3/BxSKzHzu0T/BDYust/vfwDx1k/6kJDJrQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <picture>\n        <source\n          srcset=\"/static/07d27fe6d857c545d1aa9076e542db60/cc182/putImageData4.webp 148w,\n/static/07d27fe6d857c545d1aa9076e542db60/f7e40/putImageData4.webp 295w,\n/static/07d27fe6d857c545d1aa9076e542db60/1a2f4/putImageData4.webp 590w,\n/static/07d27fe6d857c545d1aa9076e542db60/f206f/putImageData4.webp 632w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/07d27fe6d857c545d1aa9076e542db60/cf440/putImageData4.png 148w,\n/static/07d27fe6d857c545d1aa9076e542db60/d2d38/putImageData4.png 295w,\n/static/07d27fe6d857c545d1aa9076e542db60/b9e4f/putImageData4.png 590w,\n/static/07d27fe6d857c545d1aa9076e542db60/f84ea/putImageData4.png 632w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n          src=\"/static/07d27fe6d857c545d1aa9076e542db60/b9e4f/putImageData4.png\"\n          alt=\"putImageData4\"\n          title=\"\"\n        />\n      </picture>\n  </span>\n  </a></p>\n<p>通过取 RGB 的平均值，原图片的每个字母都是灰色的了，当然，在计算的时候，可以给每个分量加一个系数，例如公式<code class=\"language-text\">let avg = 0.299r + 0.587g + 0.114b</code>，具体应用可以查看<a href=\"https://en.wikipedia.org/wiki/Grayscale\">Grayscale</a>。</p>\n<p>最后来看看<code class=\"language-text\">createImageData</code>，这个很好理解了，就是创建一个<code class=\"language-text\">ImageData</code> 对象了，有两种形式，如下，</p>\n<ul>\n<li><code class=\"language-text\">ctx.createImageData(width,height)</code>，可以指定宽高，创建一个<code class=\"language-text\">ImageData</code>对象，<code class=\"language-text\">ImageData.data</code>中的像素值都是一个透明的黑色，也就是（0，0，0，0）。</li>\n<li><code class=\"language-text\">ctx.createImageData(imgData)</code>，可以指定一个已经存在的<code class=\"language-text\">ImageData</code> 对象来创建一个新的<code class=\"language-text\">ImageData</code>对象，新创建的<code class=\"language-text\">ImageData</code>对象的宽高与参数中的<code class=\"language-text\">ImageData</code> 的宽高一样，但是像素值就不一样了，新创建出来的<code class=\"language-text\">ImageData</code>的像素值都是透明的黑色，也就是（0，0，0，0）。</li>\n</ul>\n\n        <h3 id='toc-3-3' >\n          文本\n        </h3>\n      \n<p>在 canvas 中，我们不仅可以绘制图形，图片，还可以绘制文本。绘制文本比较简单了，先设置当前 ctx 的画笔的文本样式，例如，字体大小，字体样式，对其方式等，跟 css 中比较相似。</p>\n<p>跟文本相关的方法有三个，如下，</p>\n<ul>\n<li><code class=\"language-text\">strokeText(text,x,y,maxWidth?)</code>，用描边的形式绘制指定的文本 text，其中也指定了绘制的坐标（x，y）, 还有最后一个可选参数，最大的宽度，如果所绘制的文本超过了指定的<code class=\"language-text\">maxWidth</code>，则文本会按照最大的宽度来绘制，那么文字之间的间距就将减少，文字可能被压缩。</li>\n<li><code class=\"language-text\">fillText(text,x,y,maxWidth?)</code>，同<code class=\"language-text\">strokeText</code>一样，只不过，是用填充的形式绘制文本，其参数含义一样。</li>\n<li><code class=\"language-text\">measureText(text)</code>，在当前的文字样式下，测量绘制文本 text 会占据的宽度值，返回一个对象，这个对象有一个<code class=\"language-text\">width</code>属性。主要注意的是，必须先设置文本样式，再来测量才是准确的。</li>\n</ul>\n<p>跟文本直接相关的属性设置，如下，</p>\n<ul>\n<li><code class=\"language-text\">font</code>，同 css 中含义一样，可以指定文本的字体大小，字体集，字体样式等。但在 canvas 中，<code class=\"language-text\">line-height</code>被强制设置为<code class=\"language-text\">normal</code>，会忽略其他设置的值。</li>\n<li><code class=\"language-text\">textAlign</code>，设置文本的水平对其方式，可选值有：<code class=\"language-text\">left</code>，<code class=\"language-text\">right</code>，<code class=\"language-text\">center</code>，<code class=\"language-text\">start</code>，<code class=\"language-text\">end</code>。默认值是<code class=\"language-text\">start</code>。各个含义参见<a href=\"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/textAlign\">textAlign 取值</a>。</li>\n<li><code class=\"language-text\">textBaseline</code>，设置文本的垂直对齐方式，可选值有：<code class=\"language-text\">top</code>，<code class=\"language-text\">hanging</code>，<code class=\"language-text\">middle</code>，<code class=\"language-text\">alphabetic</code>，<code class=\"language-text\">ideographic</code>，<code class=\"language-text\">bottom</code>。默认值是<code class=\"language-text\">alphabetic</code>。各个含义参见<a href=\"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/textBaseline\">textBaseline 取值</a>。</li>\n</ul>\n<p>当然了，还有一些其他的属性也会影响到文本最终绘制出来的效果，比如给当前 ctx 添加阴影效果，或者设置<code class=\"language-text\">fillStyle</code>的样式可以是图片或者渐变等。这些算是全局的属性设置，会影响到 canvas 所有其他的绘制，而不仅仅是文本，所以在这里，就不详细讨论了。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// textAlign的取值</span>\n<span class=\"token keyword\">let</span> textAligns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"left\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"right\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"center\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"start\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"end\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token comment\">// 描边颜色</span>\n<span class=\"token keyword\">let</span> colors <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"red\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"blue\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"green\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"orange\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"blueviolet\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token comment\">// 设置font</span>\nctx<span class=\"token punctuation\">.</span>font <span class=\"token operator\">=</span> <span class=\"token string\">\"18px sans-serif\"</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">,</span> textAlign<span class=\"token punctuation\">]</span> <span class=\"token keyword\">of</span> textAligns<span class=\"token punctuation\">.</span><span class=\"token function\">entries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  ctx<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// 设置textAlign</span>\n  ctx<span class=\"token punctuation\">.</span>textAlign <span class=\"token operator\">=</span> textAlign\n  <span class=\"token comment\">// 设置描边颜色</span>\n  ctx<span class=\"token punctuation\">.</span>strokeStyle <span class=\"token operator\">=</span> colors<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span>\n  <span class=\"token comment\">// 使用描边绘制文本</span>\n  ctx<span class=\"token punctuation\">.</span><span class=\"token function\">strokeText</span><span class=\"token punctuation\">(</span>textAlign<span class=\"token punctuation\">,</span> width <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span> <span class=\"token operator\">+</span> index <span class=\"token operator\">*</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span>\n  ctx<span class=\"token punctuation\">.</span><span class=\"token function\">restore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ba932f4b6cf10dceb4fd14b7a4b3b775/77dff/strokeText1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 52.41157556270096%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAPoAAAD6AG1e1JrAAAAxUlEQVQoz5WSawuCMBiF/f+/LIIyS/FCqSGmuauKlNNtTT9INSs7XwbnvA97d5iBEIIQEk0YE4QJiCIc+GRuQFGGOjjnUpcQQsredaS5kYxpifLYOzz6KhBp3h9jVjXdNL0UbpnYOWK7503TT+ZveMjkkNX3OkK+lx1ORdDz7j+4vFErMe3Mc2E418YH+KUw5MvriiNH/AePL21RwPM1r86L1x5vwXF3sdoasm+FAQDUP6HPIrQsaRrC2C6ypKAlVqKaFPUA2k9EEhx7Z+MAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <picture>\n        <source\n          srcset=\"/static/ba932f4b6cf10dceb4fd14b7a4b3b775/cc182/strokeText1.webp 148w,\n/static/ba932f4b6cf10dceb4fd14b7a4b3b775/f7e40/strokeText1.webp 295w,\n/static/ba932f4b6cf10dceb4fd14b7a4b3b775/1a2f4/strokeText1.webp 590w,\n/static/ba932f4b6cf10dceb4fd14b7a4b3b775/bc6b6/strokeText1.webp 622w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/ba932f4b6cf10dceb4fd14b7a4b3b775/cf440/strokeText1.png 148w,\n/static/ba932f4b6cf10dceb4fd14b7a4b3b775/d2d38/strokeText1.png 295w,\n/static/ba932f4b6cf10dceb4fd14b7a4b3b775/b9e4f/strokeText1.png 590w,\n/static/ba932f4b6cf10dceb4fd14b7a4b3b775/77dff/strokeText1.png 622w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n          src=\"/static/ba932f4b6cf10dceb4fd14b7a4b3b775/b9e4f/strokeText1.png\"\n          alt=\"strokeText1\"\n          title=\"\"\n        />\n      </picture>\n  </span>\n  </a></p>\n<p>我们把<code class=\"language-text\">textAlign</code>的各个属性全都设置了一遍，看到<code class=\"language-text\">start</code>与<code class=\"language-text\">left</code>的效果一样，<code class=\"language-text\">end</code>与<code class=\"language-text\">right</code>的效果一样，这个是因为<code class=\"language-text\">start</code>和<code class=\"language-text\">end</code>是与当前本地文字开始方向有关的，如果是左到右开始，那么<code class=\"language-text\">start</code>与<code class=\"language-text\">left</code>一样，而如果是右到左开始，那么<code class=\"language-text\">start</code>是与<code class=\"language-text\">right</code>效果一样了。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> textBaselines <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">\"top\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"hanging\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"middle\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"alphabetic\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"ideographic\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"bottom\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span>\n<span class=\"token comment\">// 描边颜色</span>\n<span class=\"token keyword\">let</span> colors <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"red\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"blue\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"green\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"orange\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"blueviolet\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"cyan\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token comment\">// 设置font</span>\nctx<span class=\"token punctuation\">.</span>font <span class=\"token operator\">=</span> <span class=\"token string\">\"18px sans-serif\"</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">,</span> textBaseline<span class=\"token punctuation\">]</span> <span class=\"token keyword\">of</span> textBaselines<span class=\"token punctuation\">.</span><span class=\"token function\">entries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  ctx<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// 设置textBaseline</span>\n  ctx<span class=\"token punctuation\">.</span>textBaseline <span class=\"token operator\">=</span> textBaseline\n  <span class=\"token comment\">// 设置描边颜色</span>\n  ctx<span class=\"token punctuation\">.</span>strokeStyle <span class=\"token operator\">=</span> colors<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span>\n  <span class=\"token comment\">// 使用描边绘制文本</span>\n  ctx<span class=\"token punctuation\">.</span><span class=\"token function\">strokeText</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"abj\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span> <span class=\"token operator\">+</span> index <span class=\"token operator\">*</span> <span class=\"token number\">50</span><span class=\"token punctuation\">,</span> height <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n  ctx<span class=\"token punctuation\">.</span><span class=\"token function\">restore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/652d20cabbb8a6363f7a37ca6c47a693/24a49/strokeText2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 52.05047318611987%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAPoAAAD6AG1e1JrAAAA2klEQVQoz62Sy04DMQxF8//fwifQFSxgVSEWIFXlJRCCmfEkTttJ4xfOsKQsBnEjRYniYyfXCSmlYRjG5eq6LgCAiNgSqarPiBg8x0/Yj8VHC2rLk3DOeYaZbd7P068qKHVqiaIqOtwqAxCzUyxNzGJqecLbt5tc9lYPtDljuPeI7eXu/W4ykxXRyuGUAiAet5u6XpvWp1c6vyilaDzA9eMV7MCYaHzg/cD+DPEqs4j8kjHGMCaUzw97eTaVY7WYlOVfDLNvD9RMTxvWWuWG/a1V/kmcj8vV9/0XrihEt8OUqrQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <picture>\n        <source\n          srcset=\"/static/652d20cabbb8a6363f7a37ca6c47a693/cc182/strokeText2.webp 148w,\n/static/652d20cabbb8a6363f7a37ca6c47a693/f7e40/strokeText2.webp 295w,\n/static/652d20cabbb8a6363f7a37ca6c47a693/1a2f4/strokeText2.webp 590w,\n/static/652d20cabbb8a6363f7a37ca6c47a693/ab069/strokeText2.webp 634w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/652d20cabbb8a6363f7a37ca6c47a693/cf440/strokeText2.png 148w,\n/static/652d20cabbb8a6363f7a37ca6c47a693/d2d38/strokeText2.png 295w,\n/static/652d20cabbb8a6363f7a37ca6c47a693/b9e4f/strokeText2.png 590w,\n/static/652d20cabbb8a6363f7a37ca6c47a693/24a49/strokeText2.png 634w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n          src=\"/static/652d20cabbb8a6363f7a37ca6c47a693/b9e4f/strokeText2.png\"\n          alt=\"strokeText2\"\n          title=\"\"\n        />\n      </picture>\n  </span>\n  </a></p>\n<p>我们又把<code class=\"language-text\">textBaseline</code>的各个值全设置了一遍，看到的效果如上图。用到最多的应该是<code class=\"language-text\">top</code>， <code class=\"language-text\">middle</code>，<code class=\"language-text\">alphabetic</code>，<code class=\"language-text\">bottom</code>了，其中默认值是<code class=\"language-text\">alphabetic</code> 。</p>\n<p><code class=\"language-text\">measureText</code>在实际业务中也是用到比较多的一个方法了，这个方法可以测量出在当前设置的文本样式下，绘制指定的 text 会占据的宽度。特别是在绘制表格数据，或者一些分析图时，需要绘制说明提示性文本，但是又想根据当前鼠标位置来决定文本绘制的坐标，以免超出 canvas 可见区域。这个方法使用比较简单，会返回一个带有<code class=\"language-text\">width</code>属性的对象，这个<code class=\"language-text\">width</code>属性值就是测量出来的结果。在 canvas 没有测量文本高度的方法，然而，在实际时，常常会以<strong>W</strong>字母测量出来的宽度值加上一点点，就可以大致认为是当前文本的高度值了。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 设置font，一定得先设置font属性，才能测量准确</span>\nctx<span class=\"token punctuation\">.</span>font <span class=\"token operator\">=</span> <span class=\"token string\">\"18px sans-serif\"</span>\n<span class=\"token keyword\">let</span> textWidth <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">measureText</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"W\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>width\n<span class=\"token keyword\">let</span> textHeight <span class=\"token operator\">=</span> textWidth <span class=\"token operator\">+</span> textWidth <span class=\"token operator\">/</span> <span class=\"token number\">6</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`当前文本W的宽度：</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>textWidth<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`当前文本W的高度：</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>textHeight<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n\n        <h3 id='toc-3-4' >\n          小结\n        </h3>\n      \n<p>这篇文章主要是学习了 canvas 中如何使用<code class=\"language-text\">drawImage</code>来绘制图片，以及如何使用<code class=\"language-text\">getImageData</code>和<code class=\"language-text\">putImageData</code>来对图像像素值做处理，比如常见的图片灰度处理，或者反相颜色等。也回顾了在 canvas 中绘制文本的一些相关方法和属性，这些知识在 css 中比较类似，理解起来也比较容易和简单。</p>","tableOfContents":"<ul><li><a href=\"#toc-3-1\">图片</a></li><li><a href=\"#toc-3-2\">图像像素</a></li><li><a href=\"#toc-3-3\">文本</a></li><li><a href=\"#toc-3-4\">小结</a></li></ul>","frontmatter":{"title":"canvas核心技术-如何绘制图片和文本","date":"July 27, 2018","tags":["canvas"],"zan":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/post/how_to_draw_image_and_text/","previous":{"fields":{"slug":"/post/how_to_draw_graphics/"},"frontmatter":{"title":"canvas核心技术-如何绘制图形"}},"next":{"fields":{"slug":"/post/how_to_implement_simple_animations/"},"frontmatter":{"title":"canvas核心技术-如何实现简单的动画"}}}}