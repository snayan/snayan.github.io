{"data":{"avatar":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIEBQP/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQD/2gAMAwEAAhADEAAAAcSerUQpOzXUqiMAb//EABsQAAMAAgMAAAAAAAAAAAAAAAABAhESAxQh/9oACAEBAAEFAjzJ1VJcZepyU9x0z//EABURAQEAAAAAAAAAAAAAAAAAABEg/9oACAEDAQE/AWP/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAbEAADAAIDAAAAAAAAAAAAAAAAASEQERIxMv/aAAgBAQAGPwImPUNtcTodiz//xAAcEAACAgMBAQAAAAAAAAAAAAAAAREhMUFRYXH/2gAIAQEAAT8hWbK7l6NWStvasZEW4S7fwfTTAkNzkQZ//9oADAMBAAIAAwAAABAs1wP/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEQ/9oACAEDAQE/EMLbwL//xAAXEQEBAQEAAAAAAAAAAAAAAAABEQAQ/9oACAECAQE/EIzR4rv/xAAfEAEAAwACAQUAAAAAAAAAAAABABEhMUFRYXGBodH/2gAIAQEAAT8QAjVRsF68R3WyhBpEB4otans9oxQXOZRxVfkow9YivuDFJrEfPmaECm2kqIiV2XP/2Q==","width":40,"height":40,"src":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg","srcSet":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg 1x,\n/static/9d156e8486b343189790da372acb0018/9c097/my.jpg 1.5x,\n/static/9d156e8486b343189790da372acb0018/bd6c6/my.jpg 2x"}}},"site":{"siteMetadata":{"title":"三羊的小站","author":"三羊","postPath":"/post","contentUrl":"https://github.com/snayan/blog-source/tree/master/content/blog","menu":{"search":{"name":"搜索","link":"/search"}}}},"markdownRemark":{"id":"f32f3dc1-1746-51ad-ba84-919ace0b9d15","excerpt":"ReactDom 在 16 版本中也新增了一些新的功能，比如createPortal，hydrate。今天主要学习一下createPortal。\n先看下 ReactDom 的大致包含的一些属性和方法。可以看到我们熟悉的，，。这里面新增了两个新的方法和。以 unstable…","html":"<p>ReactDom 在 16 版本中也新增了一些新的功能，比如<strong>createPortal</strong>，<strong>hydrate</strong>。今天主要学习一下<strong>createPortal</strong>。\n先看下 ReactDom 的大致包含的一些属性和方法。</p>\n<pre><code class=\"language-javascript\">const ReactDom = {\n  createPortal, //reacte16中新增的\n  hydrate, //reacte16中新增的\n  findDomNode,\n  render,\n  unmountComponentAtNode,\n  flushSync,\n  unstable_renderSubtreeIntoContainer,\n  unstable_createPortal, //这个实际就是现在的createPortal,将在React17版本中移除\n  unstable_batchedUpdates,\n  unstable_deferredUpdates,\n  unstable_flushControlled,\n}\n</code></pre>\n<p>可以看到我们熟悉的<code>findDomNode</code>，<code>render</code>，<code>unmountComponentAtNode</code>。这里面新增了两个新的方法<code>createPortal</code>和<code>hydrate</code>。以 unstable_开头的表示的是当前版本中存在的方法，但可能会在后续版本中改动或移除，所以不建议使用。</p>\n<!--more-->\n\n          <h2 id='toc-2-1' >\n            createPortal\n          </h2>\n        \n<p>先来看下这个方法的签名:</p>\n<pre><code class=\"language-typescript\">export function createPortal(\n  children: ReactNodeList,\n  container: DOMContainer,\n  key: ?string = null,\n): ReactPortal {\n  return {\n    // This tag allow us to uniquely identify this as a React Portal\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children,\n    containerInfo,\n    implementation:null,\n  };\n}\n</code></pre>\n<p>可以看到它接受三个参数，第一个 children，要渲染的节点元素，第二个是 container，要渲染的容器，第三个是可选的参数 key，这个参数一般没用，默认为 null。\n它的作用就是在任意合法的 dom 节点都可以用作渲染的容器，而不仅仅是当前父级节点。下面为官方的说明:</p>\n<blockquote>\n<p>Portals provide a first-class way to render children into a DOM node that exists outside the DOM hierarchy of the parent component.</p>\n</blockquote>\n<p>通常情况下，我们在<code>render</code>中挂载 React child 到它最近的父节点下，例如</p>\n<pre><code class=\"language-jsx\">render() {\n  // React mounts a new div and renders the children into it\n  return (\n    &#x3C;div>\n      {this.props.children}\n    &#x3C;/div>\n  );\n}\n</code></pre>\n<p>而<strong>createPortal</strong>却可以使得 React child 挂载到任何合法的 dom 节点下</p>\n<pre><code class=\"language-javascript\">render() {\n  // React does *not* create a new div. It renders the children into `domNode`.\n  // `domNode` is any valid DOM node, regardless of its location in the DOM.\n  return ReactDOM.createPortal(\n    this.props.children,\n    domNode,\n  );\n}\n</code></pre>\n<p>虽然<strong>createPortal</strong>可以挂载到任何合法的 dom 容器中，但是它在 React tree 中的层次结构是不会受影响的，比如事件冒泡。在用<strong>createPortal</strong>渲染的组件中触发一个事件，依然可以被它在 React tree 中的父级节点捕获到。看下面的例子：\n例如有下面的 html 结构</p>\n<pre><code class=\"language-html\">&#x3C;html>\n  &#x3C;body>\n    &#x3C;div id=\"app-root\">&#x3C;/div>\n    &#x3C;div id=\"modal-root\">&#x3C;/div>\n  &#x3C;/body>\n&#x3C;/html>\n</code></pre>\n<p>在 React tree 中，app-root 节点依然可以捕获到 modal-root 节点冒泡出来的事件。</p>\n<pre><code class=\"language-jsx\">// These two containers are siblings in the DOM\nconst appRoot = document.getElementById(\"app-root\")\nconst modalRoot = document.getElementById(\"modal-root\")\n\nclass Modal extends React.Component {\n  constructor(props) {\n    super(props)\n    this.el = document.createElement(\"div\")\n  }\n\n  componentDidMount() {\n    // The portal element is inserted in the DOM tree after\n    // the Modal's children are mounted, meaning that children\n    // will be mounted on a detached DOM node. If a child\n    // component requires to be attached to the DOM tree\n    // immediately when mounted, for example to measure a\n    // DOM node, or uses 'autoFocus' in a descendant, add\n    // state to Modal and only render the children when Modal\n    // is inserted in the DOM tree.\n    modalRoot.appendChild(this.el)\n  }\n\n  componentWillUnmount() {\n    modalRoot.removeChild(this.el)\n  }\n\n  render() {\n    return ReactDOM.createPortal(this.props.children, this.el)\n  }\n}\n\nclass Parent extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = { clicks: 0 }\n    this.handleClick = this.handleClick.bind(this)\n  }\n\n  handleClick() {\n    // This will fire when the button in Child is clicked,\n    // updating Parent's state, even though button\n    // is not direct descendant in the DOM.\n    this.setState(prevState => ({\n      clicks: prevState.clicks + 1,\n    }))\n  }\n\n  render() {\n    return (\n      &#x3C;div onClick={this.handleClick}>\n        &#x3C;p>Number of clicks: {this.state.clicks}&#x3C;/p>\n        &#x3C;p>\n          Open up the browser DevTools to observe that the button is not a child\n          of the div with the onClick handler.\n        &#x3C;/p>\n        &#x3C;Modal>\n          &#x3C;Child />\n        &#x3C;/Modal>\n      &#x3C;/div>\n    )\n  }\n}\n\nfunction Child() {\n  // The click event on this button will bubble up to parent,\n  // because there is no 'onClick' attribute defined\n  return (\n    &#x3C;div className=\"modal\">\n      &#x3C;button>Click&#x3C;/button>\n    &#x3C;/div>\n  )\n}\n\nReactDOM.render(&#x3C;Parent />, appRoot)\n</code></pre>","tableOfContents":"<ul><li><a href=\"#toc-2-1\">createPortal</a><ul></ul></li></ul>","frontmatter":{"title":"react 16学习(三)","date":"April 04, 2018","tags":["react"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/post/learn_react16_part3/","previous":{"fields":{"slug":"/post/learn_react16_part2/"},"frontmatter":{"title":"React 16学习(二)"}},"next":{"fields":{"slug":"/post/learn_react16_part4/"},"frontmatter":{"title":"react 16学习(四)"}}}}