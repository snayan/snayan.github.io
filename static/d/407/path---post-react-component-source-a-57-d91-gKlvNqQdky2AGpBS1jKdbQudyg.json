{"data":{"avatar":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIEBQP/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQD/2gAMAwEAAhADEAAAAcSerUQpOzXUqiMAb//EABsQAAMAAgMAAAAAAAAAAAAAAAABAhESAxQh/9oACAEBAAEFAjzJ1VJcZepyU9x0z//EABURAQEAAAAAAAAAAAAAAAAAABEg/9oACAEDAQE/AWP/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAbEAADAAIDAAAAAAAAAAAAAAAAASEQERIxMv/aAAgBAQAGPwImPUNtcTodiz//xAAcEAACAgMBAQAAAAAAAAAAAAAAAREhMUFRYXH/2gAIAQEAAT8hWbK7l6NWStvasZEW4S7fwfTTAkNzkQZ//9oADAMBAAIAAwAAABAs1wP/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEQ/9oACAEDAQE/EMLbwL//xAAXEQEBAQEAAAAAAAAAAAAAAAABEQAQ/9oACAECAQE/EIzR4rv/xAAfEAEAAwACAQUAAAAAAAAAAAABABEhMUFRYXGBodH/2gAIAQEAAT8QAjVRsF68R3WyhBpEB4otans9oxQXOZRxVfkow9YivuDFJrEfPmaECm2kqIiV2XP/2Q==","width":40,"height":40,"src":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg","srcSet":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg 1x,\n/static/9d156e8486b343189790da372acb0018/9c097/my.jpg 1.5x,\n/static/9d156e8486b343189790da372acb0018/bd6c6/my.jpg 2x"}}},"site":{"siteMetadata":{"title":"三羊的小站","author":"三羊","postPath":"/post","contentUrl":"https://github.com/snayan/blog-source/tree/master/content/blog","ableZan":false,"menu":{"search":{"name":"搜索","link":"/search"}}}},"markdownRemark":{"id":"9cd7cfa3-4902-5324-867f-329606a5e8b6","excerpt":"今天主要看下，实际上是对象上一个构造函数。\n构造函数接受三个参数，，，，实际是在中注入的，它是用来实际更新Component…","html":"<p>今天主要看下<code class=\"language-text\">React.Component</code>，实际上<code class=\"language-text\">Component</code>是<code class=\"language-text\">React</code>对象上一个构造函数。\n构造函数接受三个参数，<code class=\"language-text\">props</code>，<code class=\"language-text\">context</code>，<code class=\"language-text\">updater</code>，<code class=\"language-text\">updater</code>实际是在<code class=\"language-text\">render</code>中注入的，它是用来实际更新<code class=\"language-text\">state</code></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">ReactComponent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> updater</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props <span class=\"token operator\">=</span> props\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>context <span class=\"token operator\">=</span> context\n  <span class=\"token comment\">// emptyObject 是一个空对象{}</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>refs <span class=\"token operator\">=</span> emptyObject\n  <span class=\"token comment\">// ReactNoopUpdateQueue is the abstract API for an update queue</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>updater <span class=\"token operator\">=</span> updater <span class=\"token operator\">||</span> ReactNoopUpdateQueue\n<span class=\"token punctuation\">}</span></code></pre></div>\n<!--more-->\n<p>Component 的原型对象上有这么几个属性，分别是<code class=\"language-text\">isReactComponent</code>，<code class=\"language-text\">setState</code>，<code class=\"language-text\">forceUpdate</code>，<code class=\"language-text\">isMounted</code>，<code class=\"language-text\">replaceState</code>。其中，<code class=\"language-text\">isMounted</code>和<code class=\"language-text\">replaceState</code>不推荐使用了，后续版本会移除的。</p>\n<ul>\n<li><code class=\"language-text\">isReactComponent</code>是一个空对象。</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token class-name\">ReactComponent</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>isReactComponent <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">setState()</code>方法，改变组件<code class=\"language-text\">state</code>时应该总是使用这个方法，把<code class=\"language-text\">state</code>看成一个不可变对象。当调用<code class=\"language-text\">setState()</code>方法时，不会保证立即执行<code class=\"language-text\">setState</code>函数，也不会立即改变<code class=\"language-text\">state</code>对象，因为它的执行是一个异步的。它可以有两个参数，第一个参数是对象或者函数，这个函数返回一个对象，第二个参数是一个<code class=\"language-text\">callback</code>，当<code class=\"language-text\">setState</code>实际执行完成时会回调这个<code class=\"language-text\">callback</code></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token class-name\">ReactComponent</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">setState</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">partialState<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">typeof</span> partialState <span class=\"token operator\">===</span> <span class=\"token string\">\"obejct\"</span> <span class=\"token operator\">||</span>\n    <span class=\"token keyword\">typeof</span> partialState <span class=\"token operator\">===</span> <span class=\"token string\">\"function\"</span> <span class=\"token operator\">||</span>\n    partialState <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span>\n  <span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">?</span> <span class=\"token string\">\"警告或者直接报错.....\"</span>\n    <span class=\"token punctuation\">:</span> <span class=\"token keyword\">void</span> <span class=\"token number\">0</span>\n  <span class=\"token comment\">// 将当前更新入队</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>updater<span class=\"token punctuation\">.</span><span class=\"token function\">enqueueSetState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> partialState<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>callback<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 将当前callback入队</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>updater<span class=\"token punctuation\">.</span><span class=\"token function\">enqueueCallback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">,</span> <span class=\"token string\">\"setState\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">forceUpdate()</code>方法，强制更新，谨慎使用，当你知道某些深成次的<code class=\"language-text\">state</code>已经发生变化了，但没有调用<code class=\"language-text\">setState()</code>时，你可以调用<code class=\"language-text\">forceUpdate()</code>。调用<code class=\"language-text\">forceUpdate()</code>不会触发<code class=\"language-text\">shouldComponent</code>，会触发<code class=\"language-text\">componentWillUpdate</code>和<code class=\"language-text\">componentDidUpdate</code>方法。</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token class-name\">ReactComponent</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">forceUpdate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>updater<span class=\"token punctuation\">.</span><span class=\"token function\">enqueueForceUpdate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>callback<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>updater<span class=\"token punctuation\">.</span><span class=\"token function\">enqueueCallback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">,</span> <span class=\"token string\">\"forceUpdate\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>再来看一下<code class=\"language-text\">PureComponent</code>，它与<code class=\"language-text\">Component</code>结构一样，只不过在其原型对象上增加一个<code class=\"language-text\">isPureComponent=true</code>的属性。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">ComponentDummy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token class-name\">ComponentDummy</span><span class=\"token punctuation\">.</span>prototype <span class=\"token operator\">=</span> <span class=\"token class-name\">ReactComponent</span><span class=\"token punctuation\">.</span>prototype\n<span class=\"token class-name\">ReactPureComponent</span><span class=\"token punctuation\">.</span>prototype <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ComponentDummy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token class-name\">ReactPureComponent</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>constructor <span class=\"token operator\">=</span> ReactPureComponent\n<span class=\"token comment\">// Avoid an extra prototype jump for these methods.</span>\n<span class=\"token function\">_assign</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ReactPureComponent</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ReactComponent</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">)</span>\n<span class=\"token class-name\">ReactPureComponent</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>isPureReactComponent <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span></code></pre></div>\n<p>「react 版本 15.5.4」</p>","tableOfContents":"","frontmatter":{"title":"阅读react源码--component部分","date":"May 09, 2017","tags":["react"],"zan":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/post/react_component_source/","previous":{"fields":{"slug":"/post/react_whole_construct/"},"frontmatter":{"title":"阅读react源码--react整体结构"}},"next":{"fields":{"slug":"/post/reactclass_source/"},"frontmatter":{"title":"阅读react源码--createClass部分"}}}}