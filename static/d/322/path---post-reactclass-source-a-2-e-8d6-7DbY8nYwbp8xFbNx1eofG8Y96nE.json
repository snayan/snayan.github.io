{"data":{"avatar":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIEBQP/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQD/2gAMAwEAAhADEAAAAcSerUQpOzXUqiMAb//EABsQAAMAAgMAAAAAAAAAAAAAAAABAhESAxQh/9oACAEBAAEFAjzJ1VJcZepyU9x0z//EABURAQEAAAAAAAAAAAAAAAAAABEg/9oACAEDAQE/AWP/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAbEAADAAIDAAAAAAAAAAAAAAAAASEQERIxMv/aAAgBAQAGPwImPUNtcTodiz//xAAcEAACAgMBAQAAAAAAAAAAAAAAAREhMUFRYXH/2gAIAQEAAT8hWbK7l6NWStvasZEW4S7fwfTTAkNzkQZ//9oADAMBAAIAAwAAABAs1wP/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEQ/9oACAEDAQE/EMLbwL//xAAXEQEBAQEAAAAAAAAAAAAAAAABEQAQ/9oACAECAQE/EIzR4rv/xAAfEAEAAwACAQUAAAAAAAAAAAABABEhMUFRYXGBodH/2gAIAQEAAT8QAjVRsF68R3WyhBpEB4otans9oxQXOZRxVfkow9YivuDFJrEfPmaECm2kqIiV2XP/2Q==","width":40,"height":40,"src":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg","srcSet":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg 1x,\n/static/9d156e8486b343189790da372acb0018/9c097/my.jpg 1.5x,\n/static/9d156e8486b343189790da372acb0018/bd6c6/my.jpg 2x"}}},"site":{"siteMetadata":{"title":"三羊的小站","author":"三羊","postPath":"/post","contentUrl":"https://github.com/snayan/blog-source/tree/master/content/blog","menu":{"search":{"name":"搜索","link":"/search"}}}},"markdownRemark":{"id":"7c4cc46d-78d0-5509-8c77-3e51d35cff6f","excerpt":"ReactClass 对象为 React 提供了方法，实际上 ReactClass 有 2 个属性，一个是，另外一个是对象。，接受 1 个参数，一个对象，这个对象必须包含方法；结果返回一个构造函数。注意，方法将在 16.X 版本中移除了，所以现在要用 es6 的语法了。继承 ReactComponent…","html":"<p>ReactClass 对象为 React 提供了<code>createClass</code>方法，实际上 ReactClass 有 2 个属性，一个是<code>createClass</code>，另外一个是<code>injection</code>对象。</p>\n<pre><code class=\"language-javascript\">var ReactClass = {\n  createClass: function(spec) {\n    // createClass实现\n  },\n  injection: {\n    injectMixin: function(mixin) {\n      injectedMixins.push(mixin)\n    },\n  },\n}\n</code></pre>\n<!--more-->\n<ul>\n<li><code>createClass</code>，接受 1 个参数，一个对象，这个对象必须包含<code>render</code>方法；结果返回一个构造函数。注意，<code>createClass</code>方法将在 16.X 版本中移除了，所以现在要用 es6 的<code>class</code>语法了。</li>\n</ul>\n<pre><code class=\"language-javascript\">var createClass = function(spec) {\n  var Constructor = function(props, context, updater) {\n    // 这段代码是不是很熟悉，跟component里的一样。\n    this.props = props\n    this.context = context\n    this.refs = emptyObject\n    this.updater = updater || ReactNoopUpdaterQueue\n\n    // 获取初始化的state\n    var initialState = this.getInitialState ? this.getInitialState() : null\n    // getInitialState()必须返回对象\n    !(typeof initialState === \"object\" &#x26;&#x26; !Array.isArray(initialState))\n      ? \"提示报错\"\n      : void 0\n    this.state = initialState\n\n    // 继承ReactComponent，并重写replaceState和isMounted\n    Constructor.prototype = new ReactClassComponent()\n    Constructor.prototype.constructor = Constructor\n\n    // mixin提前注入的对象,通过ReactClass.injection.injectMixin注入\n    injectedMixins.forEach(mixSpecIntoComponent.bind(null, Constructor))\n    // Mixin一些其他的属性\n    mixSpecIntoComponent(Constructor, spec)\n\n    // 赋值初始化的props\n    if (Constructor.getDefaultProps) {\n      Constructor.defaultProps = Constructor.getDefaultProps()\n    }\n\n    // 判断是否有render方法，没有就报错\n    !Constructor.prototype.render ? \"提示报错\" : void 0\n\n    // 赋值没有定义的默认的生命周期的函数为null\n    for (var methodName in ReactClassInterface) {\n      if (!Constructor.prototype[methodName]) {\n        Constructor.prototype[methodName] = null\n      }\n    }\n  }\n  // 返回构造函数\n  return Constructor\n}\n</code></pre>\n<p>继承 ReactComponent 并重写<code>replaceState</code>，<code>isMounted</code>的代码：</p>\n<pre><code class=\"language-javascript\">// Mixin replaceState和isMounted的对象\nvar ReactClassMixin = {\n  replaceState: function(newState, callback) {\n    this.updater.enqueueReplaceStaet(this.newState)\n    if (callback) {\n      this.updater.enqueueCallback(this, callback, \"replaceState\")\n    }\n  },\n  isMounted: function() {\n    return this.updater.isMounted(this)\n  },\n}\n\n// 合并ReactComponent.prototype，和 ReactClassMixin\nvar ReactClassComponent = function() {}\nObject.assign(\n  ReactClassComponent.prototype,\n  ReactComponent.prototype,\n  ReactClassMixin\n)\n\n// 继承ReactClassComponent\nConstructor.prototype = new ReactClassComponent()\nConstructor.prototype.constructor = Constructor\n</code></pre>\n<p>Mixin 一些其他的属性的代码：</p>\n<pre><code class=\"language-javascript\">var RESERVED_SPEC_KEYS={\n  displayName:function(Constructor,displayName){\n    Constructor.displayName=displayName;\n  },\n  mixins:function(Constructor,mixins){\n    if(mixins){\n      for(var i=0;i&#x3C;mixins.length;i++){\n        mixSpecIntoComponent(Constructor.mixins[i]);\n      }\n    }\n  },\n  childContextTypes:function(COnstrcutor,childContextTypes){\n    //.....\n  },\n  contextTypes:function(Constructor,contextTypes){\n    //......\n  },\n  getDefaultProps:function(Constructor,getDefaultProps){\n    //....\n  },\n  propTypes:function(Constructor,propTypes){\n    //....\n  },\n  statics:function(Constructor,statics){\n    //....\n  },\n  autobind:function(){}\n}\nfunction mixSpecIntoComponent(Constructor,spec){\n  // 如果spec中有mixins，则合并\n  if(spec.hasOwnProperty('mixins')){\n    RESERVED_SPEC_KEYS.mixins(Constructor,spec.mixins);\n  }\n  var proto=Constructor.prototype;\n  for(var name in spec){\n    if(!spec.hasOwnProperty(name)){\n      continue;\n    }\n    if(name==='mixins'){\n      // 第一步已经合并了mixins属性了，所以此处不需要再次合并\n      continue;\n    }\n    var property=spec[name];\n    // 合并保留的关键属性\n    if(RESERVED_SPEC_KEYS.hasOwnProperty(name)){\n      RESERVED_SPEC_KEYS[name](Constructor,property);\n    }else{\n      // 合并自定义的属性\n      ....\n    }\n\n  }\n}\n</code></pre>\n<ul>\n<li><code>injection</code>，通过调用<code>ReactClass.injection.injectMixin</code>可以全局注入需要 mixin 的对象，此后在调用<code>ReactClass.createClass(spec)</code>的时候就不需要在单独注入了。</li>\n</ul>\n<pre><code class=\"language-javascript\">var injection = {\n  injectMixin: function(mixin) {\n    injectedMixins.push(mixin)\n  },\n}\n</code></pre>\n<p>​「react 版本 15.5.4」</p>","tableOfContents":"<ul></ul>","frontmatter":{"title":"阅读react源码--createClass部分","date":"May 22, 2017","tags":["react"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/post/reactclass_source/","previous":{"fields":{"slug":"/post/react_component_source/"},"frontmatter":{"title":"阅读react源码--component部分"}},"next":{"fields":{"slug":"/post/reactelement_source/"},"frontmatter":{"title":"阅读react源码--ReactElement部分"}}}}