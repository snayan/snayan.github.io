{"data":{"avatar":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIEBQP/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQD/2gAMAwEAAhADEAAAAcSerUQpOzXUqiMAb//EABsQAAMAAgMAAAAAAAAAAAAAAAABAhESAxQh/9oACAEBAAEFAjzJ1VJcZepyU9x0z//EABURAQEAAAAAAAAAAAAAAAAAABEg/9oACAEDAQE/AWP/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAbEAADAAIDAAAAAAAAAAAAAAAAASEQERIxMv/aAAgBAQAGPwImPUNtcTodiz//xAAcEAACAgMBAQAAAAAAAAAAAAAAAREhMUFRYXH/2gAIAQEAAT8hWbK7l6NWStvasZEW4S7fwfTTAkNzkQZ//9oADAMBAAIAAwAAABAs1wP/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEQ/9oACAEDAQE/EMLbwL//xAAXEQEBAQEAAAAAAAAAAAAAAAABEQAQ/9oACAECAQE/EIzR4rv/xAAfEAEAAwACAQUAAAAAAAAAAAABABEhMUFRYXGBodH/2gAIAQEAAT8QAjVRsF68R3WyhBpEB4otans9oxQXOZRxVfkow9YivuDFJrEfPmaECm2kqIiV2XP/2Q==","width":40,"height":40,"src":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg","srcSet":"/static/9d156e8486b343189790da372acb0018/987ea/my.jpg 1x,\n/static/9d156e8486b343189790da372acb0018/9c097/my.jpg 1.5x,\n/static/9d156e8486b343189790da372acb0018/bd6c6/my.jpg 2x"}}},"site":{"siteMetadata":{"title":"三洋的小站","author":"三洋"}},"markdownRemark":{"id":"cd83ef50-ac22-57f0-893b-24326523f68d","excerpt":"现在前端项目的构建一般基本都是基于 webpack 的。项目的技术栈目前比较主流的是 react 全家桶和 vue 全家桶。\n趁空闲，以公司一个项目整理了 webpack 构建常见的流程,这个项目是使用 vue 全家桶开发的。技术栈vuetypescript…","html":"<p>现在前端项目的构建一般基本都是基于 webpack 的。项目的技术栈目前比较主流的是 react 全家桶和 vue 全家桶。\n趁空闲，以公司一个项目整理了 webpack 构建常见的流程,这个项目是使用 vue 全家桶开发的。</p>\n<h3>技术栈</h3>\n<ul>\n<li>vue</li>\n<li>typescript</li>\n</ul>\n<h3>浏览器支持</h3>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"browserslist\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"> 1%\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"last 2 versions\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"not ie &lt;= 9\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"Android >= 4.3\"</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<!--more-->\n<h3>流程图</h3>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bd566805aa9d655a68cebd7f4b25061e/fbfd0/webpack_build.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 53.27743902439024%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAC8klEQVQoz4VSa0iTYRR+nZjgBVuZFnnDLkQEUT+SCqJfQURFBhlWWGGiAzMIKk0x75GhOfdtNsVNPt3Ntrl5V/TT7dvNuRy2prU5beYUzVuESG6evq2kHxUdeHlfzjnP8z7P4SBExau2cvTfmEVhkV93Zh+0xpVQp3jP6q5ctIJC/+grVKT77iplFS1XkXyspDv95CPRtYT8ltSEgo7bpx+33Yj3NXhQXIrzskfmYILcxoSM6euAAEV7S4R16oLKMp2ktnyORlW9JX7e5N3a4yG4Dp9qGK6B2n7uJoeocEvfS4Crxtg+wk0Ul227tzCoaQC1Coe8jxkr1CdRFCuNHHfJSavLrB2bPYfaTUZ/AECJ7LAQmaF/UmAUwJuhTg9fw9voGicB14owH+E6ismy3ZqQ6ZnfFDps9b7t5idK4e5/juhKTVCw1NAz2WTEQaiVu3lk3UbH+ADgGgHLW6+E0m2hX1A4akZ0lIMigxZReOzGAf8t/MOCFz8flPcM7dg8L7ni6HapscshNAlApFV46tUU4dgANGrE1b8wwa0MCNRbl/gGyyJ/vBSCvElb+8vYFZKtX1JhjlWSI0e9JvtVYsSZl1R+hC7WKycFw40gMsg9PLKWUkhQhEL2mgIFDJGHI+3TD2LVljE2MWmvkzpa9noJR2VlUYsqrGWur0q9rMZe/7bMDQwW6eQO3MAHoU7qrie5bolZBkIVJnEpM3ve4llOu5Qx6mhjcizPTFMT9SOcv85OaSR9czhfiUIoy07xiBgkRgXwtXXQaiWgeaBOSeSWzRN5NdBfwIShcqHOdWIGHBc/iLy4tYgFmquPQzOLC2lreq4fquwu8q1NYnV4sEAneVev4a41aSXLtSrWUpOheV00iOFmLIcwsZ47TaxilxF7mmbJ3KAPPekO9+LmUh3I3sFGy2o2Whio9i42w6eUpajxoxY7pqgjdV9RZ1p8aScjPr/tzv5SRUoEeM6EgvsUHb6f3QFwKGDL3fylmT8c/wC9epX40V0ESAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"webpack build\"\n        title=\"\"\n        src=\"/static/bd566805aa9d655a68cebd7f4b25061e/b9e4f/webpack_build.png\"\n        srcset=\"/static/bd566805aa9d655a68cebd7f4b25061e/cf440/webpack_build.png 148w,\n/static/bd566805aa9d655a68cebd7f4b25061e/d2d38/webpack_build.png 295w,\n/static/bd566805aa9d655a68cebd7f4b25061e/b9e4f/webpack_build.png 590w,\n/static/bd566805aa9d655a68cebd7f4b25061e/f9b6a/webpack_build.png 885w,\n/static/bd566805aa9d655a68cebd7f4b25061e/2d849/webpack_build.png 1180w,\n/static/bd566805aa9d655a68cebd7f4b25061e/fbfd0/webpack_build.png 1312w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<h3>功能</h3>\n<ul>\n<li>babel</li>\n<li>postcss</li>\n<li>eslint</li>\n</ul>\n<h4>babel</h4>\n<blockquote>\n<p>javascript compiler</p>\n</blockquote>\n<p>让我们可以在项目中使用较新 JavaScript 特性。可以通过.babelrc文件指定我们需要编译到的目标版本</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"presets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"env\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"modules\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"useBuiltIns\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"usage\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"stage-2\"</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"plugins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"transform-vue-jsx\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"transform-runtime\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>postcss</h4>\n<blockquote>\n<p>a tool for transforming styles with JS plugins</p>\n</blockquote>\n<p>可以让我们在项目使用一些较新 css 的特性。可以通过<strong>.postcssrc.js</strong>文件指定我们配置的 postcss 插件</p>\n<ul>\n<li>可以通过 rem 方案来处理移动设备上的适配，在构建过程中，使用了 px2rem 插件来将 px 转为 rem。</li>\n<li>使用了 postcss-import 将@import 引入的 css 文件内容内联到当前文件内</li>\n<li>postcss-url，配合 postcss-import 使用</li>\n<li>postcss-cssnext，使用一些 css 新特性，目前已建议使用 postcss-preset-env 替换。</li>\n<li>postss-pxtorem，将 px 转为 rem</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"postcss-import\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      path<span class=\"token punctuation\">:</span> <span class=\"token string\">\"src/css/\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"postcss-url\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"postcss-cssnext\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"postcss-pxtorem\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      rootValue<span class=\"token punctuation\">:</span> <span class=\"token number\">75</span><span class=\"token punctuation\">,</span>\n      unitPrecision<span class=\"token punctuation\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n      propList<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      selectorBlackList<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      replace<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      mediaQuery<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      minPixelValue<span class=\"token punctuation\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>tslint</h4>\n<p>定制项目 javascript 使用的标准化，建议将多个项目统一定制为一套。可以在 tslint.json 中定制项目的检查规则。</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"extends\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"tslint:recommended\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"rulesDirectory\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"path/to/custom/rules/directory/\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"another/path/\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"rules\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"max-line-length\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"options\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">120</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"new-parens\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"no-arg\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"no-bitwise\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"no-conditional-assignment\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"no-consecutive-blank-lines\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"no-console\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"severity\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"warning\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"options\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"debug\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"info\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"log\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"time\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"timeEnd\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"trace\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"jsRules\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"max-line-length\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"options\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">120</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>环境配置</h3>\n<p>在配置 webpack 文件时，分 dev 和 prod 环境，不同的环境配置项有所差别，主要体现在 plugin 的使用上。主要有三个 webpack 配置文件</p>\n<ul>\n<li>webpack.base.conf.js，dev 和 prod 公用的基础配置，主要 loader 的配置</li>\n<li>webpack.dev.conf.js，dev 环境的配置，主要配置了 webpack-dev-serve，供开发环境使用</li>\n<li>webpack.prod.conf.js，production 环境的配置，主要增加了一些优化的配置，比如 OptimizeCSSPlugin，UglifyJsPlugin\n可以根据实际业务情况，配置不同环境变量，比如，我整理的这个项目，是会区分不同国家，以及不同的测试部署环境。在区分不同国家，不同部署环境时，采用了 test，staging，live 等环境名称。development 和 production 只是针对开发人员而言的，在本地开发就是 development，代码部署到 test，staging，live 都是 production。对不同国家，不同部署环境，又有 dev.env.js 和 prod.env.js.这两个文件其实是一样的，只不过参数不同而已。<strong>可以统一从 process.env.env 和 process.env.cid 拿参数，这样就可以不需要这两个配置文件了，且不需要在 build 脚本中去动态替换 prod.env.js 里的配置项（个人觉得，可以讨论）</strong></li>\n<li>dev.env.js</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> merge <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"webpack-merge\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> prodEnv <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./prod.env\"</span><span class=\"token punctuation\">)</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token function\">merge</span><span class=\"token punctuation\">(</span>prodEnv<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token constant\">NODE_ENV</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'\"development\"'</span><span class=\"token punctuation\">,</span>\n  country<span class=\"token punctuation\">:</span> <span class=\"token string\">'\"sg\"'</span><span class=\"token punctuation\">,</span>\n  environment<span class=\"token punctuation\">:</span> <span class=\"token string\">'\"test\"'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>prod.env.js</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token constant\">COUNTRY</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"sg\"</span>\n<span class=\"token keyword\">const</span> shopeeEnvironment <span class=\"token operator\">=</span> <span class=\"token string\">\"live\"</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token constant\">NODE_ENV</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'\"production\"'</span><span class=\"token punctuation\">,</span>\n  country<span class=\"token punctuation\">:</span> <span class=\"token string\">'\"'</span> <span class=\"token operator\">+</span> <span class=\"token constant\">COUNTRY</span> <span class=\"token operator\">+</span> <span class=\"token string\">'\"'</span><span class=\"token punctuation\">,</span>\n  environment<span class=\"token punctuation\">:</span> <span class=\"token string\">'\"'</span> <span class=\"token operator\">+</span> shopeeEnvironment <span class=\"token operator\">+</span> <span class=\"token string\">'\"'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>使用</h3>\n<ul>\n<li>在 dev 开发环境，需执行<code class=\"language-text\">npm run start</code>或者<code class=\"language-text\">yarn start</code></li>\n<li>在 build 时，需执行<code class=\"language-text\">npm run build</code>或者<code class=\"language-text\">yarn build</code></li>\n</ul>\n<h3>其他</h3>\n<ul>\n<li>babel-polyfill，对不同设备对 js 的兼容，<strong>可以考虑使用 polyfill.io，针对具体设备引入具体的 feature</strong></li>\n<li>normalize.css，针对 Html5，样式 reset</li>\n</ul>","frontmatter":{"title":"webpack构建常见流程","date":"June 27, 2018"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/post/process_of_webpack_build_project/","previous":{"fields":{"slug":"/post/vue_technology_stack/"},"frontmatter":{"title":"vue 全家桶初探"}},"next":{"fields":{"slug":"/post/core_html5_canvas/"},"frontmatter":{"title":"canvas核心技术"}}}}